<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Add Card</title>
    <!-- Include your CSS files here -->

    <!-- Include jQuery library -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </head>
  <body class="horizontal-nav boxed skin-megna fixed-layout">
    <!-- Include your pre_load file here -->
    <!-- Include your menu file here -->
    <div id="main-wrapper">
      <div class="page-wrapper">
        <div class="container-fluid">
          <div class="row page-titles">
            <div class="col-md-6 align-self-center">
              <h4 class="text-themecolor">Card Information</h4>
            </div>
          </div>
          <div class="row">
            <div class="col-12">
              <div class="card">
                <form
                  class="floating-labels m-t-40"
                  method="post"
                  name="form1"
                  id="form1"
                  enctype="multipart/form-data"
                >
                  <div class="p-20">
                    <div class="row">
                      <div class="col-6">
                        <div class="d-flex">
                          <div class="col-12 col-sm-12 form-group">
                            <input
                              type="hidden"
                              id="publisher_name"
                              value="diamondir1"
                            />
                            <input type="hidden" id="mode" value="auth" />
                            <input
                              type="hidden"
                              id="convert"
                              value="underscores"
                            />
                            <input type="hidden" id="card_amount" value="0" />
                            <input
                              type="text"
                              class="form-control required-entry"
                              id="card_name"
                              value=""
                              placeholder=""
                            />
                            <span class="bar"></span>
                            <label for="card_name">Name on Card</label>
                          </div>
                        </div>
                        <div class="d-flex">
                          <div class="col-12 col-sm-12 form-group">
                            <input
                              type="text"
                              class="form-control required-entry"
                              id="card_number"
                              value=""
                              placeholder=""
                            />
                            <span class="bar"></span>
                            <label for="card_number">Card Number</label>
                          </div>
                        </div>
                        <div class="d-flex">
                          <div class="col-12 col-sm-6 form-group">
                            <input
                              type="text"
                              class="form-control required-entry"
                              id="card_exp"
                              value=""
                            />
                            <span class="bar"></span>
                            <label for="card_exp">Card Expiry</label>
                          </div>
                          <div class="col-12 col-sm-6 form-group focused">
                            <input
                              id="card_cvv"
                              type="text"
                              class="form-control required-entry"
                              value=""
                            />
                            <span class="bar"></span>
                            <label for="card_cvv">CVV</label>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-3 col-sm-3"></div>
                          <div class="col-9 col-sm-9">
                            <button
                              type="button"
                              class="btn waves-effect waves-light btn-info"
                              onClick="sendPayment()"
                            >
                              Add
                            </button>
                            <button
                              type="button"
                              onclick="window.location.href='payment_info'"
                              class="btn waves-effect waves-light btn-dark"
                            >
                              Cancel
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Include your footer file here -->
    </div>
    <script
      language="javascript"
      src="https://pay1.plugnpay.com/api/iframe/NF5QpoNPmA/client/"
    ></script>
    <script language="javascript">
      function initializePaymentAPI() {
        if (typeof payment_api !== "undefined" && payment_api !== null) {
          payment_api.setCallback(function (data) {
            console.log("setcallback response", data);
            $.ajax({
              url: "add_card",
              type: "POST",
              data: data,
              success: function (response) {
                console.log("success response", response);
                const result = response.split("|||");
                if (result[0] == 1) {
                  window.location.href = "payment_info";
                } else {
                  alert(result[1]);
                }
              },
              error: function (error) {
                console.error("Error:", error);
              },
            });
          });
        } else {
          console.error("payment_api is not defined");
        }
      }

      document.addEventListener("DOMContentLoaded", function () {
        const checkPaymentAPI = setInterval(function () {
          if (typeof payment_api !== "undefined" && payment_api !== null) {
            clearInterval(checkPaymentAPI);
            console.log("setInterval");
            initializePaymentAPI();
          }
        }, 100);
      });

      function sendPayment() {
        console.log("sendPayment -outerrr");
        if (typeof payment_api !== "undefined" && payment_api !== null) {
          console.log("sendPayment-inner");
          payment_api.send();
        } else {
          console.error("payment_api is not defined");
        }
      }
    </script>
  </body>
</html>
