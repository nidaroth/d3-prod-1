<? require_once("../global/config.php"); 
require_once("../language/common.php");
require_once("../language/course_offering.php");
require_once("../global/mail.php"); 
require_once("../global/texting.php"); 
require_once("check_access.php");
require_once("function_make_attendance_inactive.php");

if(check_access('MANAGEMENT_REGISTRAR') == 0 ){
	header("location:../index");
	exit;
}

////////////////////////////
////////////////////////////
////////////////////////////if grade book is edited check on instructor panel > GRADE BOOK SETUP
////////////////////////////
////////////////////////////

if($_GET['act'] == 'del_sch'){
	$db->Execute("DELETE FROM S_COURSE_OFFERING_SCHEDULE WHERE PK_COURSE_OFFERING_SCHEDULE = '$_GET[iid]' AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' "); 
	$db->Execute("DELETE FROM S_COURSE_OFFERING_SCHEDULE_DETAIL WHERE PK_COURSE_OFFERING_SCHEDULE = '$_GET[iid]' AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' ");
	header("location:course_offering?tab=scheduleTab&id=".$_GET['id']);
} else if($_GET['act'] == 'del_stu'){
	/* Ticket # 592 */
	$res_type = $db->Execute("SELECT PK_STUDENT_ENROLLMENT, PK_STUDENT_MASTER, PK_COURSE_OFFERING FROM S_STUDENT_COURSE WHERE PK_STUDENT_COURSE = '$_GET[iid]' AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' "); //Ticket #1659
	$PK_STUDENT_ENROLLMENT 	= $res_type->fields['PK_STUDENT_ENROLLMENT'];
	$PK_STUDENT_MASTER 		= $res_type->fields['PK_STUDENT_MASTER'];
	$PK_COURSE_OFFERING 	= $res_type->fields['PK_COURSE_OFFERING']; //Ticket #1659
	
	/* Ticket # 1771  */
	$res_ethink = $db->Execute("SELECT ENABLE_ETHINK FROM Z_ACCOUNT WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' "); 
	$ENABLE_ETHINK = $res_ethink->fields['ENABLE_ETHINK'];
	if($ENABLE_ETHINK == 1) {
		require_once("../global/ethink.php");
		delete_enrollment($PK_STUDENT_MASTER,$_GET['iid'],$_SESSION['PK_ACCOUNT']);
	}
	/* Ticket # 1771  */
	
	$res_type = $db->Execute("select CANVAS_ID FROM S_STUDENT_COURSE_CANVAS WHERE PK_STUDENT_COURSE = '$_GET[iid]' AND PK_STUDENT_ENROLLMENT = '$PK_STUDENT_ENROLLMENT' AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' AND SUCCESS = 1 AND CANVAS_ID != '' AND ACTIVE = 1");
	$res_canvas_1	= $db->Execute("SELECT ENABLE_CANVAS FROM Z_ACCOUNT WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' "); 
	$res_canvas 	= $db->Execute("SELECT CANVAS_ID FROM S_COURSE_OFFERING_CANVAS WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' AND PK_COURSE_OFFERING = '$_GET[id]' AND CANVAS_ID != '' ");  
	if($_GET['iid'] != '' && $res_canvas_1->fields['ENABLE_CANVAS'] == 1 && $res_canvas->RecordCount() > 0 && $res_type->RecordCount() > 0) {
		require_once("../global/canvas_delete.php"); //Ticket # 1555
		
		$BATCH_ID = time();
		delete_student_from_course_offering($_GET['iid'],$PK_STUDENT_MASTER, $PK_STUDENT_ENROLLMENT, $_SESSION['PK_ACCOUNT'], $BATCH_ID);
	}
	/* Ticket # 592 */
	
	$db->Execute("DELETE FROM S_STUDENT_COURSE WHERE PK_STUDENT_COURSE = '$_GET[iid]' AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' ");
	$db->Execute("DELETE FROM S_STUDENT_SCHEDULE WHERE PK_STUDENT_COURSE = '$_GET[iid]' AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' ");
	$db->Execute("DELETE from S_STUDENT_GRADE WHERE PK_ACCOUNT='$_SESSION[PK_ACCOUNT]' AND PK_COURSE_OFFERING = '$PK_COURSE_OFFERING' AND PK_STUDENT_ENROLLMENT = '$PK_STUDENT_ENROLLMENT' AND PK_STUDENT_ENROLLMENT > 0 AND PK_COURSE_OFFERING > 0"); //Ticket #1659
	
	header("location:course_offering?tab=studentTab&id=".$_GET['id']);
}

if(!empty($_POST)){
	//echo "<pre>";print_r($_POST);exit;
	$PK_COURSE_OFFERING_SCHEDULE_DETAIL_NEW_ARR = array();
	
	/* Ticket # 1771 */
	$ethink_delete_inst = array();
	if($_GET['id'] != '') {
		$res = $db->Execute("SELECT INSTRUCTOR FROM S_COURSE_OFFERING WHERE PK_COURSE_OFFERING = '$_GET[id]' AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' ");
		if($res->fields['INSTRUCTOR'] != '' && $res->fields['INSTRUCTOR'] != $_POST['INSTRUCTOR'])
			$ethink_delete_inst[] = $res->fields['INSTRUCTOR'];
	}
	/* Ticket # 1771 */
	
	/* Ticket # 592 */
	$canvays_delete_inst = array();
	if($_GET['id'] != '') {
		$res = $db->Execute("SELECT INSTRUCTOR FROM S_COURSE_OFFERING WHERE PK_COURSE_OFFERING = '$_GET[id]' AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' ");
		if($res->fields['INSTRUCTOR'] != '' && $res->fields['INSTRUCTOR'] != $_POST['INSTRUCTOR'])
			$canvays_delete_inst[] = $res->fields['INSTRUCTOR'];
	}
	/* Ticket # 592 */
	
	//$COURSE_OFFERING['PK_COURSE']  					= $_POST['PK_COURSE']; Ticket # 1458
	//$COURSE_OFFERING['PK_CAMPUS']  					= $_POST['PK_CAMPUS']; Ticket # 1458
	$COURSE_OFFERING['PK_TERM_MASTER']  			= $_POST['PK_TERM_MASTER'];
	$COURSE_OFFERING['INSTRUCTOR']  				= $_POST['INSTRUCTOR'];
	$COURSE_OFFERING['PK_CAMPUS_ROOM']  			= $_POST['PK_CAMPUS_ROOM'];
	$COURSE_OFFERING['CLASS_SIZE']  				= $_POST['CLASS_SIZE'];
	$COURSE_OFFERING['PK_SESSION']  				= $_POST['PK_SESSION'];
	$COURSE_OFFERING['SESSION_NO']  				= $_POST['SESSION_NO'];
	$COURSE_OFFERING['PK_ATTENDANCE_TYPE'] 		 	= $_POST['PK_ATTENDANCE_TYPE'];
	$COURSE_OFFERING['PK_ATTENDANCE_CODE']  		= $_POST['PK_ATTENDANCE_CODE'];
	//$COURSE_OFFERING['OLD_DIAMOND_ID']  			= $_POST['OLD_DIAMOND_ID']; Ticket # 1536
	$COURSE_OFFERING['LMS_ACTIVE']  				= $_POST['LMS_ACTIVE'];
	$COURSE_OFFERING['LMS_CODE']  					= $_POST['LMS_CODE'];
	$COURSE_OFFERING['CO_EXTERNAL_ID']  			= $_POST['CO_EXTERNAL_ID'];
	$COURSE_OFFERING['PK_ATTENDANCE_ACTIVITY_TYPE'] = $_POST['PK_ATTENDANCE_ACTIVITY_TYPE'];
	$COURSE_OFFERING['ROOM_SIZE'] 					= $_POST['ROOM_SIZE']; //Ticket # 1325
	$COURSE_OFFERING['LMS_COURSE_TEMPLATE_ID'] 		= $_POST['LMS_COURSE_TEMPLATE_ID']; //Ticket # 1372
	$COURSE_OFFERING['ACTIVE']  					= $_POST['ACTIVE']; //Ticket # 1458
	
	$OFFERING_SCHEDULE['START_DATE']  		= $_POST['START_DATE'];
	$OFFERING_SCHEDULE['END_DATE']  		= $_POST['END_DATE'];
	$OFFERING_SCHEDULE['DEF_START_TIME']  	= $_POST['DEF_START_TIME'];
	$OFFERING_SCHEDULE['DEF_END_TIME']  	= $_POST['DEF_END_TIME'];
	$OFFERING_SCHEDULE['DEF_HOURS']  		= $_POST['DEF_HOURS'];
	
	if($OFFERING_SCHEDULE['DEF_START_TIME'] != '' && $OFFERING_SCHEDULE['DEF_END_TIME'] != '') {
		$starttimestamp 					= strtotime($OFFERING_SCHEDULE['DEF_START_TIME']);
		$endtimestamp 						= strtotime($OFFERING_SCHEDULE['DEF_END_TIME']);
		//$OFFERING_SCHEDULE['DEF_HOURS'] 	= abs($endtimestamp - $starttimestamp)/3600;
	}
	
	if($OFFERING_SCHEDULE['START_DATE'] != '')
		$OFFERING_SCHEDULE['START_DATE'] = date("Y-m-d",strtotime($OFFERING_SCHEDULE['START_DATE']));
		
	if($OFFERING_SCHEDULE['END_DATE'] != '')
		$OFFERING_SCHEDULE['END_DATE'] = date("Y-m-d",strtotime($OFFERING_SCHEDULE['END_DATE']));
		
	if($OFFERING_SCHEDULE['DEF_START_TIME'] != '')
		$OFFERING_SCHEDULE['DEF_START_TIME'] = date("H:i:s",strtotime($OFFERING_SCHEDULE['DEF_START_TIME']));
		
	if($OFFERING_SCHEDULE['DEF_END_TIME'] != '')
		$OFFERING_SCHEDULE['DEF_END_TIME'] = date("H:i:s",strtotime($OFFERING_SCHEDULE['DEF_END_TIME']));
		
	if($OFFERING_SCHEDULE['DEF_START_TIME'] == '' || $OFFERING_SCHEDULE['DEF_END_TIME'] == '')
		$OFFERING_SCHEDULE['DEF_HOURS'] = '';
		
	$OFFERING_SCHEDULE['SUNDAY']  	= $_POST['SUNDAY'];
	$OFFERING_SCHEDULE['MONDAY']  	= $_POST['MONDAY'];
	$OFFERING_SCHEDULE['TUESDAY']  	= $_POST['TUESDAY'];
	$OFFERING_SCHEDULE['WEDNESDAY'] = $_POST['WEDNESDAY'];
	$OFFERING_SCHEDULE['THURSDAY']  = $_POST['THURSDAY'];
	$OFFERING_SCHEDULE['FRIDAY']  	= $_POST['FRIDAY'];
	$OFFERING_SCHEDULE['SATURDAY']  = $_POST['SATURDAY'];
	
	$OFFERING_SCHEDULE['SUN_ROOM']  = $_POST['SUN_ROOM'];
	$OFFERING_SCHEDULE['MON_ROOM']  = $_POST['MON_ROOM'];
	$OFFERING_SCHEDULE['TUE_ROOM']  = $_POST['TUE_ROOM'];
	$OFFERING_SCHEDULE['WED_ROOM']  = $_POST['WED_ROOM'];
	$OFFERING_SCHEDULE['THU_ROOM']  = $_POST['THU_ROOM'];
	$OFFERING_SCHEDULE['FRI_ROOM']  = $_POST['FRI_ROOM'];
	$OFFERING_SCHEDULE['SAT_ROOM']  = $_POST['SAT_ROOM'];
	
	if($OFFERING_SCHEDULE['SUNDAY'] == 1) {
		$OFFERING_SCHEDULE['SUN_START_TIME'] 	= $_POST['SUN_START_TIME'];
		$OFFERING_SCHEDULE['SUN_END_TIME']  	= $_POST['SUN_END_TIME'];
		$OFFERING_SCHEDULE['SUN_HOURS']  		= $_POST['SUN_HOURS'];
		
		$OFFERING_SCHEDULE['SUN_PK_ATTENDANCE_ACTIVITY_TYPE'] = $_POST['SUN_PK_ATTENDANCE_ACTIVITY_TYPE'];
		
		if($OFFERING_SCHEDULE['SUN_START_TIME'] != '')
			$OFFERING_SCHEDULE['SUN_START_TIME'] = date("H:i:s",strtotime($OFFERING_SCHEDULE['SUN_START_TIME']));
			
		if($OFFERING_SCHEDULE['SUN_END_TIME'] != '')
			$OFFERING_SCHEDULE['SUN_END_TIME'] = date("H:i:s",strtotime($OFFERING_SCHEDULE['SUN_END_TIME']));
			
		if($OFFERING_SCHEDULE['SUN_START_TIME'] == '' || $OFFERING_SCHEDULE['SUN_END_TIME'] == '')
			$OFFERING_SCHEDULE['SUN_HOURS'] = '';
	} else {
		$OFFERING_SCHEDULE['SUN_START_TIME'] 	= '';
		$OFFERING_SCHEDULE['SUN_END_TIME']  	= '';
		$OFFERING_SCHEDULE['SUN_HOURS']  		= '';
		$OFFERING_SCHEDULE['SUN_PK_ATTENDANCE_ACTIVITY_TYPE'] = '';
	}
	
	if($OFFERING_SCHEDULE['MONDAY'] == 1) {
		$OFFERING_SCHEDULE['MON_START_TIME'] 	= $_POST['MON_START_TIME'];
		$OFFERING_SCHEDULE['MON_END_TIME']  	= $_POST['MON_END_TIME'];
		$OFFERING_SCHEDULE['MON_HOURS']  		= $_POST['MON_HOURS'];
		
		$OFFERING_SCHEDULE['MON_PK_ATTENDANCE_ACTIVITY_TYPE'] = $_POST['MON_PK_ATTENDANCE_ACTIVITY_TYPE'];
		
		if($OFFERING_SCHEDULE['MON_START_TIME'] != '')
			$OFFERING_SCHEDULE['MON_START_TIME'] = date("H:i:s",strtotime($OFFERING_SCHEDULE['MON_START_TIME']));
			
		if($OFFERING_SCHEDULE['MON_END_TIME'] != '')
			$OFFERING_SCHEDULE['MON_END_TIME'] = date("H:i:s",strtotime($OFFERING_SCHEDULE['MON_END_TIME']));
			
		if($OFFERING_SCHEDULE['MON_START_TIME'] == '' || $OFFERING_SCHEDULE['MON_END_TIME'] == '')
			$OFFERING_SCHEDULE['MON_HOURS'] = '';
	} else {
		$OFFERING_SCHEDULE['MON_START_TIME'] 	= '';
		$OFFERING_SCHEDULE['MON_END_TIME']  	= '';
		$OFFERING_SCHEDULE['MON_HOURS']  		= '';
		$OFFERING_SCHEDULE['MON_PK_ATTENDANCE_ACTIVITY_TYPE'] = '';
	}
	
	if($OFFERING_SCHEDULE['TUESDAY'] == 1) {
		$OFFERING_SCHEDULE['TUE_START_TIME'] 	= $_POST['TUE_START_TIME'];
		$OFFERING_SCHEDULE['TUE_END_TIME']  	= $_POST['TUE_END_TIME'];
		$OFFERING_SCHEDULE['TUE_HOURS']  		= $_POST['TUE_HOURS'];
		
		$OFFERING_SCHEDULE['TUE_PK_ATTENDANCE_ACTIVITY_TYPE'] = $_POST['TUE_PK_ATTENDANCE_ACTIVITY_TYPE'];
		
		if($OFFERING_SCHEDULE['TUE_START_TIME'] != '')
			$OFFERING_SCHEDULE['TUE_START_TIME'] = date("H:i:s",strtotime($OFFERING_SCHEDULE['TUE_START_TIME']));
			
		if($OFFERING_SCHEDULE['TUE_END_TIME'] != '')
			$OFFERING_SCHEDULE['TUE_END_TIME'] = date("H:i:s",strtotime($OFFERING_SCHEDULE['TUE_END_TIME']));
			
		if($OFFERING_SCHEDULE['TUE_START_TIME'] == '' || $OFFERING_SCHEDULE['TUE_END_TIME'] == '')
			$OFFERING_SCHEDULE['TUE_HOURS'] = '';
	} else {
		$OFFERING_SCHEDULE['TUE_START_TIME'] 	= '';
		$OFFERING_SCHEDULE['TUE_END_TIME']  	= '';
		$OFFERING_SCHEDULE['TUE_HOURS']  		= '';
		$OFFERING_SCHEDULE['TUE_PK_ATTENDANCE_ACTIVITY_TYPE'] = '';
	}
	
	if($OFFERING_SCHEDULE['WEDNESDAY'] == 1) {
		$OFFERING_SCHEDULE['WED_START_TIME'] 	= $_POST['WED_START_TIME'];
		$OFFERING_SCHEDULE['WED_END_TIME']  	= $_POST['WED_END_TIME'];
		$OFFERING_SCHEDULE['WED_HOURS']  		= $_POST['WED_HOURS'];
		
		$OFFERING_SCHEDULE['WED_PK_ATTENDANCE_ACTIVITY_TYPE'] = $_POST['WED_PK_ATTENDANCE_ACTIVITY_TYPE'];
		
		if($OFFERING_SCHEDULE['WED_START_TIME'] != '')
			$OFFERING_SCHEDULE['WED_START_TIME'] = date("H:i:s",strtotime($OFFERING_SCHEDULE['WED_START_TIME']));
			
		if($OFFERING_SCHEDULE['WED_END_TIME'] != '')
			$OFFERING_SCHEDULE['WED_END_TIME'] = date("H:i:s",strtotime($OFFERING_SCHEDULE['WED_END_TIME']));
			
		if($OFFERING_SCHEDULE['WED_START_TIME'] == '' || $OFFERING_SCHEDULE['WED_END_TIME'] == '')
			$OFFERING_SCHEDULE['WED_HOURS'] = '';
	} else {
		$OFFERING_SCHEDULE['WED_START_TIME'] 	= '';
		$OFFERING_SCHEDULE['WED_END_TIME']  	= '';
		$OFFERING_SCHEDULE['WED_HOURS']  		= '';
		$OFFERING_SCHEDULE['WED_PK_ATTENDANCE_ACTIVITY_TYPE'] = '';
	}
	
	if($OFFERING_SCHEDULE['THURSDAY'] == 1) {
		$OFFERING_SCHEDULE['THU_START_TIME'] 	= $_POST['THU_START_TIME'];
		$OFFERING_SCHEDULE['THU_END_TIME']  	= $_POST['THU_END_TIME'];
		$OFFERING_SCHEDULE['THU_HOURS']  		= $_POST['THU_HOURS'];
		
		$OFFERING_SCHEDULE['THU_PK_ATTENDANCE_ACTIVITY_TYPE'] = $_POST['THU_PK_ATTENDANCE_ACTIVITY_TYPE'];
		
		if($OFFERING_SCHEDULE['THU_START_TIME'] != '')
			$OFFERING_SCHEDULE['THU_START_TIME'] = date("H:i:s",strtotime($OFFERING_SCHEDULE['THU_START_TIME']));
			
		if($OFFERING_SCHEDULE['THU_END_TIME'] != '')
			$OFFERING_SCHEDULE['THU_END_TIME'] = date("H:i:s",strtotime($OFFERING_SCHEDULE['THU_END_TIME']));
			
		if($OFFERING_SCHEDULE['THU_START_TIME'] == '' || $OFFERING_SCHEDULE['THU_END_TIME'] == '')
			$OFFERING_SCHEDULE['THU_HOURS'] = '';
	} else {
		$OFFERING_SCHEDULE['THU_START_TIME'] 	= '';
		$OFFERING_SCHEDULE['THU_END_TIME']  	= '';
		$OFFERING_SCHEDULE['THU_HOURS']  		= '';
		$OFFERING_SCHEDULE['THU_PK_ATTENDANCE_ACTIVITY_TYPE'] = '';
	}
	
	if($OFFERING_SCHEDULE['FRIDAY'] == 1) {
		$OFFERING_SCHEDULE['FRI_START_TIME'] 	= $_POST['FRI_START_TIME'];
		$OFFERING_SCHEDULE['FRI_END_TIME']  	= $_POST['FRI_END_TIME'];
		$OFFERING_SCHEDULE['FRI_HOURS']  		= $_POST['FRI_HOURS'];
		
		$OFFERING_SCHEDULE['FRI_PK_ATTENDANCE_ACTIVITY_TYPE'] = $_POST['FRI_PK_ATTENDANCE_ACTIVITY_TYPE'];
		
		if($OFFERING_SCHEDULE['FRI_START_TIME'] != '')
			$OFFERING_SCHEDULE['FRI_START_TIME'] = date("H:i:s",strtotime($OFFERING_SCHEDULE['FRI_START_TIME']));
			
		if($OFFERING_SCHEDULE['FRI_END_TIME'] != '')
			$OFFERING_SCHEDULE['FRI_END_TIME'] = date("H:i:s",strtotime($OFFERING_SCHEDULE['FRI_END_TIME']));
			
		if($OFFERING_SCHEDULE['FRI_START_TIME'] == '' || $OFFERING_SCHEDULE['FRI_END_TIME'] == '')
			$OFFERING_SCHEDULE['FRI_HOURS'] = '';
	} else {
		$OFFERING_SCHEDULE['FRI_START_TIME'] 	= '';
		$OFFERING_SCHEDULE['FRI_END_TIME']  	= '';
		$OFFERING_SCHEDULE['FRI_HOURS']  		= '';
		$OFFERING_SCHEDULE['FRI_PK_ATTENDANCE_ACTIVITY_TYPE'] = '';
	}
	
	if($OFFERING_SCHEDULE['SATURDAY'] == 1) {
		$OFFERING_SCHEDULE['SAT_START_TIME'] 	= $_POST['SAT_START_TIME'];
		$OFFERING_SCHEDULE['SAT_END_TIME']  	= $_POST['SAT_END_TIME'];
		$OFFERING_SCHEDULE['SAT_HOURS']  		= $_POST['SAT_HOURS'];
		
		$OFFERING_SCHEDULE['SAT_PK_ATTENDANCE_ACTIVITY_TYPE'] = $_POST['SAT_PK_ATTENDANCE_ACTIVITY_TYPE'];
		
		if($OFFERING_SCHEDULE['SAT_START_TIME'] != '')
			$OFFERING_SCHEDULE['SAT_START_TIME'] = date("H:i:s",strtotime($OFFERING_SCHEDULE['SAT_START_TIME']));
			
		if($OFFERING_SCHEDULE['SAT_END_TIME'] != '')
			$OFFERING_SCHEDULE['SAT_END_TIME'] = date("H:i:s",strtotime($OFFERING_SCHEDULE['SAT_END_TIME']));
			
		if($OFFERING_SCHEDULE['SAT_START_TIME'] == '' || $OFFERING_SCHEDULE['SAT_END_TIME'] == '')
			$OFFERING_SCHEDULE['SAT_HOURS'] = '';
	} else {
		$OFFERING_SCHEDULE['SAT_START_TIME'] 	= '';
		$OFFERING_SCHEDULE['SAT_END_TIME']  	= '';
		$OFFERING_SCHEDULE['SAT_HOURS']  		= '';
		$OFFERING_SCHEDULE['SAT_PK_ATTENDANCE_ACTIVITY_TYPE'] = '';
	}
	
	$OFFERING_SCHEDULE['SCHEDULE_ON_HOLIDAY']  		= $_POST['SCHEDULE_ON_HOLIDAY'];
	$OFFERING_SCHEDULE['OVERWRITE_SCHEDULE_DATE'] 	= $_POST['OVERWRITE_SCHEDULE_DATE'];
	$OFFERING_SCHEDULE['PK_COURSE']  				= $_POST['PK_COURSE']; //Ticket # 1458
	
	if($_GET['id'] == ''){
		$COURSE_OFFERING['PK_COURSE']  					= $_POST['PK_COURSE']; //Ticket # 1458
		$COURSE_OFFERING['PK_CAMPUS']  					= $_POST['PK_CAMPUS']; //Ticket # 1458
		$COURSE_OFFERING['PK_COURSE_OFFERING_STATUS']  	= 1;
		$COURSE_OFFERING['PK_ACCOUNT']  				= $_SESSION['PK_ACCOUNT'];
		$COURSE_OFFERING['CREATED_BY']  				= $_SESSION['PK_USER'];
		$COURSE_OFFERING['CREATED_ON']  				= date("Y-m-d H:i");
		db_perform('S_COURSE_OFFERING', $COURSE_OFFERING, 'insert');
		$PK_COURSE_OFFERING = $db->insert_ID();
		
		$res = $db->Execute("SELECT * FROM S_COURSE_DEFAULT_SCHEDULE WHERE PK_COURSE = '$_POST[PK_COURSE]' AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' AND PK_SESSION = '$COURSE_OFFERING[PK_SESSION]' "); //Ticket # 1458
		if($res->RecordCount() > 0) {
			$OFFERING_SCHEDULE['SUNDAY']  	= $res->fields['SUNDAY'];
			$OFFERING_SCHEDULE['MONDAY']  	= $res->fields['MONDAY'];
			$OFFERING_SCHEDULE['TUESDAY']  	= $res->fields['TUESDAY'];
			$OFFERING_SCHEDULE['WEDNESDAY'] = $res->fields['WEDNESDAY'];
			$OFFERING_SCHEDULE['THURSDAY']  = $res->fields['THURSDAY'];
			$OFFERING_SCHEDULE['FRIDAY']  	= $res->fields['FRIDAY'];
			$OFFERING_SCHEDULE['SATURDAY']  = $res->fields['SATURDAY'];

			$OFFERING_SCHEDULE['SUN_ROOM']  = $res->fields['SUN_ROOM'];
			$OFFERING_SCHEDULE['MON_ROOM']  = $res->fields['MON_ROOM'];
			$OFFERING_SCHEDULE['TUE_ROOM']  = $res->fields['TUE_ROOM'];
			$OFFERING_SCHEDULE['WED_ROOM']  = $res->fields['WED_ROOM'];
			$OFFERING_SCHEDULE['THU_ROOM']  = $res->fields['THU_ROOM'];
			$OFFERING_SCHEDULE['FRI_ROOM']  = $res->fields['FRI_ROOM'];
			$OFFERING_SCHEDULE['SAT_ROOM']  = $res->fields['SAT_ROOM'];

			$OFFERING_SCHEDULE['SUN_START_TIME'] 	= $res->fields['SUN_START_TIME'];
			$OFFERING_SCHEDULE['SUN_END_TIME']  	= $res->fields['SUN_END_TIME'];
			$OFFERING_SCHEDULE['SUN_HOURS']  		= $res->fields['SUN_HOURS'];

			$OFFERING_SCHEDULE['MON_START_TIME'] 	= $res->fields['MON_START_TIME'];
			$OFFERING_SCHEDULE['MON_END_TIME']  	= $res->fields['MON_END_TIME'];
			$OFFERING_SCHEDULE['MON_HOURS']  		= $res->fields['MON_HOURS'];

			$OFFERING_SCHEDULE['TUE_START_TIME'] 	= $res->fields['TUE_START_TIME'];
			$OFFERING_SCHEDULE['TUE_END_TIME']  	= $res->fields['TUE_END_TIME'];
			$OFFERING_SCHEDULE['TUE_HOURS']  		= $res->fields['TUE_HOURS'];

			$OFFERING_SCHEDULE['WED_START_TIME'] 	= $res->fields['WED_START_TIME'];
			$OFFERING_SCHEDULE['WED_END_TIME']  	= $res->fields['WED_END_TIME'];
			$OFFERING_SCHEDULE['WED_HOURS']  		= $res->fields['WED_HOURS'];

			$OFFERING_SCHEDULE['THU_START_TIME'] 	= $res->fields['THU_START_TIME'];
			$OFFERING_SCHEDULE['THU_END_TIME']  	= $res->fields['THU_END_TIME'];
			$OFFERING_SCHEDULE['THU_HOURS']  		= $res->fields['THU_HOURS'];

			$OFFERING_SCHEDULE['FRI_START_TIME'] 	= $res->fields['FRI_START_TIME'];
			$OFFERING_SCHEDULE['FRI_END_TIME']  	= $res->fields['FRI_END_TIME'];
			$OFFERING_SCHEDULE['FRI_HOURS']  		= $res->fields['FRI_HOURS'];

			$OFFERING_SCHEDULE['SAT_START_TIME'] 	= $res->fields['SAT_START_TIME'];
			$OFFERING_SCHEDULE['SAT_END_TIME']  	= $res->fields['SAT_END_TIME'];
			$OFFERING_SCHEDULE['SAT_HOURS']  		= $res->fields['SAT_HOURS'];
			
			$OFFERING_SCHEDULE['SUN_PK_ATTENDANCE_ACTIVITY_TYPE']  	= $res->fields['SUN_PK_ATTENDANCE_ACTIVITY_TYPE'];
			$OFFERING_SCHEDULE['MON_PK_ATTENDANCE_ACTIVITY_TYPE']  	= $res->fields['MON_PK_ATTENDANCE_ACTIVITY_TYPE'];
			$OFFERING_SCHEDULE['TUE_PK_ATTENDANCE_ACTIVITY_TYPE']  	= $res->fields['TUE_PK_ATTENDANCE_ACTIVITY_TYPE'];
			$OFFERING_SCHEDULE['WED_PK_ATTENDANCE_ACTIVITY_TYPE']  	= $res->fields['WED_PK_ATTENDANCE_ACTIVITY_TYPE'];
			$OFFERING_SCHEDULE['THU_PK_ATTENDANCE_ACTIVITY_TYPE']  	= $res->fields['THU_PK_ATTENDANCE_ACTIVITY_TYPE'];
			$OFFERING_SCHEDULE['FRI_PK_ATTENDANCE_ACTIVITY_TYPE']  	= $res->fields['FRI_PK_ATTENDANCE_ACTIVITY_TYPE'];
			$OFFERING_SCHEDULE['SAT_PK_ATTENDANCE_ACTIVITY_TYPE']  	= $res->fields['SAT_PK_ATTENDANCE_ACTIVITY_TYPE'];
		}
		
		$OFFERING_SCHEDULE['PK_COURSE_OFFERING']  	= $PK_COURSE_OFFERING;
		$OFFERING_SCHEDULE['PK_ACCOUNT']  			= $_SESSION['PK_ACCOUNT'];
		$OFFERING_SCHEDULE['CREATED_BY']  			= $_SESSION['PK_USER'];
		$OFFERING_SCHEDULE['CREATED_ON']  			= date("Y-m-d H:i");
		db_perform('S_COURSE_OFFERING_SCHEDULE', $OFFERING_SCHEDULE, 'insert');
		$PK_COURSE_OFFERING_SCHEDULE = $db->insert_ID();
		
	} else {
		/* Ticket # 1238  */
		$res = $db->Execute("SELECT INSTRUCTOR, PK_TERM_MASTER FROM S_COURSE_OFFERING WHERE PK_COURSE_OFFERING = '$_GET[id]' AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]'  "); //Ticket # 1438
		$CUR_INSTRUCTOR 	= $res->fields['INSTRUCTOR'];
		$CUR_PK_TERM_MASTER = $res->fields['PK_TERM_MASTER']; //Ticket # 1438
		/* Ticket # 1238  */
		
		$PK_COURSE_OFFERING 							= $_GET['id'];
		$COURSE_OFFERING['PK_COURSE_OFFERING_STATUS']  	= $_POST['PK_COURSE_OFFERING_STATUS'];
		$COURSE_OFFERING['EDITED_BY']   				= $_SESSION['PK_USER'];
		$COURSE_OFFERING['EDITED_ON']   				= date("Y-m-d H:i");
		db_perform('S_COURSE_OFFERING', $COURSE_OFFERING, 'update'," PK_COURSE_OFFERING = '$PK_COURSE_OFFERING' AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' ");
		
		$OFFERING_SCHEDULE['EDITED_BY']   = $_SESSION['PK_USER'];
		$OFFERING_SCHEDULE['EDITED_ON']   = date("Y-m-d H:i");
		db_perform('S_COURSE_OFFERING_SCHEDULE', $OFFERING_SCHEDULE, 'update'," PK_COURSE_OFFERING = '$PK_COURSE_OFFERING' AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' ");
		
		/* Ticket # 1438 */
		if($CUR_PK_TERM_MASTER != $_POST['PK_TERM_MASTER'] && $_POST['UPDATE_STUD_TERM'] == 1){
			$db->Execute("UPDATE S_STUDENT_COURSE SET PK_TERM_MASTER = '$_POST[PK_TERM_MASTER]' WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' AND PK_COURSE_OFFERING = '$PK_COURSE_OFFERING' AND PK_COURSE_OFFERING > 0");
		}
		/* Ticket # 1438 */
		
		$res = $db->Execute("SELECT PK_COURSE_OFFERING_SCHEDULE FROM S_COURSE_OFFERING_SCHEDULE WHERE PK_COURSE_OFFERING = '$PK_COURSE_OFFERING' AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' "); 
		
		$PK_COURSE_OFFERING_SCHEDULE = $res->fields['PK_COURSE_OFFERING_SCHEDULE'];
	}

	foreach($_POST['ASSISTANT'] as $ASSISTANT){
		$res_ass = $db->Execute("select PK_COURSE_OFFERING_ASSISTANT from S_COURSE_OFFERING_ASSISTANT WHERE PK_COURSE_OFFERING = '$PK_COURSE_OFFERING' AND ASSISTANT='$ASSISTANT' ");
		if($res_ass->RecordCount() == 0) {
			$COURSE_OFFERING_ASSISTANT['PK_COURSE_OFFERING'] 	= $PK_COURSE_OFFERING;
			$COURSE_OFFERING_ASSISTANT['ASSISTANT'] 			= $ASSISTANT;
			$COURSE_OFFERING_ASSISTANT['PK_ACCOUNT'] 			= $_SESSION['PK_ACCOUNT'];
			$COURSE_OFFERING_ASSISTANT['CREATED_BY'] 			= $_SESSION['PK_USER'];
			$COURSE_OFFERING_ASSISTANT['CREATED_ON'] 			= date("Y-m-d H:i:s");
			db_perform('S_COURSE_OFFERING_ASSISTANT', $COURSE_OFFERING_ASSISTANT, 'insert');
			$PK_COURSE_OFFERING_ASSISTANT_ARR[] = $db->insert_ID();
		} else
			$PK_COURSE_OFFERING_ASSISTANT_ARR[] = $res_ass->fields['PK_COURSE_OFFERING_ASSISTANT'];
	}
	
	if(!empty($PK_COURSE_OFFERING_ASSISTANT_ARR))
		$cond = " AND PK_COURSE_OFFERING_ASSISTANT NOT IN (".implode(",",$PK_COURSE_OFFERING_ASSISTANT_ARR).") ";
		
	/* Ticket # 592 */
	$res_add = $db->Execute("SELECT ASSISTANT FROM S_COURSE_OFFERING_ASSISTANT WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' AND PK_COURSE_OFFERING = '$PK_COURSE_OFFERING' $cond "); 
	while (!$res_add->EOF) {
		$canvays_delete_inst[] = $res_add->fields['ASSISTANT'];
		
		$res_add->MoveNext();
	}
	/* Ticket # 592 */
	
	/* Ticket # 1771 */
	$res_add = $db->Execute("SELECT ASSISTANT FROM S_COURSE_OFFERING_ASSISTANT WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' AND PK_COURSE_OFFERING = '$PK_COURSE_OFFERING' $cond "); 
	while (!$res_add->EOF) {
		$ethink_delete_inst[] = $res_add->fields['ASSISTANT'];
		
		$res_add->MoveNext();
	}
	/* Ticket # 1771 */
	
	$db->Execute("DELETE FROM S_COURSE_OFFERING_ASSISTANT WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' AND PK_COURSE_OFFERING = '$PK_COURSE_OFFERING' $cond "); 
	
	$i = 0;
	$PK_COURSE_OFFERING_SCHEDULE_DETAIL_COMPLETED_ARR = array();
	foreach($_POST['SCHEDULE_HID'] as $HID){
		$SCHEDULE_DETAIL = array();
		
		$SCHEDULE_DETAIL['SCHEDULE_DATE']  					= $_POST['SCHEDULE_DATE'][$i];
		$SCHEDULE_DETAIL['START_TIME']  					= $_POST['SCHEDULE_START_TIME'][$i];
		$SCHEDULE_DETAIL['END_TIME']  						= $_POST['SCHEDULE_END_TIME'][$i];
		$SCHEDULE_DETAIL['HOURS']  							= $_POST['SCHEDULE_HOURS'][$i];
		$SCHEDULE_DETAIL['PK_CAMPUS_ROOM']  				= $_POST['SCHEDULE_PK_CAMPUS_ROOM'][$i];
		$SCHEDULE_DETAIL['PK_ATTENDANCE_ACTIVITY_TYPES']  	= $_POST['SCHEDULE_PK_ATTENDANCE_ACTIVITY_TYPES'][$i];
		$SCHEDULE_DETAIL['COMPLETED']  						= $_POST['COMPLETED_'.$HID];
		$SCHEDULE_DETAIL['PK_COURSE']  						= $_POST['PK_COURSE']; //Ticket # 1458
		
		if($SCHEDULE_DETAIL['HOURS'] == '' && ($SCHEDULE_DETAIL['START_TIME'] != '' && $SCHEDULE_DETAIL['END_TIME'] != '')) {
			$starttimestamp 			= strtotime($SCHEDULE_DETAIL['START_TIME']);
			$endtimestamp 				= strtotime($SCHEDULE_DETAIL['END_TIME']);
			$SCHEDULE_DETAIL['HOURS'] 	= abs($endtimestamp - $starttimestamp)/3600;
		}
		
		if($SCHEDULE_DETAIL['SCHEDULE_DATE'] != '')
			$SCHEDULE_DETAIL['SCHEDULE_DATE'] = date("Y-m-d",strtotime($SCHEDULE_DETAIL['SCHEDULE_DATE']));
			
		if($SCHEDULE_DETAIL['START_TIME'] != '')
			$SCHEDULE_DETAIL['START_TIME'] = date("H:i:s",strtotime($SCHEDULE_DETAIL['START_TIME']));
			
		if($SCHEDULE_DETAIL['END_TIME'] != '')
			$SCHEDULE_DETAIL['END_TIME'] = date("H:i:s",strtotime($SCHEDULE_DETAIL['END_TIME']));
		
		$mark_as_comp = 0;
		$PK_COURSE_OFFERING_SCHEDULE_DETAIL11 = $_POST['PK_COURSE_OFFERING_SCHEDULE_DETAIL'][$i];
		if($PK_COURSE_OFFERING_SCHEDULE_DETAIL11 == ''){
			if($SCHEDULE_DETAIL['COMPLETED'] == 1)
				$mark_as_comp = 1;
		} else {
			$res12 = $db->Execute("SELECT COMPLETED FROM S_COURSE_OFFERING_SCHEDULE_DETAIL WHERE PK_COURSE_OFFERING_SCHEDULE_DETAIL = '$PK_COURSE_OFFERING_SCHEDULE_DETAIL11' AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' "); 
			if($res12->fields['COMPLETED'] == 0 && $SCHEDULE_DETAIL['COMPLETED'] == 1)
				$mark_as_comp = 1;
		}
		
		if($_POST['PK_COURSE_OFFERING_SCHEDULE_DETAIL'][$i] == ''){
			$SCHEDULE_DETAIL['PK_COURSE_OFFERING_SCHEDULE'] = $PK_COURSE_OFFERING_SCHEDULE;
			$SCHEDULE_DETAIL['PK_COURSE_OFFERING']  		= $PK_COURSE_OFFERING;
			$SCHEDULE_DETAIL['PK_ACCOUNT']  				= $_SESSION['PK_ACCOUNT'];
			$SCHEDULE_DETAIL['CREATED_BY']  				= $_SESSION['PK_USER'];
			$SCHEDULE_DETAIL['CREATED_ON']  				= date("Y-m-d H:i");
			db_perform('S_COURSE_OFFERING_SCHEDULE_DETAIL', $SCHEDULE_DETAIL, 'insert');
			
			$PK_COURSE_OFFERING_SCHEDULE_DETAIL11			= $db->insert_ID();
			$PK_COURSE_OFFERING_SCHEDULE_DETAIL_ARR[] 		= $PK_COURSE_OFFERING_SCHEDULE_DETAIL11;
			$PK_COURSE_OFFERING_SCHEDULE_DETAIL_NEW_ARR[] 	= $PK_COURSE_OFFERING_SCHEDULE_DETAIL11;
		} else {
			$PK_COURSE_OFFERING_SCHEDULE_DETAIL11 = $_POST['PK_COURSE_OFFERING_SCHEDULE_DETAIL'][$i];
			$SCHEDULE_DETAIL['EDITED_BY']	= $_SESSION['PK_USER'];
			$SCHEDULE_DETAIL['EDITED_ON']	= date("Y-m-d H:i");
			db_perform('S_COURSE_OFFERING_SCHEDULE_DETAIL', $SCHEDULE_DETAIL, 'update'," PK_COURSE_OFFERING_SCHEDULE_DETAIL = ".$PK_COURSE_OFFERING_SCHEDULE_DETAIL11." AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' ");

			$PK_COURSE_OFFERING_SCHEDULE_DETAIL_ARR[] = $PK_COURSE_OFFERING_SCHEDULE_DETAIL11;
		}
		
		if($mark_as_comp == 1)
			$PK_COURSE_OFFERING_SCHEDULE_DETAIL_COMPLETED_ARR[] = $PK_COURSE_OFFERING_SCHEDULE_DETAIL11;
		
		$i++;
	}
	
	$DELETED_SCHEDULE = array();
	$cond = "";
	if(!empty($PK_COURSE_OFFERING_SCHEDULE_DETAIL_ARR))
		$cond = " AND PK_COURSE_OFFERING_SCHEDULE_DETAIL NOT IN (".implode(",",$PK_COURSE_OFFERING_SCHEDULE_DETAIL_ARR).") ";
	
	$res = $db->Execute("SELECT PK_COURSE_OFFERING_SCHEDULE_DETAIL FROM S_COURSE_OFFERING_SCHEDULE_DETAIL WHERE PK_COURSE_OFFERING = '$PK_COURSE_OFFERING' AND PK_ACCOUNT='$_SESSION[PK_ACCOUNT]' $cond ");
	while (!$res->EOF) {
		$PK_COURSE_OFFERING_SCHEDULE_DETAIL = $res->fields['PK_COURSE_OFFERING_SCHEDULE_DETAIL'];
		$DELETED_SCHEDULE[]					= $PK_COURSE_OFFERING_SCHEDULE_DETAIL;
		
		$db->Execute("DELETE FROM S_COURSE_OFFERING_SCHEDULE_DETAIL WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' AND PK_COURSE_OFFERING = '$PK_COURSE_OFFERING' AND PK_COURSE_OFFERING_SCHEDULE_DETAIL = '$PK_COURSE_OFFERING_SCHEDULE_DETAIL' "); 
		
		$res->MoveNext();
	}

	//if($_POST['OVERWRITE_STUDENT_SCHEDULE'] == 1) {
		//delte schedule from student
		if(!empty($DELETED_SCHEDULE)){
			$DELETED_SCHEDULE = implode(",",$DELETED_SCHEDULE);

			$res_sch = $db->Execute("DELETE FROM S_STUDENT_SCHEDULE WHERE PK_COURSE_OFFERING_SCHEDULE_DETAIL IN ($DELETED_SCHEDULE) AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' "); 
		}
	
		$res_stu = $db->Execute("SELECT PK_STUDENT_MASTER,PK_STUDENT_COURSE, PK_STUDENT_ENROLLMENT,INACTIVE FROM S_STUDENT_COURSE WHERE PK_COURSE_OFFERING = '$PK_COURSE_OFFERING' AND PK_ACCOUNT='$_SESSION[PK_ACCOUNT]' ");
		while (!$res_stu->EOF) {
			$PK_STUDENT_MASTER 		= $res_stu->fields['PK_STUDENT_MASTER'];
			$PK_STUDENT_COURSE 		= $res_stu->fields['PK_STUDENT_COURSE'];
			$PK_STUDENT_ENROLLMENT 	= $res_stu->fields['PK_STUDENT_ENROLLMENT'];
			$INACTIVE 				= $res_stu->fields['INACTIVE'];
			
			//insert new schedule to student
			$PK_COURSE_OFFERING_SCHEDULE_DETAIL_NEW = '';
			if(!empty($PK_COURSE_OFFERING_SCHEDULE_DETAIL_NEW_ARR)){
				$PK_COURSE_OFFERING_SCHEDULE_DETAIL_NEW = implode(",",$PK_COURSE_OFFERING_SCHEDULE_DETAIL_NEW_ARR);
				
				$res_sch = $db->Execute("SELECT * FROM S_COURSE_OFFERING_SCHEDULE_DETAIL WHERE PK_COURSE_OFFERING_SCHEDULE_DETAIL IN ($PK_COURSE_OFFERING_SCHEDULE_DETAIL_NEW) AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' ORDER BY SCHEDULE_DATE ASC, START_TIME ASC"); 
				while (!$res_sch->EOF) {
					$STUDENT_SCHEDULE = array();
					$STUDENT_SCHEDULE['SCHEDULE_DATE'] 	 	 	 			= $res_sch->fields['SCHEDULE_DATE'];
					$STUDENT_SCHEDULE['START_TIME'] 	 	 	 			= $res_sch->fields['START_TIME'];
					$STUDENT_SCHEDULE['END_TIME'] 	 	 		 			= $res_sch->fields['END_TIME'];
					$STUDENT_SCHEDULE['HOURS'] 	 	 			 			= $res_sch->fields['HOURS'];
					$STUDENT_SCHEDULE['PK_CAMPUS_ROOM'] 	 	 			= $res_sch->fields['PK_CAMPUS_ROOM'];
					$STUDENT_SCHEDULE['PK_STUDENT_COURSE'] 	 	 			= $PK_STUDENT_COURSE;
					$STUDENT_SCHEDULE['PK_COURSE_OFFERING_SCHEDULE_DETAIL']	= $res_sch->fields['PK_COURSE_OFFERING_SCHEDULE_DETAIL'];;
					$STUDENT_SCHEDULE['PK_STUDENT_ENROLLMENT'] 	 			= $PK_STUDENT_ENROLLMENT;
					$STUDENT_SCHEDULE['PK_STUDENT_MASTER'] 	 	 			= $PK_STUDENT_MASTER;
					$STUDENT_SCHEDULE['PK_SCHEDULE_TYPE'] 	 	 			= 1;
					$STUDENT_SCHEDULE['PK_ACCOUNT'] 			 			= $_SESSION['PK_ACCOUNT'];
					$STUDENT_SCHEDULE['CREATED_BY']  			 			= $_SESSION['PK_USER'];
					$STUDENT_SCHEDULE['CREATED_ON']  			 			= date("Y-m-d H:i");
					db_perform('S_STUDENT_SCHEDULE', $STUDENT_SCHEDULE, 'insert');
					
					if($INACTIVE != '' && $INACTIVE != '0000-00-00') {
						$date = $INACTIVE;
						make_attendance_inactive($PK_STUDENT_COURSE,$date,''); //Ticket # 1661
					}
	
					$res_sch->MoveNext();
				}
			}

			//update existing schedule
			$cond = "";
			if($PK_COURSE_OFFERING_SCHEDULE_DETAIL_NEW != '')
				$cond = " PK_COURSE_OFFERING_SCHEDULE_DETAIL NOT IN ($PK_COURSE_OFFERING_SCHEDULE_DETAIL_NEW) ";
			
			$res_sch = $db->Execute("SELECT * FROM S_COURSE_OFFERING_SCHEDULE_DETAIL WHERE PK_COURSE_OFFERING='$PK_COURSE_OFFERING' AND PK_ACCOUNT='$_SESSION[PK_ACCOUNT]' $cond "); 
			while (!$res_sch->EOF) {
				$STUDENT_SCHEDULE = array();
				$STUDENT_SCHEDULE['SCHEDULE_DATE'] 	= $res_sch->fields['SCHEDULE_DATE'];
				$STUDENT_SCHEDULE['START_TIME'] 	= $res_sch->fields['START_TIME'];
				$STUDENT_SCHEDULE['END_TIME'] 	 	= $res_sch->fields['END_TIME'];
				$STUDENT_SCHEDULE['HOURS'] 	 	 	= $res_sch->fields['HOURS'];
				$STUDENT_SCHEDULE['PK_CAMPUS_ROOM'] = $res_sch->fields['PK_CAMPUS_ROOM'];
				$STUDENT_SCHEDULE['EDITED_BY']  	= $_SESSION['PK_USER'];
				$STUDENT_SCHEDULE['EDITED_ON']  	= date("Y-m-d H:i");
				
				db_perform('S_STUDENT_SCHEDULE', $STUDENT_SCHEDULE, 'update'," PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' AND PK_COURSE_OFFERING_SCHEDULE_DETAIL = '".$res_sch->fields['PK_COURSE_OFFERING_SCHEDULE_DETAIL']."' ");
				
				$STUDENT_ATTENDANCE['COMPLETED'] 					 = $res_sch->fields['COMPLETED'];
				$STUDENT_ATTENDANCE['PK_ATTENDANCE_ACTIVITY_TYPESS'] = $res_sch->fields['PK_ATTENDANCE_ACTIVITY_TYPES'];
				db_perform('S_STUDENT_ATTENDANCE', $STUDENT_ATTENDANCE, 'update'," PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' AND PK_COURSE_OFFERING_SCHEDULE_DETAIL = '".$res_sch->fields['PK_COURSE_OFFERING_SCHEDULE_DETAIL']."' ");
				
				$res_sch->MoveNext();
			}
			
			$res_stu->MoveNext();
		}

		///////////////
		//mark all student attendance as complete
		//echo "<pre>";print_r($PK_COURSE_OFFERING_SCHEDULE_DETAIL_COMPLETED_ARR);
		if(!empty($PK_COURSE_OFFERING_SCHEDULE_DETAIL_COMPLETED_ARR)) {
			foreach($PK_COURSE_OFFERING_SCHEDULE_DETAIL_COMPLETED_ARR as $PK_COURSE_OFFERING_SCHEDULE_DETAIL) {
				$res_stu = $db->Execute("SELECT PK_STUDENT_SCHEDULE,HOURS, PK_STUDENT_MASTER, PK_STUDENT_ENROLLMENT  FROM S_STUDENT_SCHEDULE WHERE PK_COURSE_OFFERING_SCHEDULE_DETAIL = '$PK_COURSE_OFFERING_SCHEDULE_DETAIL' AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' "); 
				
				$res_def_att_typ = $db->Execute("select PK_ATTENDANCE_ACTIVITY_TYPES from S_COURSE_OFFERING_SCHEDULE_DETAIL WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' AND PK_COURSE_OFFERING_SCHEDULE_DETAIL = '$PK_COURSE_OFFERING_SCHEDULE_DETAIL' ");
				
				while (!$res_stu->EOF) {
					$PK_STUDENT_SCHEDULE = $res_stu->fields['PK_STUDENT_SCHEDULE'];
					
					$res_att = $db->Execute("SELECT PK_STUDENT_ATTENDANCE,PK_ATTENDANCE_CODE FROM S_STUDENT_ATTENDANCE WHERE PK_STUDENT_SCHEDULE = '$PK_STUDENT_SCHEDULE' AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' "); 
					if($res_att->RecordCount() == 0) {
						$ATTENDANCE_DETAIL = array();
						$ATTENDANCE_DETAIL['PK_ATTENDANCE_ACTIVITY_TYPESS'] 		= $res_def_att_typ->fields['PK_ATTENDANCE_ACTIVITY_TYPES'];
						$ATTENDANCE_DETAIL['PK_STUDENT_MASTER'] 					= $res_stu->fields['PK_STUDENT_MASTER'];
						$ATTENDANCE_DETAIL['PK_STUDENT_ENROLLMENT'] 				= $res_stu->fields['PK_STUDENT_ENROLLMENT'];
						$ATTENDANCE_DETAIL['PK_STUDENT_SCHEDULE'] 					= $PK_STUDENT_SCHEDULE;
						$ATTENDANCE_DETAIL['ATTENDANCE_HOURS'] 						= $res_stu->fields['HOURS'];
						$ATTENDANCE_DETAIL['PK_ATTENDANCE_CODE'] 					= $COURSE_OFFERING['PK_ATTENDANCE_CODE'];
						$ATTENDANCE_DETAIL['PK_COURSE_OFFERING_SCHEDULE_DETAIL'] 	= $PK_COURSE_OFFERING_SCHEDULE_DETAIL;
						$ATTENDANCE_DETAIL['COMPLETED']   							= 1;
						$ATTENDANCE_DETAIL['PK_ACCOUNT']  							= $_SESSION['PK_ACCOUNT'];;
						$ATTENDANCE_DETAIL['CREATED_BY']  							= $_SESSION['PK_USER'];
						$ATTENDANCE_DETAIL['CREATED_ON']  							= date("Y-m-d H:i");
						db_perform('S_STUDENT_ATTENDANCE', $ATTENDANCE_DETAIL, 'insert');
					} else {
						$ATTENDANCE_DETAIL = array();
						if($res_att->fields['PK_ATTENDANCE_CODE'] != 7) {
							$ATTENDANCE_DETAIL['ATTENDANCE_HOURS'] 		= $res_stu->fields['HOURS'];
							$ATTENDANCE_DETAIL['PK_ATTENDANCE_CODE'] 	= $COURSE_OFFERING['PK_ATTENDANCE_CODE'];
						}
						$ATTENDANCE_DETAIL['PK_ATTENDANCE_ACTIVITY_TYPESS']	= $res_def_att_typ->fields['PK_ATTENDANCE_ACTIVITY_TYPES'];
						$ATTENDANCE_DETAIL['COMPLETED']   					= 1;
						$ATTENDANCE_DETAIL['PK_ACCOUNT']  					= $_SESSION['PK_ACCOUNT'];;
						$ATTENDANCE_DETAIL['EDITED_BY']  					= $_SESSION['PK_USER'];
						$ATTENDANCE_DETAIL['EDITED_ON']  					= date("Y-m-d H:i");
						db_perform('S_STUDENT_ATTENDANCE', $ATTENDANCE_DETAIL, 'update'," PK_STUDENT_ATTENDANCE = '".$res_att->fields['PK_STUDENT_ATTENDANCE']."' ");
					}
					
					$res_stu->MoveNext();
				}
			}
		}
		/////////////////
	//}

	////////////////////////////////
	$i = 0;

	foreach($_POST['GRADE_CUNT'] as $GRADE_CUNT){
		$COURSE_OFFERING_GRADE = array();
		$COURSE_OFFERING_GRADE['GRADE_ORDER'] 		 = $_POST['GRADE_ORDER'][$i]; //Ticket # 1290
		$COURSE_OFFERING_GRADE['CODE'] 				 = $_POST['CODE'][$i];
		$COURSE_OFFERING_GRADE['DESCRIPTION'] 		 = $_POST['DESCRIPTION'][$i];
		$COURSE_OFFERING_GRADE['PK_GRADE_BOOK_TYPE'] = $_POST['PK_GRADE_BOOK_TYPE'][$i];
		$COURSE_OFFERING_GRADE['DATE'] 				 = $_POST['DATE'][$i];
		//$COURSE_OFFERING_GRADE['PERIOD'] 			 = $_POST['PERIOD'][$i];
		$COURSE_OFFERING_GRADE['POINTS'] 			 = $_POST['POINTS'][$i];
		$COURSE_OFFERING_GRADE['WEIGHT'] 			 = $_POST['WEIGHT'][$i];
		$COURSE_OFFERING_GRADE['WEIGHTED_POINTS'] 	 = $_POST['POINTS'][$i] * $_POST['WEIGHT'][$i];
		$COURSE_OFFERING_GRADE['SORT_ORDER'] 		 = $_POST['SORT_ORDER'][$i];
		
		if($COURSE_OFFERING_GRADE['DATE'] != '')
			$COURSE_OFFERING_GRADE['DATE'] = date("Y-m-d",strtotime($COURSE_OFFERING_GRADE['DATE']));
		else
			$COURSE_OFFERING_GRADE['DATE'] = '';

		if($_POST['PK_COURSE_OFFERING_GRADE'][$i] == ''){
			$COURSE_OFFERING_GRADE['PK_COURSE_OFFERING']  	= $PK_COURSE_OFFERING;
			$COURSE_OFFERING_GRADE['PK_ACCOUNT']  			= $_SESSION['PK_ACCOUNT'];
			$COURSE_OFFERING_GRADE['CREATED_BY']  			= $_SESSION['PK_USER'];
			$COURSE_OFFERING_GRADE['CREATED_ON']  			= date("Y-m-d H:i");
			db_perform('S_COURSE_OFFERING_GRADE', $COURSE_OFFERING_GRADE, 'insert');
			$PK_COURSE_OFFERING_GRADE = $db->insert_ID();

			//To Store S_COURSE_OFFERING_GRADE history start 27 june
			$COURSE_OFFERING_GRADE['PK_COURSE_OFFERING_GRADE'] = $PK_COURSE_OFFERING_GRADE;
			$COURSE_OFFERING_GRADE['CREATED_ON']  			= date("Y-m-d H:i:s");
			db_perform('S_COURSE_OFFERING_GRADE_HISTROY', $COURSE_OFFERING_GRADE, 'insert');
			//To Store S_COURSE_OFFERING_GRADE history end 2 7 june
			
			$PK_COURSE_OFFERING_GRADE_ARR[] = $PK_COURSE_OFFERING_GRADE;
			
		} else {
			$PK_COURSE_OFFERING_GRADE = $_POST['PK_COURSE_OFFERING_GRADE'][$i];
			$COURSE_OFFERING_GRADE['EDITED_BY'] = $_SESSION['PK_USER'];
			$COURSE_OFFERING_GRADE['EDITED_ON'] = date("Y-m-d H:i");
			db_perform('S_COURSE_OFFERING_GRADE', $COURSE_OFFERING_GRADE, 'update'," PK_COURSE_OFFERING_GRADE = '$PK_COURSE_OFFERING_GRADE' AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' AND PK_COURSE_OFFERING = '$PK_COURSE_OFFERING' ");
			
			//To update S_COURSE_OFFERING_GRADE history start 27 june
			$COURSE_OFFERING_GRADE['PK_COURSE_OFFERING_GRADE'] = $PK_COURSE_OFFERING_GRADE;
			$COURSE_OFFERING_GRADE['PK_ACCOUNT'] = $_SESSION['PK_ACCOUNT'];
			$COURSE_OFFERING_GRADE['PK_COURSE_OFFERING'] = $PK_COURSE_OFFERING;
			$COURSE_OFFERING_GRADE['CREATED_ON']  			= date("Y-m-d H:i:s");
			db_perform('S_COURSE_OFFERING_GRADE', $COURSE_OFFERING_GRADE, 'insert'); //DIAM-785
			db_perform('S_COURSE_OFFERING_GRADE_HISTROY', $COURSE_OFFERING_GRADE, 'insert');
			//To update S_COURSE_OFFERING_GRADE history end 27 june

			$PK_COURSE_OFFERING_GRADE_ARR[] = $PK_COURSE_OFFERING_GRADE;
		}
		
		$i++;
	}

	$recal_grade = 0;
	$cond = "";
	// If there is grad stup data empty then it will prevent deleting data from the S_COURSE_OFFERING_GRADE and S_STUDENT_GRADE table.
	/*if(!empty($PK_COURSE_OFFERING_GRADE_ARR)){
		
	$cond = " AND PK_COURSE_OFFERING_GRADE NOT IN (".implode(",",$PK_COURSE_OFFERING_GRADE_ARR).")";	
	$res_grade = $db->Execute("SELECT PK_COURSE_OFFERING_GRADE FROM S_COURSE_OFFERING_GRADE WHERE PK_COURSE_OFFERING = '$PK_COURSE_OFFERING' AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' $cond ");
	while (!$res_grade->EOF) {
		$PK_COURSE_OFFERING_GRADE = $res_grade->fields['PK_COURSE_OFFERING_GRADE'];
		$db->Execute("DELETE from S_COURSE_OFFERING_GRADE WHERE PK_ACCOUNT='$_SESSION[PK_ACCOUNT]' AND PK_COURSE_OFFERING='$PK_COURSE_OFFERING' AND PK_COURSE_OFFERING_GRADE='$PK_COURSE_OFFERING_GRADE'");
		
		//delete grade from student
		$db->Execute("DELETE from S_STUDENT_GRADE WHERE PK_ACCOUNT='$_SESSION[PK_ACCOUNT]' AND PK_COURSE_OFFERING='$PK_COURSE_OFFERING' AND PK_COURSE_OFFERING_GRADE='$PK_COURSE_OFFERING_GRADE'");
		
		$recal_grade = 1;
		$res_grade->MoveNext();
	}
	////////////////////////////////

}*/
//$recal_grade = 1;

	
	/**
	 * insert student grade in S_STUDENT_GRADE and checked the duplication student grades 
	 * 
	 */
	$res_grade = $db->Execute("SELECT PK_COURSE_OFFERING_GRADE FROM S_COURSE_OFFERING_GRADE WHERE PK_COURSE_OFFERING = '$PK_COURSE_OFFERING' AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]'  ");
	while (!$res_grade->EOF) {
		$PK_COURSE_OFFERING_GRADE = $res_grade->fields['PK_COURSE_OFFERING_GRADE'];
		
		$res_stu = $db->Execute("select PK_STUDENT_MASTER,PK_STUDENT_ENROLLMENT FROM S_STUDENT_COURSE WHERE PK_COURSE_OFFERING = '$PK_COURSE_OFFERING' AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' ");
		while (!$res_stu->EOF) {
			$PK_STUDENT_MASTER 		= $res_stu->fields['PK_STUDENT_MASTER'];
			$PK_STUDENT_ENROLLMENT 	= $res_stu->fields['PK_STUDENT_ENROLLMENT'];
			$res_stu_grade = $db->Execute("select PK_STUDENT_GRADE FROM S_STUDENT_GRADE WHERE PK_STUDENT_MASTER = '$PK_STUDENT_MASTER' AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' AND PK_COURSE_OFFERING_GRADE = '$PK_COURSE_OFFERING_GRADE' ");
			if($res_stu_grade->RecordCount() == 0) {
				$STUDENT_GRADE['PK_COURSE_OFFERING_GRADE'] 	= $PK_COURSE_OFFERING_GRADE;
				$STUDENT_GRADE['PK_COURSE_OFFERING']		= $PK_COURSE_OFFERING;
				$STUDENT_GRADE['PK_STUDENT_ENROLLMENT'] 	= $PK_STUDENT_ENROLLMENT;
				$STUDENT_GRADE['PK_STUDENT_MASTER'] 	 	= $PK_STUDENT_MASTER;
				$STUDENT_GRADE['PK_ACCOUNT'] 			 	= $_SESSION['PK_ACCOUNT'];
				$STUDENT_GRADE['CREATED_BY']  			 	= $_SESSION['PK_USER'];
				$STUDENT_GRADE['CREATED_ON']  			 	= date("Y-m-d H:i");
				db_perform('S_STUDENT_GRADE', $STUDENT_GRADE, 'insert');
				$PK_STUDENT_GRADE = $db->insert_ID();

				//To Store STUDENT_GRADE history start 27 june
				$STUDENT_GRADE['PK_STUDENT_GRADE'] = $PK_STUDENT_GRADE;
				$STUDENT_GRADE['CREATED_ON']  			 	= date("Y-m-d H:i:s");
				db_perform('S_STUDENT_GRADE_HISTROY', $STUDENT_GRADE, 'insert');
				//To Store STUDENT_GRADE history end 27 june

				$recal_grade = 1;
			}

			$res_stu->MoveNext();
		}
		
		$res_grade->MoveNext();
	}

	////////////////////////////////
	///////calc grade input/////////
	if($_POST['SAVE_CONTINUE'] == 2 || $_POST['SAVE_CONTINUE'] == 3)
	{
		$i = 0;
		$SCH_CREATED_ON= date("Y-m-d H:i:s"); // DIAM-785
		foreach($_POST['GRADE_INPUT_PK_STUDENT_COURSE_1'] as $PK_STUDENT_COURSE) {
			$res_course_unit = $db->Execute("SELECT UNITS FROM S_COURSE, S_COURSE_OFFERING, S_STUDENT_COURSE WHERE PK_STUDENT_COURSE = '$PK_STUDENT_COURSE' AND S_STUDENT_COURSE.PK_COURSE_OFFERING = S_COURSE_OFFERING.PK_COURSE_OFFERING AND S_COURSE_OFFERING.PK_COURSE = S_COURSE.PK_COURSE AND S_COURSE.PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]'"); 
	
			$STUDENT_COURSE = array();
			$STUDENT_COURSE['COURSE_UNITS'] 			= $res_course_unit->fields['UNITS'];
			$STUDENT_COURSE['FINAL_TOTAL_OBTAINED'] 	= $_POST['GRADE_INPUT_FINAL_TOTAL_OBTAINED'][$i];
			$STUDENT_COURSE['FINAL_MAX_TOTAL'] 			= $_POST['GRADE_INPUT_FINAL_MAX_TOTAL'][$i];
			$STUDENT_COURSE['FINAL_TOTAL_GRADE'] 		= $_POST['GRADE_INPUT_FINAL_TOTAL_GRADE'][$i];
			
			$STUDENT_COURSE['CURRENT_TOTAL_OBTAINED'] 	= $_POST['GRADE_INPUT_CURRENT_TOTAL_OBTAINED'][$i];
			$STUDENT_COURSE['CURRENT_MAX_TOTAL'] 		= $_POST['GRADE_INPUT_CURRENT_MAX_TOTAL'][$i];
			$STUDENT_COURSE['CURRENT_TOTAL_GRADE'] 		= $_POST['GRADE_INPUT_CURRENT_TOTAL_GRADE'][$i];
			
			$STUDENT_COURSE['CURRENT_TOTAL_PK_GRADE_SCALE_DETAIL'] 	= $_POST['GRADE_INPUT_CURRENT_TOTAL_PK_GRADE_SCALE_DETAIL'][$i];
			$STUDENT_COURSE['FINAL_TOTAL_PK_GRADE_SCALE_DETAIL'] 	= $_POST['GRADE_INPUT_FINAL_TOTAL_PK_GRADE_SCALE_DETAIL'][$i];
			
			
			if($_POST['GRADE_FINAL_GRADE'] != '' && $_POST['GRADE_FINAL_GRADE'] != 0) {
				$STUDENT_COURSE['FINAL_GRADE'] = $_POST['GRADE_FINAL_GRADE'][$i];
				
				$res_tc = $db->Execute("SELECT FINAL_GRADE FROM S_STUDENT_COURSE WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' AND PK_STUDENT_COURSE = '$PK_STUDENT_COURSE' "); 
				$CUR_PK_GRADE 	= $res_tc->fields['FINAL_GRADE'];
				$flag 			= 0;
				if($CUR_PK_GRADE != $STUDENT_COURSE['FINAL_GRADE']) {
					$res_grade_data = $db->Execute("SELECT * FROM S_GRADE WHERE PK_GRADE = '$STUDENT_COURSE[FINAL_GRADE]' "); 
					$STUDENT_COURSE['FINAL_GRADE_GRADE'] 				= $res_grade_data->fields['GRADE'];
					$STUDENT_COURSE['FINAL_GRADE_NUMBER_GRADE'] 		= $res_grade_data->fields['NUMBER_GRADE'];
					$STUDENT_COURSE['FINAL_GRADE_CALCULATE_GPA'] 		= $res_grade_data->fields['CALCULATE_GPA'];
					$STUDENT_COURSE['FINAL_GRADE_UNITS_ATTEMPTED'] 		= $res_grade_data->fields['UNITS_ATTEMPTED'];
					$STUDENT_COURSE['FINAL_GRADE_UNITS_COMPLETED'] 		= $res_grade_data->fields['UNITS_COMPLETED'];
					$STUDENT_COURSE['FINAL_GRADE_UNITS_IN_PROGRESS'] 	= $res_grade_data->fields['UNITS_IN_PROGRESS'];
					$STUDENT_COURSE['FINAL_GRADE_WEIGHTED_GRADE_CALC'] 	= $res_grade_data->fields['WEIGHTED_GRADE_CALC'];
					$STUDENT_COURSE['FINAL_GRADE_RETAKE_UPDATE'] 		= $res_grade_data->fields['RETAKE_UPDATE'];
					//echo "aaaa";exit;
					
					$flag = 1;
				}
			}
			
			db_perform('S_STUDENT_COURSE', $STUDENT_COURSE, 'update'," PK_STUDENT_COURSE = '$PK_STUDENT_COURSE' AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' ");

			//DIAM-785
			$res_ssc = $db->Execute("SELECT PK_STUDENT_MASTER,PK_STUDENT_ENROLLMENT,PK_COURSE_OFFERING FROM S_STUDENT_COURSE WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' AND PK_STUDENT_COURSE = '$PK_STUDENT_COURSE' "); 
			$STUDENT_COURSE['PK_STUDENT_MASTER'] = $res_ssc->fields['PK_STUDENT_MASTER'];
			$STUDENT_COURSE['PK_STUDENT_ENROLLMENT'] = $res_ssc->fields['PK_STUDENT_ENROLLMENT'];			
			$STUDENT_COURSE['PK_COURSE_OFFERING'] = $res_ssc->fields['PK_COURSE_OFFERING'];			
			$STUDENT_COURSE['PK_ACCOUNT'] = $_SESSION['PK_ACCOUNT'];
			$STUDENT_COURSE['PK_TERM_MASTER'] = $_POST['PK_TERM_MASTER'];	
			$STUDENT_COURSE['PK_STUDENT_COURSE'] = $PK_STUDENT_COURSE;
			$STUDENT_COURSE['CREATED_ON']  			= $SCH_CREATED_ON;
			$STUDENT_COURSE['EDITED_BY'] = $_SESSION['PK_USER'];
			db_perform('S_STUDENT_COURSE_HISTROY', $STUDENT_COURSE, 'insert');
			//DIAM-785

			if($flag == 1) {
				$res_noti = $db->Execute("SELECT PK_EMAIL_TEMPLATE,PK_TEXT_TEMPLATE FROM S_NOTIFICATION_SETTINGS WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' AND PK_EVENT_TYPE = 9");
				if($res_noti->RecordCount() > 0) {
					if($res_noti->fields['PK_EMAIL_TEMPLATE'] > 0) {
						send_final_grade_posted_mail($PK_STUDENT_COURSE,$res_noti->fields['PK_EMAIL_TEMPLATE']);
					}
					
					if($res_noti->fields['PK_TEXT_TEMPLATE'] > 0) {
						send_final_grade_posted_text($PK_STUDENT_COURSE,$res_noti->fields['PK_TEXT_TEMPLATE']);
					}
				}
			}
		
			$i++;
		}
		
		$i = 0;
		foreach($_POST['GRADE_INPUT_PK_STUDENT_GRADE'] as $PK_STUDENT_GRADE) {
			$STUDENT_GRADE = array();
			$STUDENT_GRADE['POINTS'] = $_POST['GRADE_INPUT_POINTS'][$i];
			db_perform('S_STUDENT_GRADE', $STUDENT_GRADE, 'update'," PK_STUDENT_GRADE = '$PK_STUDENT_GRADE' AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' ");

			//To update S_STUDENT_GRADE history start	27 june		
			$res_SSG = $db->Execute("SELECT PK_STUDENT_ENROLLMENT,PK_STUDENT_MASTER,PK_COURSE_OFFERING_GRADE FROM `S_STUDENT_GRADE` WHERE `PK_STUDENT_GRADE` = '$PK_STUDENT_GRADE' AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]'");

			$STUDENT_GRADE['PK_STUDENT_GRADE'] = $PK_STUDENT_GRADE;
			$STUDENT_GRADE['PK_COURSE_OFFERING_GRADE']  = $res_SSG->fields['PK_COURSE_OFFERING_GRADE'];
			$STUDENT_GRADE['PK_COURSE_OFFERING']		= $PK_COURSE_OFFERING;
			$STUDENT_GRADE['PK_STUDENT_ENROLLMENT'] 	= $res_SSG->fields['PK_STUDENT_ENROLLMENT'];
			$STUDENT_GRADE['PK_STUDENT_MASTER'] 	 	= $res_SSG->fields['PK_STUDENT_MASTER'];
			$STUDENT_GRADE['PK_ACCOUNT'] = $_SESSION['PK_ACCOUNT'];
			$STUDENT_GRADE['CREATED_ON']  			= date("Y-m-d H:i:s");
			$STUDENT_GRADE['EDITED_BY'] = $_SESSION['PK_USER'];
			db_perform('S_STUDENT_GRADE_HISTROY', $STUDENT_GRADE, 'insert');
			//To update S_STUDENT_GRADE history end 27 june
			
			$i++;
		}

		$actual_URL = $_SERVER['HTTP_HOST'];
		if(($_SESSION['PK_ACCOUNT']==72 || $_SESSION['PK_ACCOUNT']==73) && ($actual_URL=='d3.diamondsis.com' || $actual_URL=='uat-74.diamondsis.io'))
		{
			$recal_grade=1; 
		}
}

	if($recal_grade == 1) {
		require_once("function_calc_student_grade.php"); 
		$res_stu = $db->Execute("select PK_STUDENT_COURSE, PK_STUDENT_MASTER FROM S_STUDENT_COURSE WHERE PK_STUDENT_MASTER = S_STUDENT_COURSE.PK_STUDENT_MASTER AND PK_COURSE_OFFERING = '$PK_COURSE_OFFERING' AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]'");
		while (!$res_stu->EOF) {
			$PK_STUDENT_COURSE = $res_stu->fields['PK_STUDENT_COURSE'];
			$PK_STUDENT_MASTER = $res_stu->fields['PK_STUDENT_MASTER'];
			
			$PK_STUDENT_GRADE 	= '';
			$POINTS 			= '';
			 $res_grade = $db->Execute("SELECT PK_COURSE_OFFERING_GRADE FROM S_COURSE_OFFERING_GRADE WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' AND PK_COURSE_OFFERING = '$PK_COURSE_OFFERING' ORDER BY PK_COURSE_OFFERING_GRADE ASC ");
			while (!$res_grade->EOF) { 
				$PK_COURSE_OFFERING_GRADE = $res_grade->fields['PK_COURSE_OFFERING_GRADE']; 
				$res_stu_grade = $db->Execute("SELECT PK_STUDENT_GRADE,POINTS FROM S_STUDENT_GRADE WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' AND PK_COURSE_OFFERING_GRADE = '$PK_COURSE_OFFERING_GRADE' AND PK_STUDENT_MASTER = '$PK_STUDENT_MASTER' "); 
				if($res_stu_grade->fields['POINTS'] != ''){
					if($PK_STUDENT_GRADE != '')
						$PK_STUDENT_GRADE .= ',';
					
					$PK_STUDENT_GRADE .= $res_stu_grade->fields['PK_STUDENT_GRADE'];
					
					if($POINTS != '')
						$POINTS .= ',';
					
					$POINTS .= $res_stu_grade->fields['POINTS'];
				}
				
				$res_grade->MoveNext();
			}
			
			calc_stu_grade($POINTS,$PK_STUDENT_GRADE,$PK_STUDENT_COURSE,$PK_STUDENT_MASTER,1);
			
			$res_stu->MoveNext();
		}
	}
	
	////////////////////////////////
	
	if($_POST['SAVE_CONTINUE'] == 4 || $_POST['SAVE_CONTINUE'] == 5){
		$i = 0;
		$SCH_CREATED_ON= date("Y-m-d H:i:s"); // DIAM-785
		foreach($_POST['GRADE_INPUT_PK_STUDENT_COURSE'] as $PK_STUDENT_COURSE){
			
			$flag1 = 0; //ticket #652
			$res_course_unit = $db->Execute("SELECT UNITS FROM S_COURSE, S_COURSE_OFFERING, S_STUDENT_COURSE WHERE PK_STUDENT_COURSE = '$PK_STUDENT_COURSE' AND S_STUDENT_COURSE.PK_COURSE_OFFERING = S_COURSE_OFFERING.PK_COURSE_OFFERING AND S_COURSE_OFFERING.PK_COURSE = S_COURSE.PK_COURSE AND S_COURSE.PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]'"); 
			
			$STUDENT_COURSE = array();
			$STUDENT_COURSE['COURSE_UNITS'] 						= $res_course_unit->fields['UNITS'];
			$STUDENT_COURSE['FINAL_GRADE'] 							= $_POST['GRADE_INPUT_GRADE'][$i];
			$STUDENT_COURSE['PK_COURSE_OFFERING_STUDENT_STATUS'] 	= $_POST['GRADE_PK_COURSE_OFFERING_STUDENT_STATUS'][$i];
			$STUDENT_COURSE['INACTIVE'] 							= $_POST['GRADE_INPUT_INACTIVE'][$i]; //ticket #1156
			$STUDENT_COURSE['RETURN_DATE'] 							= $_POST['GRADE_INPUT_RETURN_DATE'][$i];
			$STUDENT_COURSE['MIDPOINT_GRADE'] 						= $_POST['GRADE_INPUT_MIDPOINT_GRADE'][$i];
			$STUDENT_COURSE['NUMERIC_GRADE'] 						= $_POST['GRADE_INPUT_NUMERIC_GRADE'][$i];
			
			$res_tc = $db->Execute("SELECT FINAL_GRADE FROM S_STUDENT_COURSE WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' AND PK_STUDENT_COURSE = '$PK_STUDENT_COURSE' "); 
			$CUR_PK_GRADE = $res_tc->fields['FINAL_GRADE'];
			if($CUR_PK_GRADE != $STUDENT_COURSE['FINAL_GRADE']) {
				$res_grade_data = $db->Execute("SELECT * FROM S_GRADE WHERE PK_GRADE = '$STUDENT_COURSE[FINAL_GRADE]' "); 
				$STUDENT_COURSE['FINAL_GRADE_GRADE'] 				= $res_grade_data->fields['GRADE'];
				$STUDENT_COURSE['FINAL_GRADE_NUMBER_GRADE'] 		= $res_grade_data->fields['NUMBER_GRADE'];
				$STUDENT_COURSE['FINAL_GRADE_CALCULATE_GPA'] 		= $res_grade_data->fields['CALCULATE_GPA'];
				$STUDENT_COURSE['FINAL_GRADE_UNITS_ATTEMPTED'] 		= $res_grade_data->fields['UNITS_ATTEMPTED'];
				$STUDENT_COURSE['FINAL_GRADE_UNITS_COMPLETED'] 		= $res_grade_data->fields['UNITS_COMPLETED'];
				$STUDENT_COURSE['FINAL_GRADE_UNITS_IN_PROGRESS'] 	= $res_grade_data->fields['UNITS_IN_PROGRESS'];
				$STUDENT_COURSE['FINAL_GRADE_WEIGHTED_GRADE_CALC'] 	= $res_grade_data->fields['WEIGHTED_GRADE_CALC'];
				$STUDENT_COURSE['FINAL_GRADE_RETAKE_UPDATE'] 		= $res_grade_data->fields['RETAKE_UPDATE'];
				
				$flag1 = 1;//ticket #652
			}
			
			//ticket #1156
			$res1 = $db->Execute("SELECT PK_COURSE,S_STUDENT_COURSE.PK_COURSE_OFFERING,S_STUDENT_COURSE.PK_COURSE_OFFERING_STUDENT_STATUS, PK_COURSE_OFFERING_STUDENT_STATUS_MASTER, INACTIVE, RETURN_DATE 
			FROM 
			S_STUDENT_COURSE 
			LEFT JOIN M_COURSE_OFFERING_STUDENT_STATUS ON M_COURSE_OFFERING_STUDENT_STATUS.PK_COURSE_OFFERING_STUDENT_STATUS = S_STUDENT_COURSE.PK_COURSE_OFFERING_STUDENT_STATUS
			, S_COURSE_OFFERING 
			WHERE PK_STUDENT_COURSE = '$PK_STUDENT_COURSE' AND S_STUDENT_COURSE.PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' AND S_COURSE_OFFERING.PK_COURSE_OFFERING = S_STUDENT_COURSE.PK_COURSE_OFFERING");
			$CUR_PK_COURSE 								= $res1->fields['PK_COURSE'];
			$CUR_PK_COURSE_OFFERING 					= $res1->fields['PK_COURSE_OFFERING'];
			$CUR_PK_COURSE_OFFERING_STUDENT_STATUS 		= $res1->fields['PK_COURSE_OFFERING_STUDENT_STATUS'];
			$CUR_INACTIVE 								= $res1->fields['INACTIVE'];
			$CUR_RETURN_DATE 							= $res1->fields['RETURN_DATE'];
			
			if($CUR_INACTIVE == '0000-00-00')
				$CUR_INACTIVE = '';
				
			if($CUR_RETURN_DATE == '0000-00-00')
				$CUR_RETURN_DATE = '';
			
			if($STUDENT_COURSE['INACTIVE'] != '')
				$STUDENT_COURSE['INACTIVE'] = date("Y-m-d",strtotime($STUDENT_COURSE['INACTIVE']));
				
			if($STUDENT_COURSE['RETURN_DATE'] != '')
				$STUDENT_COURSE['RETURN_DATE'] = date("Y-m-d",strtotime($STUDENT_COURSE['RETURN_DATE']));
				
			db_perform('S_STUDENT_COURSE', $STUDENT_COURSE, 'update'," PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' AND PK_STUDENT_COURSE = '$PK_STUDENT_COURSE' ");
			//ticket #1156

			// //DIAM-785  find creating lead when insert data in s_student scourse INSERT CODE REMAIN
			$STUDENT_COURSE['PK_ACCOUNT'] = $_SESSION['PK_ACCOUNT'];
			$STUDENT_COURSE['PK_TERM_MASTER'] = $_POST['PK_TERM_MASTER'];
			$STUDENT_COURSE['PK_STUDENT_COURSE'] = $PK_STUDENT_COURSE;
			$STUDENT_COURSE['CREATED_ON']  			= $SCH_CREATED_ON;
			$STUDENT_COURSE['EDITED_BY'] = $_SESSION['PK_USER'];
			$res_ssc = $db->Execute("SELECT PK_STUDENT_MASTER,PK_STUDENT_ENROLLMENT,PK_COURSE_OFFERING FROM S_STUDENT_COURSE WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' AND PK_STUDENT_COURSE = '$PK_STUDENT_COURSE' "); 
			$STUDENT_COURSE['PK_STUDENT_MASTER'] = $res_ssc->fields['PK_STUDENT_MASTER'];
			$STUDENT_COURSE['PK_STUDENT_ENROLLMENT'] = $res_ssc->fields['PK_STUDENT_ENROLLMENT'];			
			$STUDENT_COURSE['PK_COURSE_OFFERING'] = $res_ssc->fields['PK_COURSE_OFFERING'];
			db_perform('S_STUDENT_COURSE_HISTROY', $STUDENT_COURSE, 'insert');
			// //DIAM-785

			//ticket #652
			if($flag1 == 1) {
				$res_noti = $db->Execute("SELECT PK_EMAIL_TEMPLATE,PK_TEXT_TEMPLATE FROM S_NOTIFICATION_SETTINGS WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' AND PK_EVENT_TYPE = 9");
				if($res_noti->RecordCount() > 0) {
					if($res_noti->fields['PK_EMAIL_TEMPLATE'] > 0) {
						send_final_grade_posted_mail($PK_STUDENT_COURSE,$res_noti->fields['PK_EMAIL_TEMPLATE']);
					}
					
					if($res_noti->fields['PK_TEXT_TEMPLATE'] > 0) {
						send_final_grade_posted_text($PK_STUDENT_COURSE,$res_noti->fields['PK_TEXT_TEMPLATE']);
					}
				}
			}
			//ticket #652

			////////////////	
			$res1 = $db->Execute("SELECT PK_COURSE_OFFERING_STUDENT_STATUS_MASTER FROM  M_COURSE_OFFERING_STUDENT_STATUS WHERE PK_COURSE_OFFERING_STUDENT_STATUS = '$STUDENT_COURSE[PK_COURSE_OFFERING_STUDENT_STATUS]' AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' ");
			$PK_COURSE_OFFERING_STUDENT_STATUS_MASTER 	= $res1->fields['PK_COURSE_OFFERING_STUDENT_STATUS_MASTER'];

			if(($STUDENT_COURSE['PK_COURSE_OFFERING_STUDENT_STATUS'] != $CUR_PK_COURSE_OFFERING_STUDENT_STATUS && $PK_COURSE_OFFERING_STUDENT_STATUS_MASTER == 2) || ($CUR_INACTIVE == '' && $STUDENT_COURSE['INACTIVE'] != '') || ($CUR_INACTIVE != $STUDENT_COURSE['INACTIVE'] && $STUDENT_COURSE['INACTIVE'] != '' && $CUR_INACTIVE != '') ) { //Ticket # 1661
				//echo $STUDENT_COURSE['PK_COURSE_OFFERING_STUDENT_STATUS'].' --- '.$CUR_PK_COURSE_OFFERING_STUDENT_STATUS.' --- '.$PK_COURSE_OFFERING_STUDENT_STATUS_MASTER;exit;				
				
				if($STUDENT_COURSE['INACTIVE'] != '')
					$date = $STUDENT_COURSE['INACTIVE'];
				else
					$date = date("Y-m-d");
				make_attendance_inactive($PK_STUDENT_COURSE,$date,'');//Ticket # 1661
			}
			
			//ticket #1156
			if($CUR_RETURN_DATE != $STUDENT_COURSE['RETURN_DATE'] && $STUDENT_COURSE['RETURN_DATE'] != ''){
				make_attendance_active($PK_STUDENT_COURSE,$_GET['id'],$STUDENT_COURSE['RETURN_DATE'], 1); //Ticket # 1661
			} else if($CUR_INACTIVE != '' && $STUDENT_COURSE['INACTIVE'] == '' && $_POST['GRADE_INPUT_INACTIVE_RESET_ATTENDANCE_CODE'][$i] == 1){ /* Ticket # 1661 */
				make_attendance_active($PK_STUDENT_COURSE,$_GET['id'],$CUR_INACTIVE, 1); //Ticket # 1661
			} /* Ticket # 1661 */
			//ticket #1156
			
			///////////
			
			$i++;
		}
	} else {
		if($_GET['id'] != ''){
			$field = "";
			if($_POST['POST_GRADE_TYPE'] == 1) {
				//Final Total
				$field = ",FINAL_TOTAL_OBTAINED AS TOTAL_OBTAINED, FINAL_MAX_TOTAL as MAX_TOTAL";
			} else if($_POST['POST_GRADE_TYPE'] == 2) {
				//Current Total
				$field = ",CURRENT_TOTAL_OBTAINED AS TOTAL_OBTAINED, CURRENT_MAX_TOTAL as MAX_TOTAL";
			}
			if($_POST['POST_GRADE_TYPE'] == 1 || $_POST['POST_GRADE_TYPE'] == 2) {
				$res1 = $db->Execute("SELECT PK_STUDENT_COURSE $field FROM S_STUDENT_COURSE WHERE PK_COURSE_OFFERING = '$_GET[id]' AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' ");
				while (!$res1->EOF) { 
					$PK_STUDENT_COURSE = $res1->fields['PK_STUDENT_COURSE'];
					
					$PERCENTAGE = number_format_value_checker(($res1->fields['TOTAL_OBTAINED'] / $res1->fields['MAX_TOTAL'] * 100),2);
					$PERCENTAGE = str_replace(",","",$PERCENTAGE);
					
					$STUDENT_COURSE = array();
					$STUDENT_COURSE['NUMERIC_GRADE'] = $PERCENTAGE;
					db_perform('S_STUDENT_COURSE', $STUDENT_COURSE, 'update'," PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' AND PK_STUDENT_COURSE = '$PK_STUDENT_COURSE' ");
					
					$res1->MoveNext();
				}
			}
		}

	}
	////////////////////////////////
	
	/* Ticket # 592 */
	//print_r($canvays_delete_inst);exit;
	$res_ethink_1	= $db->Execute("SELECT ENABLE_CANVAS FROM Z_ACCOUNT WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' "); 
	$res_canvas 	= $db->Execute("SELECT CANVAS_ID FROM S_COURSE_OFFERING_CANVAS WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' AND PK_COURSE_OFFERING = '$_GET[id]' AND CANVAS_ID != '' ");  
	if($_GET['id'] != '' && $res_ethink_1->fields['ENABLE_CANVAS'] == 1 && $res_canvas->RecordCount() > 0 && !empty($canvays_delete_inst)) {
		require_once("../global/canvas.php");
		
		$BATCH_ID = time();
		foreach($canvays_delete_inst as $PK_EMPLOYEE_MASTER){
			$res_type = $db->Execute("select PK_EMPLOYEE_COURSE_CANVAS FROM S_EMPLOYEE_COURSE_CANVAS WHERE PK_COURSE_OFFERING = '$_GET[id]' AND PK_EMPLOYEE_MASTER = '$PK_EMPLOYEE_MASTER' AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' AND SUCCESS = 1 AND CANVAS_ID != '' AND ACTIVE = 1");
			if($res_type->RecordCount() > 0)
				delete_instructor_from_course_offering($_GET['id'],$PK_EMPLOYEE_MASTER,$_SESSION['PK_ACCOUNT'],$res_type->fields['PK_EMPLOYEE_COURSE_CANVAS'],$BATCH_ID);
		}
	}
	/* Ticket # 592 */
	
	/* Ticket # 1771 */
	$res_ethink_1	= $db->Execute("SELECT ENABLE_ETHINK FROM Z_ACCOUNT WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' ");  
	$res_ethink 	= $db->Execute("SELECT ETHINK_ID FROM S_COURSE_OFFERING_ETHINK WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' AND PK_COURSE_OFFERING = '$_GET[id]' AND ETHINK_ID != '' ");  
	if($_GET['id'] != '' && $res_ethink_1->fields['ENABLE_ETHINK'] == 1 && $res_ethink->RecordCount() > 0 && !empty($ethink_delete_inst)) {
		require_once("../global/ethink.php");
		
		$BATCH_ID = time();
		foreach($ethink_delete_inst as $PK_EMPLOYEE_MASTER){
			$res_type = $db->Execute("select PK_EMPLOYEE_COURSE_ETHINK FROM S_EMPLOYEE_COURSE_ETHINK WHERE PK_COURSE_OFFERING = '$_GET[id]' AND PK_EMPLOYEE_MASTER = '$PK_EMPLOYEE_MASTER' AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' AND SUCCESS = 1 AND ACTIVE = 1");
			if($res_type->RecordCount() > 0)
				delete_instructor_from_course_offering_ethink($_GET['id'],$PK_EMPLOYEE_MASTER,$_SESSION['PK_ACCOUNT'],$BATCH_ID);
		}
	}
	/* Ticket # 1771 */
	
	if($_POST['SAVE_CONTINUE'] == 1 || $_POST['SAVE_CONTINUE'] == 2 || $_POST['SAVE_CONTINUE'] == 4)
		header("location:course_offering?tab=".str_replace("#","",$_POST['current_tab'])."&id=".$PK_COURSE_OFFERING);
	else
		header("location:manage_course_offering");
	exit;
}

if($_GET['id'] == ''){
	$PK_COURSE 					= '';
	$PK_CAMPUS 					= '';
	$PK_TERM_MASTER 			= '';
	$INSTRUCTOR 				= '';
	$PK_CAMPUS_ROOM 			= '';
	$CLASS_SIZE 				= '';
	$PK_SESSION 				= '';
	$SESSION_NO 				= '';
	$PK_ATTENDANCE_TYPE 		= '';
	$PK_ATTENDANCE_CODE 		= '';
	$OLD_DIAMOND_ID				= '';
	$PK_COURSE_OFFERING_STATUS 	= '';
	$ROOM_SIZE 					= ''; //Ticket # 1325
	$LMS_COURSE_TEMPLATE_ID		= ''; //Ticket # 1372
	$ACTIVE 					= 1; //Ticket # 1458
	
	$LMS_ACTIVE 				 = '';
	$LMS_CODE					 = '';
	$CO_EXTERNAL_ID 			 = '';
	$PK_ATTENDANCE_ACTIVITY_TYPE = '';
	
	$START_DATE 	= '';
	$END_DATE 		= '';
	$DEF_START_TIME = '';
	$DEF_END_TIME 	= '';
	$DEF_HOURS 		= '';
	
	$SUNDAY 		= '';
	$SUN_START_TIME = '';
	$SUN_END_TIME 	= '';
	$SUN_HOURS 		= '';
	$SUN_ROOM 		= '';
	
	$MONDAY 		= '';
	$MON_START_TIME = '';
	$MON_END_TIME 	= '';
	$MON_HOURS 		= '';
	$MON_ROOM 		= '';
	
	$TUESDAY 		= '';
	$TUE_START_TIME = '';
	$TUE_END_TIME 	= '';
	$TUE_HOURS 		= '';
	$TUE_ROOM 		= '';
	
	$WEDNESDAY 		= '';
	$WED_START_TIME = '';
	$WED_END_TIME 	= '';
	$WED_HOURS 		= '';
	$WED_ROOM 		= '';
	
	$THURSDAY 		= '';
	$THU_START_TIME = '';
	$THU_END_TIME 	= '';
	$THU_HOURS 		= '';
	$THU_ROOM 		= '';
	
	$FRIDAY 		= '';
	$FRI_START_TIME = '';
	$FRI_END_TIME 	= '';
	$FRI_HOURS 		= '';
	$FRI_ROOM 		= '';
	
	$SATURDAY 		= '';
	$SAT_START_TIME = '';
	$SAT_END_TIME 	= '';
	$SAT_HOURS 		= '';
	$SAT_ROOM 		= '';
	
	$SUN_PK_ATTENDANCE_ACTIVITY_TYPE	= '';
	$MON_PK_ATTENDANCE_ACTIVITY_TYPE	= '';
	$TUE_PK_ATTENDANCE_ACTIVITY_TYPE	= '';
	$WED_PK_ATTENDANCE_ACTIVITY_TYPE	= '';
	$THU_PK_ATTENDANCE_ACTIVITY_TYPE	= '';
	$FRI_PK_ATTENDANCE_ACTIVITY_TYPE	= '';
	$SAT_PK_ATTENDANCE_ACTIVITY_TYPE	= '';
	
	$SCHEDULE_ON_HOLIDAY 		= '';
	$OVERWRITE_SCHEDULE_DATE 	= '';
	
	$COURSE_HOUR = '';
	
	/* Ticket #849  */
	$res_camp = $db->Execute("select PK_CAMPUS from S_CAMPUS WHERE ACTIVE = 1 AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' ");
	if($res_camp->RecordCount() == 1)
		$PK_CAMPUS = $res_camp->fields['PK_CAMPUS'];
	/* Ticket #849  */
	
	/* Ticket #1473 */
	$res = $db->Execute("SELECT DEFAULT_LMS_CATEGORY_CODE FROM Z_ACCOUNT_ETHINK_SETTINGS WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' "); 
	$LMS_CODE 	= $res->fields['DEFAULT_LMS_CATEGORY_CODE'];	
	/* Ticket #1473 */
	
} else {

	$res = $db->Execute("SELECT * FROM S_COURSE_OFFERING WHERE PK_COURSE_OFFERING = '$_GET[id]' AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' "); 
	if($res->RecordCount() == 0){
		header("location:manage_course_offering");
		exit;
	}
	
	$PK_COURSE 					 = $res->fields['PK_COURSE'];
	$PK_CAMPUS 					 = $res->fields['PK_CAMPUS'];
	$PK_TERM_MASTER 			 = $res->fields['PK_TERM_MASTER'];
	$CUR_PK_TERM_MASTER 		 = $res->fields['PK_TERM_MASTER']; //Ticket # 1438
	$INSTRUCTOR 				 = $res->fields['INSTRUCTOR'];
	$PK_CAMPUS_ROOM 			 = $res->fields['PK_CAMPUS_ROOM'];
	$CLASS_SIZE 				 = $res->fields['CLASS_SIZE'];
	$PK_SESSION 				 = $res->fields['PK_SESSION'];
	$SESSION_NO 				 = $res->fields['SESSION_NO'];
	$PK_ATTENDANCE_TYPE 		 = $res->fields['PK_ATTENDANCE_TYPE'];
	$PK_ATTENDANCE_CODE 		 = $res->fields['PK_ATTENDANCE_CODE'];
	$OLD_DIAMOND_ID				 = $res->fields['OLD_DIAMOND_ID'];
	$PK_COURSE_OFFERING_STATUS 	 = $res->fields['PK_COURSE_OFFERING_STATUS'];
	$LMS_ACTIVE 				 = $res->fields['LMS_ACTIVE'];
	$LMS_CODE					 = $res->fields['LMS_CODE'];
	$CO_EXTERNAL_ID 			 = $res->fields['CO_EXTERNAL_ID'];
	$PK_ATTENDANCE_ACTIVITY_TYPE = $res->fields['PK_ATTENDANCE_ACTIVITY_TYPE'];
	$ROOM_SIZE 					 = $res->fields['ROOM_SIZE']; //Ticket # 1325
	$LMS_COURSE_TEMPLATE_ID		 = $res->fields['LMS_COURSE_TEMPLATE_ID']; //Ticket # 1372
	$ACTIVE		 				 = $res->fields['ACTIVE']; //Ticket # 1458
	
	$res = $db->Execute("SELECT  * FROM S_COURSE_OFFERING_SCHEDULE WHERE PK_COURSE_OFFERING = '$_GET[id]' AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' "); 
	
	$PK_COURSE_OFFERING	= $res->fields['PK_COURSE_OFFERING'];
	$START_DATE 		= $res->fields['START_DATE'];
	$END_DATE 			= $res->fields['END_DATE'];
	$DEF_START_TIME 	= $res->fields['DEF_START_TIME'];
	$DEF_END_TIME 		= $res->fields['DEF_END_TIME'];
	$DEF_HOURS 			= $res->fields['DEF_HOURS'];
	
	if($START_DATE != '0000-00-00')
		$START_DATE = date("m/d/Y",strtotime($START_DATE));
	else
		$START_DATE = '';
		
	if($END_DATE != '0000-00-00')
		$END_DATE = date("m/d/Y",strtotime($END_DATE));
	else
		$END_DATE = '';
	
	if($DEF_START_TIME != '00:00:00')
		$DEF_START_TIME = date("h:i A",strtotime($DEF_START_TIME));
	else
		$DEF_START_TIME = '';
			
	if($DEF_END_TIME != '00:00:00')
		$DEF_END_TIME = date("h:i A",strtotime($DEF_END_TIME));
	else
		$DEF_END_TIME = '';
	
	$SUNDAY	 	= $res->fields['SUNDAY'];
	$MONDAY 	= $res->fields['MONDAY'];
	$TUESDAY 	= $res->fields['TUESDAY'];
	$WEDNESDAY 	= $res->fields['WEDNESDAY'];
	$THURSDAY 	= $res->fields['THURSDAY'];
	$FRIDAY 	= $res->fields['FRIDAY'];
	$SATURDAY 	= $res->fields['SATURDAY'];
	
	$SUN_ROOM	= $res->fields['SUN_ROOM'];
	$MON_ROOM 	= $res->fields['MON_ROOM'];
	$TUE_ROOM 	= $res->fields['TUE_ROOM'];
	$WED_ROOM 	= $res->fields['WED_ROOM'];
	$THU_ROOM 	= $res->fields['THU_ROOM'];
	$FRI_ROOM 	= $res->fields['FRI_ROOM'];
	$SAT_ROOM 	= $res->fields['SAT_ROOM'];
	
	if($SUNDAY == 1) {
		$SUN_START_TIME = $res->fields['SUN_START_TIME'];
		$SUN_END_TIME 	= $res->fields['SUN_END_TIME'];
		$SUN_HOURS 		= $res->fields['SUN_HOURS'];
		
		$SUN_PK_ATTENDANCE_ACTIVITY_TYPE = $res->fields['SUN_PK_ATTENDANCE_ACTIVITY_TYPE'];
		
		if($SUN_START_TIME != '00:00:00')
			$SUN_START_TIME = date("h:i A",strtotime($SUN_START_TIME));
			
		if($SUN_END_TIME != '00:00:00')
			$SUN_END_TIME = date("h:i A",strtotime($SUN_END_TIME));
	} else {
		$SUN_START_TIME = '';
		$SUN_END_TIME 	= '';
		$SUN_HOURS 		= '';
		
		$SUN_PK_ATTENDANCE_ACTIVITY_TYPE = '';
	}
	
	if($MONDAY == 1) {
		$MON_START_TIME = $res->fields['MON_START_TIME'];
		$MON_END_TIME 	= $res->fields['MON_END_TIME'];
		$MON_HOURS 		= $res->fields['MON_HOURS'];
		
		$MON_PK_ATTENDANCE_ACTIVITY_TYPE = $res->fields['MON_PK_ATTENDANCE_ACTIVITY_TYPE'];
		
		if($MON_START_TIME != '00:00:00')
			$MON_START_TIME = date("h:i A",strtotime($MON_START_TIME));
			
		if($MON_END_TIME != '00:00:00')
			$MON_END_TIME = date("h:i A",strtotime($MON_END_TIME));
	} else {
		$MON_START_TIME = '';
		$MON_END_TIME 	= '';
		$MON_HOURS 		= '';
		
		$MON_PK_ATTENDANCE_ACTIVITY_TYPE = '';
	}
	
	if($TUESDAY == 1) {
		$TUE_START_TIME = $res->fields['TUE_START_TIME'];
		$TUE_END_TIME 	= $res->fields['TUE_END_TIME'];
		$TUE_HOURS 		= $res->fields['TUE_HOURS'];
		
		$TUE_PK_ATTENDANCE_ACTIVITY_TYPE = $res->fields['TUE_PK_ATTENDANCE_ACTIVITY_TYPE'];
		
		if($TUE_START_TIME != '00:00:00')
			$TUE_START_TIME = date("h:i A",strtotime($TUE_START_TIME));
			
		if($TUE_END_TIME != '00:00:00')
			$TUE_END_TIME = date("h:i A",strtotime($TUE_END_TIME));
	} else {
		$TUE_START_TIME = '';
		$TUE_END_TIME 	= '';
		$TUE_HOURS 		= '';
		
		$TUE_PK_ATTENDANCE_ACTIVITY_TYPE = '';
	}
	
	if($WEDNESDAY == 1) {
		$WED_START_TIME = $res->fields['WED_START_TIME'];
		$WED_END_TIME 	= $res->fields['WED_END_TIME'];
		$WED_HOURS 		= $res->fields['WED_HOURS'];
		
		$WED_PK_ATTENDANCE_ACTIVITY_TYPE = $res->fields['WED_PK_ATTENDANCE_ACTIVITY_TYPE'];
		
		if($WED_START_TIME != '00:00:00')
			$WED_START_TIME = date("h:i A",strtotime($WED_START_TIME));
			
		if($WED_END_TIME != '00:00:00')
			$WED_END_TIME = date("h:i A",strtotime($WED_END_TIME));
	} else {
		$WED_START_TIME = '';
		$WED_END_TIME 	= '';
		$WED_HOURS 		= '';
		
		$WED_PK_ATTENDANCE_ACTIVITY_TYPE = '';
	}
	
	if($THURSDAY == 1) {
		$THU_START_TIME = $res->fields['THU_START_TIME'];
		$THU_END_TIME 	= $res->fields['THU_END_TIME'];
		$THU_HOURS 		= $res->fields['THU_HOURS'];
		
		$THU_PK_ATTENDANCE_ACTIVITY_TYPE = $res->fields['THU_PK_ATTENDANCE_ACTIVITY_TYPE'];
		
		if($THU_START_TIME != '00:00:00')
			$THU_START_TIME = date("h:i A",strtotime($THU_START_TIME));
			
		if($THU_END_TIME != '00:00:00')
			$THU_END_TIME = date("h:i A",strtotime($THU_END_TIME));
	} else {
		$THU_START_TIME = '';
		$THU_END_TIME 	= '';
		$THU_HOURS 		= '';
		
		$THU_PK_ATTENDANCE_ACTIVITY_TYPE = '';
	}

	if($FRIDAY == 1) {
		$FRI_START_TIME = $res->fields['FRI_START_TIME'];
		$FRI_END_TIME 	= $res->fields['FRI_END_TIME'];
		$FRI_HOURS 		= $res->fields['FRI_HOURS'];
		
		$FRI_PK_ATTENDANCE_ACTIVITY_TYPE = $res->fields['FRI_PK_ATTENDANCE_ACTIVITY_TYPE'];
		
		if($FRI_START_TIME != '00:00:00')
			$FRI_START_TIME = date("h:i A",strtotime($FRI_START_TIME));
			
		if($FRI_END_TIME != '00:00:00')
			$FRI_END_TIME = date("h:i A",strtotime($FRI_END_TIME));
	} else {
		$FRI_START_TIME = '';
		$FRI_END_TIME 	= '';
		$FRI_HOURS 		= '';
		
		$FRI_PK_ATTENDANCE_ACTIVITY_TYPE = '';
	}
	
	if($SATURDAY == 1) {
		$SAT_START_TIME = $res->fields['SAT_START_TIME'];
		$SAT_END_TIME 	= $res->fields['SAT_END_TIME'];
		$SAT_HOURS 		= $res->fields['SAT_HOURS'];
		
		$SAT_PK_ATTENDANCE_ACTIVITY_TYPE = $res->fields['SAT_PK_ATTENDANCE_ACTIVITY_TYPE'];
		
		if($SAT_START_TIME != '00:00:00')
			$SAT_START_TIME = date("h:i A",strtotime($SAT_START_TIME));
			
		if($SAT_END_TIME != '00:00:00')
			$SAT_END_TIME = date("h:i A",strtotime($SAT_END_TIME));
	} else {
		$SAT_START_TIME = '';
		$SAT_END_TIME 	= '';
		$SAT_HOURS 		= '';
		
		$SAT_PK_ATTENDANCE_ACTIVITY_TYPE = '';
	}
	
	
	$SCHEDULE_ON_HOLIDAY 		= $res->fields['SCHEDULE_ON_HOLIDAY'];
	$OVERWRITE_SCHEDULE_DATE 	= $res->fields['OVERWRITE_SCHEDULE_DATE'];
	
	$res = $db->Execute("SELECT HOURS FROM S_COURSE WHERE PK_COURSE = '$PK_COURSE' AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' "); 
	$COURSE_HOUR = $res->fields['HOURS'];
}

if($_GET['tab'] == 'settingsTab')
	$settings_tab = 'active';
else if($_GET['tab'] == 'scheduleTab')
	$schedule_tab = 'active';
else if($_GET['tab'] == 'studentTab')
	$student_tab = 'active';
else if($_GET['tab'] == 'finalGradeTab')
	$final_grade_tab = 'active';	
else if($_GET['tab'] == 'gradeTab')
	$grade_tab = 'active';
else if($_GET['tab'] == 'gradeInputTab')
	$grade_input_tab = 'active';	
else if($_GET['tab'] == 'nonScheduleTab')
	$nonSchedule_tab = 'active';
else if($_GET['tab'] == 'waitingListTab')
	$waitingList_tab = 'active';
else
	$settings_tab = 'active';

$res = $db->Execute("SELECT ENABLE_ETHINK, ENABLE_ATTENDANCE_ACTIVITY_TYPES FROM Z_ACCOUNT WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' "); 
$ENABLE_ETHINK 						= $res->fields['ENABLE_ETHINK'];	
$ENABLE_ATTENDANCE_ACTIVITY_TYPES 	= $res->fields['ENABLE_ATTENDANCE_ACTIVITY_TYPES'];
?>
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
	<? require_once("css.php"); ?>
	<link href="../backend_assets/node_modules/Magnific-Popup-master/dist/magnific-popup.css" rel="stylesheet">
	<link href="../backend_assets/dist/css/pages/user-card.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="../backend_assets/dist/css/easyui.css">

	<title><?=COURSE_OFFERING_PAGE_TITLE?> | <?=title?></title>
	<style>
		.padding_2{padding: 2px 10px 5px 0 !important}
		.no-records-found{display:none;}
		
		.table-scroll {
			position:relative;
			max-width:100%;
			margin:auto;
			overflow:hidden;
			border:1px solid #e9ecef;
		}
		.table-wrap {
			width:100%;
			overflow:auto;
		}
		.table-scroll table {
			width:100%;
			margin:auto;
			border-collapse:separate;
			border-spacing:0;
		}
		.table-scroll th, .table-scroll td {
			padding:5px 10px;
			border:1px solid #e9ecef;
			background:#fff;
			/*white-space:nowrap;*/
			vertical-align:top;
			
		}
		.table-scroll thead, .table-scroll tfoot {
			background:#f9f9f9;
			
		}
		
		.table-scroll th {
			font-weight: bold;
		}
		.clone {
			position:absolute;
			top:0;
			left:0;
			pointer-events:none;
		}
		.clone th, .clone td {
			visibility:hidden
		}
		.clone td, .clone th {
			border-color:transparent
		}
		.clone tbody th {
			visibility:visible;
			color:red;
		}
		.clone .fixed-side {
			border:1px solid #e9ecef;
			background:#9992A0;
			visibility:visible;
		}
		/*DIAM-1881*/
		.fixed-side {
			width: 170px;
			position: sticky;
			background: #9992A0;
			z-index: 1; /* Ensure it appears above other columns */
		}
		.sticky-header {
			position: sticky;
			top: 0;
			z-index: 1000; /* Ensure it's above other content */
		}



		#gradeBookEntryData {
			height: 500px;
			overflow: auto;
			position: relative;
		}
		/* #grade_input_table {
		table-layout: fixed;
		} */
		#grade_input_table.stickyHead thead th {
			position: sticky;
			top: 0px;
			background: grey;
		}
		.fixed-side:nth-child(1) {
			left: 0; /* Stick the first column to the left */
		}

		.fixed-side:nth-child(2) {
			left: 170px; /* Stick the second column to the left, adjust width as needed */
		}
		.table-scroll thead {
			position: sticky;
			top: 0;
			background-color: #ffffff;
		}
		/*DIAM-1881*/
		.clone thead, .clone tfoot{background:transparent;}
	
		li > a > label{position: unset !important;}
		
		/* Ticket # 1695 */
		.option_red > a > label{color:red !important}
		/* Ticket # 1695 */
	</style>
</head>

<body class="horizontal-nav boxed skin-megna fixed-layout">
   <? require_once("pre_load.php"); ?>
    <div id="main-wrapper">
       <? require_once("menu.php"); ?>
        <div class="page-wrapper">
            <div class="container-fluid">
                 <div class="row page-titles">
                    <div class="col-md-10 align-self-center">
                        <h4 class="text-themecolor">
							<?=COURSE_OFFERING_PAGE_TITLE?> <span id="heading_span"></span>
						</h4>
                    </div>
					<div class="col-md-2 align-self-center">
						<!-- Ticket # 820 -->
						<? if($_SESSION['ADMIN_PK_USER'] != 0){ ?>
						<a href="javascript:void(0)" onclick="troubleshoot()" class="btn btn-info m-l-15">Troubleshoot</a>
						<? } ?>
					</div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <div class="card">
							<ul class="nav nav-tabs customtab" role="tablist">
								<li class="nav-item"> <a class="nav-link <?=$settings_tab?>" data-toggle="tab" href="#settingsTab" role="tab"><span class="hidden-sm-up"><i class="ti-home"></i></span> <span class="hidden-xs-down"><?=TAB_SETTINGS?></span></a> </li>
								
								<? if($_GET['id'] != '') { ?>
									<li class="nav-item"> <a class="nav-link <?=$schedule_tab?>" data-toggle="tab" href="#scheduleTab" role="tab"><span class="hidden-sm-up"><i class="ti-user"></i></span> <span class="hidden-xs-down"><?=TAB_SCHEDULE?></span></a> </li>
																	
									<li class="nav-item"> <a class="nav-link <?=$student_tab?>" data-toggle="tab" href="#studentTab" role="tab" onclick="get_student_tab(<?=$_GET['id']?>);"><span class="hidden-sm-up"><i class="ti-user"></i></span> <span class="hidden-xs-down"><?=TAB_STUDENTS?></span></a> </li>
									
									<li class="nav-item"> <a class="nav-link <?=$final_grade_tab?>" data-toggle="tab" href="#finalGradeTab" role="tab" onclick="get_final_grad_tab(<?=$_GET['id']?>)"><span class="hidden-sm-up"><i class="ti-user"></i></span> <span class="hidden-xs-down"><?=TAB_FINAL_GRADE?></span></a> </li>
									
									<li class="nav-item"> <a class="nav-link <?=$grade_tab?>" data-toggle="tab" href="#gradeTab" role="tab" onclick="get_grad_tab(<?=$_GET['id']?>)" ><span class="hidden-sm-up"><i class="ti-user"></i></span> <span class="hidden-xs-down"><?=TAB_GRADE?></span></a> </li>
									
									<li class="nav-item"> <a class="nav-link <?=$grade_input_tab?>" data-toggle="tab" href="#gradeInputTab" role="tab" onclick="get_grade_book_entry(<?=$_GET['id']?>);"><span class="hidden-sm-up"><i class="ti-user"></i></span> <span class="hidden-xs-down"><?=TAB_GRADE_INPUT?></span></a> </li>
									
									<li class="nav-item"> <a class="nav-link <?=$nonSchedule_tab?>" data-toggle="tab" href="#nonScheduleTab" role="tab" onclick="get_non_sheduled_attendance(<?=$_GET['id']?>);"><span class="hidden-sm-up"><i class="ti-user"></i></span> <span class="hidden-xs-down"><?=TAB_NON_SCHEDULED_ATTENDANCE?></span></a> </li>
									
									<li class="nav-item"> <a class="nav-link <?=$waitingList_tab?>" data-toggle="tab" href="#waitingListTab" role="tab"><span class="hidden-sm-up"><i class="ti-user"></i></span> <span class="hidden-xs-down"><?=TAB_WAITING_LIST?></span></a> </li>
								<? } ?>
                            </ul>
                            <!-- Tab panes -->
                           <form class="floating-labels m-t-40" method="post" name="form1" id="form1" autocomplete="off" >
                                <div class="tab-content">
                                    <div class="tab-pane <?=$settings_tab?>" id="settingsTab" role="tabpanel">
                                        <div class="p-20">
											<div class="row">
												<!-- Ticket # 1458 -->
												<div class="col-sm-3 form-group <? if($_GET['id'] != ''){ ?> focused <? } ?> ">
													<? if($_GET['id'] != ''){ 
														/* Ticket #1695  */
														$res_type = $db->Execute("select CAMPUS_CODE from S_CAMPUS WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' AND PK_CAMPUS = '$PK_CAMPUS'"); ?>
														<?=$res_type->fields['CAMPUS_CODE']; /* Ticket #1695  */ ?>
														<span class="bar"></span> 
														<label for="PK_CAMPUS"><?=CAMPUS?></label>
														<input type="hidden" id="PK_CAMPUS" name="PK_CAMPUS" value="<?=$PK_CAMPUS?>" />
													<? } else { ?>
													<select id="PK_CAMPUS" name="PK_CAMPUS" class="form-control required-entry" onchange="get_teacher(this.value,'INSTRUCTOR'); get_teacher(this.value,'ASSISTANT'); get_room(this.value);get_session();get_course();get_tem_from_campus(this.value)" > <!-- Ticket #1149 - term -->
														<option value=""></option>
														<? /* Ticket #1695  */
														$res_type = $db->Execute("select PK_CAMPUS,CAMPUS_CODE, ACTIVE from S_CAMPUS WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' order by ACTIVE DESC, CAMPUS_CODE ASC"); 
														while (!$res_type->EOF) { ?>
															<option value="<?=$res_type->fields['PK_CAMPUS'] ?>" <? if($PK_CAMPUS == $res_type->fields['PK_CAMPUS']) echo "selected"; ?> <? if($res_type->fields['ACTIVE'] == 0) echo "class='option_red'"; ?> ><?=$res_type->fields['CAMPUS_CODE']?></option>
														<?	$res_type->MoveNext();
														} /* Ticket #1695  */ ?>
													</select>
													<span class="bar"></span> 
													<label for="PK_CAMPUS"><?=CAMPUS?></label>
													<? } ?>
													<!-- Ticket # 1458 -->
												</div>
												
												<div class="col-sm-3 form-group" id="PK_ROOM_DIV_1" >
													<div id="PK_ROOM_DIV" >
														<? $_REQUEST['campus'] 		 = $PK_CAMPUS;
														$_REQUEST['name'] 		 	 = 'PK_CAMPUS_ROOM';
														$_REQUEST['id'] 		 	 = 'PK_CAMPUS_ROOM';
														$_REQUEST['SELECTED_VALUE1'] = $PK_CAMPUS_ROOM;
														$_REQUEST['disable'] 		 = '';
														$_REQUEST['onchange'] 		 = 1; //Ticket # 1325
														include("ajax_get_campus_room.php"); ?>
													</div>
													<span class="bar"></span> 
													<label for="PK_CAMPUS_ROOM"><?=ROOM?></label>
												</div>
												
												 <div class="col-sm-3 form-group" id="PK_ATTENDANCE_TYPE_DIV" >
													<select id="PK_ATTENDANCE_TYPE" name="PK_ATTENDANCE_TYPE" class="form-control" >
														<option value="" ></option>
														<? $res_type = $db->Execute("select PK_ATTENDANCE_TYPE,ATTENDANCE_TYPE,DESCRIPTION from M_ATTENDANCE_TYPE WHERE ACTIVE = 1 order by ATTENDANCE_TYPE ASC");
														while (!$res_type->EOF) { ?>
															<option value="<?=$res_type->fields['PK_ATTENDANCE_TYPE'] ?>" <? if($PK_ATTENDANCE_TYPE == $res_type->fields['PK_ATTENDANCE_TYPE']) echo "selected"; ?> ><?=$res_type->fields['ATTENDANCE_TYPE'].' '.$res_type->fields['DESCRIPTION']?></option>
														<?	$res_type->MoveNext();
														} ?>
													</select>
													<span class="bar"></span> 
													<label for="PK_ATTENDENCE_TYPE"><?=ATTENDENCE_TYPE?></label>
												</div>
												
												<? if($ENABLE_ATTENDANCE_ACTIVITY_TYPES == 1){ ?>
												 <div class="col-sm-3 form-group" id="PK_ATTENDANCE_TYPE_DIV" >
													<select id="PK_ATTENDANCE_ACTIVITY_TYPE" name="PK_ATTENDANCE_ACTIVITY_TYPE" class="form-control" >
														<option value="" ></option>
														<? /* Ticket #1695  */
														$res_type = $db->Execute("select PK_ATTENDANCE_ACTIVITY_TYPE, ATTENDANCE_ACTIVITY_TYPE, ACTIVE from M_ATTENDANCE_ACTIVITY_TYPE WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' order by ACTIVE DESC, ATTENDANCE_ACTIVITY_TYPE ASC");
														while (!$res_type->EOF) { 
															$option_label = $res_type->fields['ATTENDANCE_ACTIVITY_TYPE'];
															if($res_type->fields['ACTIVE'] == 0)
																$option_label .= " (Inactive)"; ?>
															<option value="<?=$res_type->fields['PK_ATTENDANCE_ACTIVITY_TYPE'] ?>" <? if($PK_ATTENDANCE_ACTIVITY_TYPE == $res_type->fields['PK_ATTENDANCE_ACTIVITY_TYPE']) echo "selected"; ?> <? if($res_type->fields['ACTIVE'] == 0) echo "class='option_red'"; ?> ><?=$option_label ?></option>
														<?	$res_type->MoveNext();
														} /* Ticket #1695  */ ?>
													</select>
													<span class="bar"></span> 
													<label for="PK_ATTENDANCE_ACTIVITY_TYPE"><?=DEFAULT_ACTIVITY_TYPE ?></label>
												</div>
												<? } ?>
											</div>
											
											<div class="row">
												<!-- Ticket # 1458 -->
												<div class="col-sm-3 form-group <? if($_GET['id'] != ''){ ?> focused <? } ?> " id="PK_COURSE_DIV_1"  >
													<? if($_GET['id'] != ''){ 
														/* Ticket # 1695 */
														$res_type = $db->Execute("select CONCAT(TRANSCRIPT_CODE, ' - ', S_COURSE.COURSE_CODE, ' - ', COURSE_DESCRIPTION) as TRANSCRIPT_CODE_1, TRANSCRIPT_CODE from S_COURSE WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' AND PK_COURSE = '$PK_COURSE'"); //Ticket #1773
														$EDIT_COURSE_CODE = $res_type->fields['TRANSCRIPT_CODE'];
														echo $res_type->fields['TRANSCRIPT_CODE_1']; /* Ticket # 1695 */ ?>
														<span class="bar"></span> 
														<label for="PK_COURSE"><?=COURSE_CODE?></label>
														<input type="hidden" id="PK_COURSE" name="PK_COURSE" value="<?=$PK_COURSE?>" />
													<? } else { ?>
													<div id="PK_COURSE_DIV" >
														<? $_REQUEST['PK_CAMPUS'] 	= $PK_CAMPUS;
														$_REQUEST['c'] 				= $PK_COURSE;
														$_REQUEST['onclick_fun'] 	= 1; //Ticket #1149 - term
														include("ajax_get_course_from_campus.php"); ?>
													</div>
													<span class="bar"></span> 
													<label for="PK_COURSE"><?=COURSE_CODE?></label>
													<? } ?>
												</div>
												<!-- Ticket # 1458 -->
												
												<div class="col-sm-3 form-group" id="INSTRUCTOR_DIV_1">
													<div id="INSTRUCTOR_DIV" >
														<? $_REQUEST['campus'] 		= $PK_CAMPUS;
														$_REQUEST['id'] 			= 'INSTRUCTOR';
														$_REQUEST['SELECTED_VALUE'] = $INSTRUCTOR;
														include("ajax_get_teacher_from_campus.php"); ?>
													</div>
													<span class="bar"></span> 
													<label for="INSTRUCTOR"><?=INSTRUCTOR?></label>
												</div>
												
												<div class="col-sm-3 form-group" id="PK_ATTENDANCE_CODE_DIV" >
													<select id="PK_ATTENDANCE_CODE" name="PK_ATTENDANCE_CODE" class="form-control">
														<option value=""></option>
														<? //Ticket # 1020 /* Ticket #1695  */
														$res_type = $db->Execute("select S_ATTENDANCE_CODE.PK_ATTENDANCE_CODE,ATTENDANCE_CODE, CODE, S_ATTENDANCE_CODE.ACTIVE from M_ATTENDANCE_CODE, S_ATTENDANCE_CODE WHERE S_ATTENDANCE_CODE.PK_ATTENDANCE_CODE = M_ATTENDANCE_CODE.PK_ATTENDANCE_CODE AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' order by S_ATTENDANCE_CODE.ACTIVE DESC, CODE ASC, ATTENDANCE_CODE ASC"); /* Ticket #1149  */
														while (!$res_type->EOF) { 
															$option_label = $res_type->fields['CODE'].' - '.$res_type->fields['ATTENDANCE_CODE'];
															if($res_type->fields['ACTIVE'] == 0)
																$option_label .= " (Inactive)"; ?>
															<option value="<?=$res_type->fields['PK_ATTENDANCE_CODE'] ?>" <? if($PK_ATTENDANCE_CODE == $res_type->fields['PK_ATTENDANCE_CODE']) echo "selected"; ?> <? if($res_type->fields['ACTIVE'] == 0) echo "class='option_red'"; ?> ><?=$option_label ?></option>
														<?	$res_type->MoveNext();
														} 
														/* Ticket #1695  */ ?>
													</select>
													<span class="bar"></span> 
													<label for="PK_ATTENDANCE_CODE"><?=ATTENDENCE_CODE?></label>
												</div>
											</div>
											
											<div class="row">
												<div class="col-sm-3 form-group">
													<!-- Ticket #1149 - term -->
													<div id="EN_1_PK_TERM_MASTER_DIV" >
														<? $fun_onchange = "show_title();get_session();";
														if($_GET['id'] != '')
															$fun_onchange .= "check_student_assigned(this.value)";
															
														$_REQUEST['pk_campus_id'] = $PK_CAMPUS;
														$_REQUEST['DEF_TERM']	  = $PK_TERM_MASTER; 
														$_REQUEST['obj_id']	  	  = 'PK_TERM_MASTER'; 
														$_REQUEST['obj_name']	  = 'PK_TERM_MASTER'; 
														$_REQUEST['multiple']	  = ''; 
														$_REQUEST['onchange']	  = $fun_onchange;
														$_REQUEST['onclick_fun']  = 1; 
														$_REQUEST['required']	  = '1'; 
														include("ajax_get_term_master_from_campus.php");  ?>
													</div>
													<!-- Ticket #1149 - term -->
													
													<span class="bar"></span> 
													<label for="PK_TERM_MASTER"><?=TERM?></label>
												</div>
												<div class="col-sm-3 form-group focused" id="ASSISTANT_DIV_1" >
													<div id="ASSISTANT_DIV" >
														<? $ASSISTANT = '';
														$res_type = $db->Execute("select ASSISTANT FROM S_COURSE_OFFERING_ASSISTANT WHERE PK_COURSE_OFFERING = '$_GET[id]' AND ACTIVE = 1 AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' ");
														while (!$res_type->EOF) {
															if($ASSISTANT != '')
																$ASSISTANT .= ',';
															$ASSISTANT .= $res_type->fields['ASSISTANT'];
															
															$res_type->MoveNext();
														}
														
														$_REQUEST['campus'] 		= $PK_CAMPUS;
														$_REQUEST['id'] 			= 'ASSISTANT';
														$_REQUEST['SELECTED_VALUE'] = $ASSISTANT;
														$_REQUEST['DONT_INCLUDE'] 	= $INSTRUCTOR;
														include("ajax_get_teacher_from_campus.php"); ?>
													</div>
													<span class="bar"></span> 
													<label for="ASSISTANT"></label>
												</div>
												<div class="col-sm-3 form-group" id="CLASS_SIZE_DIV" >
													<input id="CLASS_SIZE" name="CLASS_SIZE" value="<?=$CLASS_SIZE?>" type="text" class="form-control" value="">
													<span class="bar"></span> 
													<label for="CLASS_SIZE"><?=CLASS_SIZE?></label>
												</div>
											</div>
											
											<div class="row">
	                                            <div class="col-sm-3 form-group">
													<select id="PK_SESSION" name="PK_SESSION" class="form-control required-entry" onchange="show_title();get_session();" >
														<option value="" ></option>
														<? /* Ticket #1695  */
														$res_type = $db->Execute("select PK_SESSION, SESSION, ACTIVE,SESSION_ABBREVIATION from M_SESSION WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' order by ACTIVE DESC, DISPLAY_ORDER ASC");
														while (!$res_type->EOF) { 
															if($res_type->fields['SESSION_ABBREVIATION'] != ''){
																$option_label =  $res_type->fields['SESSION_ABBREVIATION'].' - '.$res_type->fields['SESSION'];
															}else{
																$option_label = substr($res_type->fields['SESSION'],0,1).' - '.$res_type->fields['SESSION'];
															}
															
															if($res_type->fields['ACTIVE'] == 0)
																$option_label .= " (Inactive)"; ?>
															<option value="<?=$res_type->fields['PK_SESSION'] ?>" <? if($PK_SESSION == $res_type->fields['PK_SESSION']) echo "selected"; ?> <? if($res_type->fields['ACTIVE'] == 0) echo "class='option_red'"; ?> ><?=$option_label ?></option>
														<?	$res_type->MoveNext();
														} /* Ticket #1695  */ ?>
													</select>
													<span class="bar"></span> 
													<label for="PK_SESSION"><?=SESSION?></label>
												</div>
											
												<div class="col-sm-3 form-group" id="SESSION_NO_DIV" >
													<input id="SESSION_NO" name="SESSION_NO" value="<?=$SESSION_NO?>" type="text" class="form-control validate-session-number" onchange="show_title();" >
													<span class="bar"></span> 
													<label for="SESSION_NO"><?=SESSION_NO?></label>
												</div>
												
												<!-- Ticket # 1325 -->
												<div class="col-sm-3 form-group" >
													<input id="ROOM_SIZE" name="ROOM_SIZE" value="<?=$ROOM_SIZE?>" type="text" class="form-control" >
													<span class="bar"></span> 
													<label for="ROOM_SIZE"><?=ROOM_SIZE?></label>
												</div>
												<!-- Ticket # 1325 -->
											</div>
											
											<div class="row">
												<? if($_GET['id'] != ''){ ?>
	                                            <div class="col-sm-3 form-group">
													<select id="PK_COURSE_OFFERING_STATUS" name="PK_COURSE_OFFERING_STATUS" class="form-control required-entry" >
														<option value="" ></option>
														<? $res_type = $db->Execute("select PK_COURSE_OFFERING_STATUS,COURSE_OFFERING_STATUS from M_COURSE_OFFERING_STATUS WHERE ACTIVE = 1 order by COURSE_OFFERING_STATUS ASC");
														while (!$res_type->EOF) { ?>
															<option value="<?=$res_type->fields['PK_COURSE_OFFERING_STATUS'] ?>" <? if($PK_COURSE_OFFERING_STATUS == $res_type->fields['PK_COURSE_OFFERING_STATUS']) echo "selected"; ?> ><?=$res_type->fields['COURSE_OFFERING_STATUS']?></option>
														<?	$res_type->MoveNext();
														} ?>
													</select>
													<span class="bar"></span> 
													<label for="PK_COURSE_OFFERING_STATUS"><?=COURSE_OFFERING_STATUS?></label>
												</div>
												<? } ?>
												
												<div class="col-md-3 form-group"  >
													<div class="row form-group">
														<div class="custom-control col-md-12"><?=LMS_ACTIVE?></div>
														<div class="custom-control custom-radio col-md-4">
															<input type="radio" id="LMS_ACTIVE_1" name="LMS_ACTIVE"  value="1" <? if($LMS_ACTIVE == 1) echo "checked"; ?> class="custom-control-input">
															<label class="custom-control-label" for="LMS_ACTIVE_1" ><?=YES ?></label>
														</div>
														<div class="custom-control custom-radio col-md-6">
															<input type="radio" id="LMS_ACTIVE_2" name="LMS_ACTIVE" value="0"  <? if($LMS_ACTIVE == 0) echo "checked"; ?> class="custom-control-input">
															<label class="custom-control-label" for="LMS_ACTIVE_2" ><?=NO ?></label>
														</div>
													</div>
												</div> 
												
												<div class="col-sm-3 form-group" >
													<input id="CO_EXTERNAL_ID" name="CO_EXTERNAL_ID" value="<?=$CO_EXTERNAL_ID?>" type="text" class="form-control" >
													<span class="bar"></span> 
													<label for="CO_EXTERNAL_ID"><?=EXTERNAL_ID?></label>
												</div>
												
												<!-- Ticket # 1325 -->
												<div class="col-sm-3 form-group" >
													<input id="OLD_DIAMOND_ID" name="OLD_DIAMOND_ID" value="<?=$OLD_DIAMOND_ID?>" type="text" class="form-control" readonly >
													<span class="bar"></span> 
													<label for="OLD_DIAMOND_ID"><?=PREVIOUS_SIS_COURSE_OFFERING_ID?></label>
												</div>
												<!-- Ticket # 1325 -->
												
											</div>
											
											<!-- Ticket # 1458 -->
											<div class="row">
												<? if($ENABLE_ETHINK == 1 ) { ?>
												<div class="col-sm-3 form-group" >
													<input id="LMS_CODE" name="LMS_CODE" value="<?=$LMS_CODE?>" type="text" class="form-control" > <!-- Ticket #1473 -->
													<span class="bar"></span> 
													<label for="LMS_CODE"><?=LMS_CATEGORY_CODE?></label>
												</div>
												
												<!-- Ticket # 1372 -->
												<div class="col-sm-3 form-group" >
													<input id="LMS_COURSE_TEMPLATE_ID" name="LMS_COURSE_TEMPLATE_ID" value="<?=$LMS_COURSE_TEMPLATE_ID?>" type="text" class="form-control" >
													<span class="bar"></span> 
													<label for="LMS_COURSE_TEMPLATE_ID"><?=LMS_COURSE_TEMPLATE_ID?></label>
												</div>
												<!-- Ticket # 1372 -->
												<? }else if($_SESSION['PK_ACCOUNT']==516){ ?>
													<div class="col-sm-3 form-group" >
													<input id="LMS_CODE" name="LMS_CODE" value="<?=$LMS_CODE?>" type="text" class="form-control" > <!-- Ticket #1473 -->
													<span class="bar"></span> 
													<label for="LMS_CODE"><?=LMS_CATEGORY_CODE?></label>
												</div>

												<?php } ?>
												
												<div class="col-md-3 form-group"  >
													<div class="row form-group">
														<div class="custom-control col-md-12"><?=ACTIVE?></div>
														<div class="custom-control custom-radio col-md-4">
															<input type="radio" id="ACTIVE_1" name="ACTIVE"  value="1" <? if($ACTIVE == 1) echo "checked"; ?> class="custom-control-input">
															<label class="custom-control-label" for="ACTIVE_1" ><?=YES ?></label>
														</div>
														<div class="custom-control custom-radio col-md-6">
															<input type="radio" id="ACTIVE_2" name="ACTIVE" value="0"  <? if($ACTIVE == 0) echo "checked"; ?> class="custom-control-input">
															<label class="custom-control-label" for="ACTIVE_2" ><?=NO ?></label>
														</div>
													</div>
												</div>
											</div>
											<!-- Ticket # 1458 -->
											
											<div class="row">
	                                            <div class="col-sm-6 form-group">
												</div>
												<div class="col-sm-6 form-group">
													<button type="button" onclick="validate_form(1)" class="btn waves-effect waves-light btn-info"><?=SAVE?></button>
													
													<button type="button" onclick="validate_form(0)" class="btn waves-effect waves-light btn-info"><?=SAVE_EXIT?></button>
														
													<button type="button" onclick="window.location.href='manage_course_offering'" class="btn waves-effect waves-light btn-dark"><?=CANCEL?></button>
												</div>
											</div>
                                        </div>									
                                    </div>
									
									<? if($_GET['id'] != '') { ?>
										<div class="tab-pane <?=$schedule_tab?>" id="scheduleTab" role="tabpanel">
											<div class="p-20">
												<div class="row">
													<div class="col-md-5">
														<div class="row">
															<div class="col-md-2"><b><?=DATES?></b></div>
															<div class="col-md-3 form-group">
																<input type="text" id="START_DATE" name="START_DATE" value="<?=$START_DATE?>" class="form-control date1 ">
																<span class="bar"></span> 
																<label for="START_DATE"><?=START_DATE?></label>
															</div>
															<div class="col-md-3 d-flex align-items-center justify-content-center form-group">to</div>
															<div class="col-md-3 form-group">
																<input type="text" id="END_DATE" name="END_DATE" value="<?=$END_DATE?>" class="form-control date2">
																<span class="bar"></span> 
																<label for="END_DATE"><?=END_DATE?></label>
															</div>
														</div>
														
														<div class="row">
															<div class="col-md-2"><b><?=DEFAULT_TIMES?></b></div>
															<div class="col-md-3 form-group">
																<input type="text" id="DEF_START_TIME" name="DEF_START_TIME" value="<?=$DEF_START_TIME?>" class="form-control timepicker" onchange="get_hour('DEF')" >
																<span class="bar"></span> 
																<label for="DEF_START_TIME"><?=START_TIME?></label>
															</div>
														   
															<div class="col-md-3 form-group">
																<input type="text" id="DEF_END_TIME" name="DEF_END_TIME" value="<?=$DEF_END_TIME?>" class="form-control timepicker" onchange="get_hour('DEF')" >
																<span class="bar"></span> 
																<label for="DEF_END_TIME"><?=END_TIME?></label>
															</div>
															
															<div class="col-md-3 form-group">
																<input type="text" id="DEF_HOURS" name="DEF_HOURS" value="<?=$DEF_HOURS?>" class="form-control" >
																<span class="bar"></span> 
																<label for="DEF_HOURS"><?=HOUR?></label>
															</div>
														</div>
														
														<div class="row">
															<div class="col-md-5"></div>
															<div class="col-md-6 form-group">
																<button type="button" onclick="apply_default()" class="btn waves-effect waves-light btn-info"><?=APPLY_DEFAULT?></button>
																<button type="button" onclick="reset_blank()" class="btn waves-effect waves-light btn-info"><?=RESET_BLANK?></button>
															</div>
														</div>
														
														<div class="row">
															<div class="col-md-2 form-group">
																<?=DAY?>
															</div>
															<div class="col-md-2 form-group" >
																<?=START_TIME?>
															</div>
															<div class="col-md-2 form-group" >
																<?=END_TIME?>
															</div>
															<div class="col-md-2 form-group" >
																<?=HOUR?>
															</div>
															<div class="col-md-2 form-group" >
																<?=ROOM?>
															</div>
															<? if($ENABLE_ATTENDANCE_ACTIVITY_TYPES == 1){ ?>
															<div class="col-md-2 form-group" style="padding-right:0" >
																<?=ACTIVITY_TYPE?>
															</div>
															<? } ?>
														</div>
														
														<div class="row">
															<div class="col-md-2 form-group custom-control custom-checkbox form-group">
																<input type="checkbox" class="custom-control-input" id="SUN" name="SUNDAY" value="1" <? if($SUNDAY == 1) echo "checked"; ?> onclick="enable_time('SUN')" >
																<label class="custom-control-label" for="SUN"><?=SUNDAY?></label>
															</div>
															
															<? if($SUNDAY == 1) $disable=""; else  $disable="disabled"; ?>
															<div class="col-2 form-group" >
																<input type="text" id="SUN_START_TIME" name="SUN_START_TIME" value="<?=$SUN_START_TIME?>" class="form-control timepicker padding_2" onchange="get_hour('SUN')" <?=$disable ?> >
																<span class="bar"></span> 
															</div>
															<div class="col-2 form-group" >
																<input type="text" id="SUN_END_TIME" name="SUN_END_TIME" value="<?=$SUN_END_TIME?>" class="form-control timepicker padding_2" onchange="get_hour('SUN')" <?=$disable ?> >
																<span class="bar"></span> 
															</div>
															<div class="col-2 form-group" >
																<input type="text" id="SUN_HOURS" name="SUN_HOURS" value="<?=$SUN_HOURS?>" class="form-control padding_2" <?=$disable ?> >
																<span class="bar"></span> 
															</div>
															<div class="col-md-2 form-group" >
																<? $_REQUEST['campus'] 		 = $PK_CAMPUS;
																$_REQUEST['name'] 		 	 = 'SUN_ROOM';
																$_REQUEST['id'] 		 	 = 'SUN_ROOM';
																$_REQUEST['SELECTED_VALUE1'] = $SUN_ROOM;
																$_REQUEST['disable'] 		 = $disable;
																include("ajax_get_campus_room.php"); ?>
															</div>
															<? if($ENABLE_ATTENDANCE_ACTIVITY_TYPES == 1){ ?>
															<div class="col-2 form-group" >
																<select id="SUN_PK_ATTENDANCE_ACTIVITY_TYPE" name="SUN_PK_ATTENDANCE_ACTIVITY_TYPE" class="form-control" <?=$disable ?> >
																	<option value="" ></option>
																	<? /* Ticket #1695  */
																	$res_type = $db->Execute("select PK_ATTENDANCE_ACTIVITY_TYPE, ATTENDANCE_ACTIVITY_TYPE, ACTIVE from M_ATTENDANCE_ACTIVITY_TYPE WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' order by ACTIVE DESC, ATTENDANCE_ACTIVITY_TYPE ASC");
																	while (!$res_type->EOF) { 
																		$option_label = $res_type->fields['ATTENDANCE_ACTIVITY_TYPE'];
																		if($res_type->fields['ACTIVE'] == 0)
																			$option_label .= " (Inactive)"; ?>
																		<option value="<?=$res_type->fields['PK_ATTENDANCE_ACTIVITY_TYPE'] ?>" <? if($SUN_PK_ATTENDANCE_ACTIVITY_TYPE == $res_type->fields['PK_ATTENDANCE_ACTIVITY_TYPE']) echo "selected"; ?> <? if($res_type->fields['ACTIVE'] == 0) echo "class='option_red'"; ?> ><?=$option_label ?></option>
																	<?	$res_type->MoveNext();
																	} /* Ticket #1695  */ ?>
																</select>
															</div>
															<? } ?>
														</div>
														
														<div class="row">
															<? if($MONDAY == 1) $disable=""; else  $disable="disabled"; ?>
															<div class="col-md-2 form-group custom-control custom-checkbox form-group">
																<input type="checkbox" class="custom-control-input" id="MON" name="MONDAY" value="1" <? if($MONDAY == 1) echo "checked"; ?> onclick="enable_time('MON')" >
																<label class="custom-control-label" for="MON"><?=MONDAY?></label>
															</div>
															
															<div class="col-2 form-group" >
																<input type="text" id="MON_START_TIME" name="MON_START_TIME" value="<?=$MON_START_TIME?>" class="form-control timepicker padding_2" onchange="get_hour('MON')" <?=$disable ?>  >
																<span class="bar"></span> 
															</div>
															<div class="col-2 form-group"  >
																<input type="text" id="MON_END_TIME" name="MON_END_TIME" value="<?=$MON_END_TIME?>" class="form-control timepicker padding_2" onchange="get_hour('MON')" <?=$disable ?>  >
																<span class="bar"></span> 
															</div>
															<div class="col-2 form-group"  >
																<input type="text" id="MON_HOURS" name="MON_HOURS" value="<?=$MON_HOURS?>" class="form-control padding_2" <?=$disable ?> >
																<span class="bar"></span> 
															</div>
															<div class="col-md-2 form-group"  >
																<? $_REQUEST['campus'] 		 = $PK_CAMPUS;
																$_REQUEST['name'] 		 	 = 'MON_ROOM';
																$_REQUEST['id'] 		 	 = 'MON_ROOM';
																$_REQUEST['SELECTED_VALUE1'] = $MON_ROOM;
																$_REQUEST['disable'] 		 = $disable;
																include("ajax_get_campus_room.php"); ?>
															</div>
															<? if($ENABLE_ATTENDANCE_ACTIVITY_TYPES == 1){ ?>
															<div class="col-2 form-group" >
																<select id="MON_PK_ATTENDANCE_ACTIVITY_TYPE" name="MON_PK_ATTENDANCE_ACTIVITY_TYPE" class="form-control" <?=$disable ?> >
																	<option value="" ></option>
																	<? /* Ticket #1695  */
																	$res_type = $db->Execute("select PK_ATTENDANCE_ACTIVITY_TYPE, ATTENDANCE_ACTIVITY_TYPE, ACTIVE from M_ATTENDANCE_ACTIVITY_TYPE WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' order by ACTIVE DESC, ATTENDANCE_ACTIVITY_TYPE ASC");
																	while (!$res_type->EOF) { 
																		$option_label = $res_type->fields['ATTENDANCE_ACTIVITY_TYPE'];
																		if($res_type->fields['ACTIVE'] == 0)
																			$option_label .= " (Inactive)"; ?>
																		<option value="<?=$res_type->fields['PK_ATTENDANCE_ACTIVITY_TYPE'] ?>" <? if($MON_PK_ATTENDANCE_ACTIVITY_TYPE == $res_type->fields['PK_ATTENDANCE_ACTIVITY_TYPE']) echo "selected"; ?> <? if($res_type->fields['ACTIVE'] == 0) echo "class='option_red'"; ?> ><?=$option_label ?></option>
																	<?	$res_type->MoveNext();
																	} /* Ticket #1695  */ ?>
																</select>
															</div>
															<? } ?>
														</div>
														
														<div class="row">
															<? if($TUESDAY == 1) $disable=""; else  $disable="disabled"; ?>
															<div class="col-md-2 form-group custom-control custom-checkbox form-group">
																<input type="checkbox" class="custom-control-input" id="TUE" name="TUESDAY" value="1" <? if($TUESDAY == 1) echo "checked"; ?> onclick="enable_time('TUE')" >
																<label class="custom-control-label" for="TUE"><?=TUESDAY?></label>
															</div>
															
															<div class="col-2 form-group"  >
																<input type="text" id="TUE_START_TIME" name="TUE_START_TIME" value="<?=$TUE_START_TIME?>" class="form-control timepicker padding_2" onchange="get_hour('TUE')" <?=$disable ?>  >
																<span class="bar"></span> 
															</div>
															<div class="col-2 form-group"  >
																<input type="text" id="TUE_END_TIME" name="TUE_END_TIME" value="<?=$TUE_END_TIME?>" class="form-control timepicker padding_2" onchange="get_hour('TUE')" <?=$disable ?>  >
																<span class="bar"></span> 
															</div>
															<div class="col-2 form-group"  >
																<input type="text" id="TUE_HOURS" name="TUE_HOURS" value="<?=$TUE_HOURS?>" class="form-control padding_2" <?=$disable ?> >
																<span class="bar"></span> 
															</div>
															<div class="col-md-2 form-group"  >
																<? $_REQUEST['campus'] 		 = $PK_CAMPUS;
																$_REQUEST['name'] 		 	 = 'TUE_ROOM';
																$_REQUEST['id'] 		 	 = 'TUE_ROOM';
																$_REQUEST['SELECTED_VALUE1'] = $TUE_ROOM;
																$_REQUEST['disable'] 		 = $disable;
																include("ajax_get_campus_room.php"); ?>
															</div>
															
															<? if($ENABLE_ATTENDANCE_ACTIVITY_TYPES == 1){ ?>
															<div class="col-2 form-group" >
																<select id="TUE_PK_ATTENDANCE_ACTIVITY_TYPE" name="TUE_PK_ATTENDANCE_ACTIVITY_TYPE" class="form-control" <?=$disable ?> >
																	<option value="" ></option>
																	<? /* Ticket #1695  */
																	$res_type = $db->Execute("select PK_ATTENDANCE_ACTIVITY_TYPE, ATTENDANCE_ACTIVITY_TYPE, ACTIVE from M_ATTENDANCE_ACTIVITY_TYPE WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' order by ACTIVE DESC, ATTENDANCE_ACTIVITY_TYPE ASC");
																	while (!$res_type->EOF) { 
																		$option_label = $res_type->fields['ATTENDANCE_ACTIVITY_TYPE'];
																		if($res_type->fields['ACTIVE'] == 0)
																			$option_label .= " (Inactive)"; ?>
																		<option value="<?=$res_type->fields['PK_ATTENDANCE_ACTIVITY_TYPE'] ?>" <? if($TUE_PK_ATTENDANCE_ACTIVITY_TYPE == $res_type->fields['PK_ATTENDANCE_ACTIVITY_TYPE']) echo "selected"; ?> <? if($res_type->fields['ACTIVE'] == 0) echo "class='option_red'"; ?> ><?=$option_label ?></option>
																	<?	$res_type->MoveNext();
																	} /* Ticket #1695  */ ?>
																</select>
															</div>
															<? } ?>
														</div>
														
														<div class="row">
															<? if($WEDNESDAY == 1) $disable=""; else  $disable="disabled"; ?>
															<div class="col-md-2 form-group custom-control custom-checkbox form-group">
																<input type="checkbox" class="custom-control-input" id="WED" name="WEDNESDAY" value="1" <? if($WEDNESDAY == 1) echo "checked"; ?> onclick="enable_time('WED')" >
																<label class="custom-control-label" for="WED"><?=WEDNESDAY?></label>
															</div>
															
															<div class="col-2 form-group"  >
																<input type="text" id="WED_START_TIME" name="WED_START_TIME" value="<?=$WED_START_TIME?>" class="form-control timepicker padding_2" onchange="get_hour('WED')" <?=$disable ?>  >
																<span class="bar"></span> 
															</div>
															<div class="col-2 form-group"  >
																<input type="text" id="WED_END_TIME" name="WED_END_TIME" value="<?=$WED_END_TIME?>" class="form-control timepicker padding_2" onchange="get_hour('WED')" <?=$disable ?>  >
																<span class="bar"></span> 
															</div>
															<div class="col-2 form-group"  >
																<input type="text" id="WED_HOURS" name="WED_HOURS" value="<?=$WED_HOURS?>" class="form-control padding_2" <?=$disable ?> >
																<span class="bar"></span> 
															</div>
															<div class="col-md-2 form-group"  >
																<? $_REQUEST['campus'] 		 = $PK_CAMPUS;
																$_REQUEST['name'] 		 	 = 'WED_ROOM';
																$_REQUEST['id'] 		 	 = 'WED_ROOM';
																$_REQUEST['SELECTED_VALUE1'] = $WED_ROOM;
																$_REQUEST['disable'] 		 = $disable;
																include("ajax_get_campus_room.php"); ?>
															</div>
															
															<? if($ENABLE_ATTENDANCE_ACTIVITY_TYPES == 1){ ?>
															<div class="col-2 form-group" >
																<select id="WED_PK_ATTENDANCE_ACTIVITY_TYPE" name="WED_PK_ATTENDANCE_ACTIVITY_TYPE" class="form-control" <?=$disable ?> >
																	<option value="" ></option>
																	<? /* Ticket #1695  */
																	$res_type = $db->Execute("select PK_ATTENDANCE_ACTIVITY_TYPE, ATTENDANCE_ACTIVITY_TYPE, ACTIVE from M_ATTENDANCE_ACTIVITY_TYPE WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' order by ACTIVE DESC, ATTENDANCE_ACTIVITY_TYPE ASC");
																	while (!$res_type->EOF) { 
																		$option_label = $res_type->fields['ATTENDANCE_ACTIVITY_TYPE'];
																		if($res_type->fields['ACTIVE'] == 0)
																			$option_label .= " (Inactive)"; ?>
																		<option value="<?=$res_type->fields['PK_ATTENDANCE_ACTIVITY_TYPE'] ?>" <? if($WED_PK_ATTENDANCE_ACTIVITY_TYPE == $res_type->fields['PK_ATTENDANCE_ACTIVITY_TYPE']) echo "selected"; ?> <? if($res_type->fields['ACTIVE'] == 0) echo "class='option_red'"; ?> ><?=$option_label ?></option>
																	<?	$res_type->MoveNext();
																	} /* Ticket #1695  */ ?>
																</select>
															</div>
															<? } ?>
														</div>
														
														<div class="row">
															<? if($THURSDAY == 1) $disable=""; else  $disable="disabled"; ?>
															<div class="col-md-2 form-group custom-control custom-checkbox form-group">
																<input type="checkbox" class="custom-control-input" id="THU" name="THURSDAY" value="1" <? if($THURSDAY == 1) echo "checked"; ?> onclick="enable_time('THU')" >
																<label class="custom-control-label" for="THU"><?=THURSDAY?></label>
															</div>
															
															<div class="col-2 form-group"  >
																<input type="text" id="THU_START_TIME" name="THU_START_TIME" value="<?=$THU_START_TIME?>" class="form-control timepicker padding_2" onchange="get_hour('THU')" <?=$disable ?>  >
																<span class="bar"></span> 
															</div>
															<div class="col-2 form-group"  >
																<input type="text" id="THU_END_TIME" name="THU_END_TIME" value="<?=$THU_END_TIME?>" class="form-control timepicker padding_2" onchange="get_hour('THU')" <?=$disable ?>  >
																<span class="bar"></span> 
															</div>
															<div class="col-2 form-group"  >
																<input type="text" id="THU_HOURS" name="THU_HOURS" value="<?=$THU_HOURS?>" class="form-control padding_2" <?=$disable ?> >
																<span class="bar"></span> 
															</div>
															<div class="col-md-2 form-group"  >
																<? $_REQUEST['campus'] 		 = $PK_CAMPUS;
																$_REQUEST['name'] 		 	 = 'THU_ROOM';
																$_REQUEST['id'] 		 	 = 'THU_ROOM';
																$_REQUEST['SELECTED_VALUE1'] = $THU_ROOM;
																$_REQUEST['disable'] 		 = $disable;
																include("ajax_get_campus_room.php"); ?>
															</div>
															
															<? if($ENABLE_ATTENDANCE_ACTIVITY_TYPES == 1){ ?>
															<div class="col-2 form-group" >
																<select id="THU_PK_ATTENDANCE_ACTIVITY_TYPE" name="THU_PK_ATTENDANCE_ACTIVITY_TYPE" class="form-control" <?=$disable ?> >
																	<option value="" ></option>
																	<? /* Ticket #1695  */
																	$res_type = $db->Execute("select PK_ATTENDANCE_ACTIVITY_TYPE, ATTENDANCE_ACTIVITY_TYPE, ACTIVE from M_ATTENDANCE_ACTIVITY_TYPE WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' order by ACTIVE DESC, ATTENDANCE_ACTIVITY_TYPE ASC");
																	while (!$res_type->EOF) { 
																		$option_label = $res_type->fields['ATTENDANCE_ACTIVITY_TYPE'];
																		if($res_type->fields['ACTIVE'] == 0)
																			$option_label .= " (Inactive)"; ?>
																		<option value="<?=$res_type->fields['PK_ATTENDANCE_ACTIVITY_TYPE'] ?>" <? if($THU_PK_ATTENDANCE_ACTIVITY_TYPE == $res_type->fields['PK_ATTENDANCE_ACTIVITY_TYPE']) echo "selected"; ?> <? if($res_type->fields['ACTIVE'] == 0) echo "class='option_red'"; ?> ><?=$option_label ?></option>
																	<?	$res_type->MoveNext();
																	} /* Ticket #1695  */ ?>
																</select>
															</div>
															<? } ?>
														</div>
														
														<div class="row">
															<? if($FRIDAY == 1) $disable=""; else  $disable="disabled"; ?>
															<div class="col-md-2 form-group custom-control custom-checkbox form-group">
																<input type="checkbox" class="custom-control-input" id="FRI" name="FRIDAY" value="1" <? if($FRIDAY == 1) echo "checked"; ?> onclick="enable_time('FRI')" >
																<label class="custom-control-label" for="FRI"><?=FRIDAY?></label>
															</div>
															
															<div class="col-2 form-group"  >
																<input type="text" id="FRI_START_TIME" name="FRI_START_TIME" value="<?=$FRI_START_TIME?>" class="form-control timepicker padding_2" onchange="get_hour('FRI')" <?=$disable ?>  >
																<span class="bar"></span> 
															</div>
															<div class="col-2 form-group"  >
																<input type="text" id="FRI_END_TIME" name="FRI_END_TIME" value="<?=$FRI_END_TIME?>" class="form-control timepicker padding_2" onchange="get_hour('FRI')" <?=$disable ?>  >
																<span class="bar"></span> 
															</div>
															<div class="col-2 form-group"  >
																<input type="text" id="FRI_HOURS" name="FRI_HOURS" value="<?=$FRI_HOURS?>" class="form-control padding_2" <?=$disable ?> >
																<span class="bar"></span> 
															</div>
															<div class="col-md-2 form-group"  >
																<? $_REQUEST['campus'] 		 = $PK_CAMPUS;
																$_REQUEST['name'] 		 	 = 'FRI_ROOM';
																$_REQUEST['id'] 		 	 = 'FRI_ROOM';
																$_REQUEST['SELECTED_VALUE1'] = $FRI_ROOM;
																$_REQUEST['disable'] 		 = $disable;
																include("ajax_get_campus_room.php"); ?>
															</div>	
															
															<? if($ENABLE_ATTENDANCE_ACTIVITY_TYPES == 1){ ?>
															<div class="col-2 form-group" >
																<select id="FRI_PK_ATTENDANCE_ACTIVITY_TYPE" name="FRI_PK_ATTENDANCE_ACTIVITY_TYPE" class="form-control" <?=$disable ?> >
																	<option value="" ></option>
																	<? /* Ticket #1695  */
																	$res_type = $db->Execute("select PK_ATTENDANCE_ACTIVITY_TYPE, ATTENDANCE_ACTIVITY_TYPE, ACTIVE from M_ATTENDANCE_ACTIVITY_TYPE WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' order by ACTIVE DESC, ATTENDANCE_ACTIVITY_TYPE ASC");
																	while (!$res_type->EOF) { 
																		$option_label = $res_type->fields['ATTENDANCE_ACTIVITY_TYPE'];
																		if($res_type->fields['ACTIVE'] == 0)
																			$option_label .= " (Inactive)"; ?>
																		<option value="<?=$res_type->fields['PK_ATTENDANCE_ACTIVITY_TYPE'] ?>" <? if($FRI_PK_ATTENDANCE_ACTIVITY_TYPE == $res_type->fields['PK_ATTENDANCE_ACTIVITY_TYPE']) echo "selected"; ?> <? if($res_type->fields['ACTIVE'] == 0) echo "class='option_red'"; ?> ><?=$option_label ?></option>
																	<?	$res_type->MoveNext();
																	} /* Ticket #1695  */ ?>
																</select>
															</div>
															<? } ?>
														</div>
														
														<div class="row">
															<? if($SATURDAY == 1) $disable=""; else  $disable="disabled"; ?>
															<div class="col-md-2 form-group custom-control custom-checkbox form-group">
																<input type="checkbox" class="custom-control-input" id="SAT" name="SATURDAY" value="1" <? if($SATURDAY == 1) echo "checked"; ?> onclick="enable_time('SAT')" >
																<label class="custom-control-label" for="SAT"><?=SATURDAY?></label>
															</div>
															
															<div class="col-2 form-group"  >
																<input type="text" id="SAT_START_TIME" name="SAT_START_TIME" value="<?=$SAT_START_TIME?>" class="form-control timepicker padding_2" onchange="get_hour('SAT')" <?=$disable ?>  >
																<span class="bar"></span> 
															</div>
															<div class="col-2 form-group"  >
																<input type="text" id="SAT_END_TIME" name="SAT_END_TIME" value="<?=$SAT_END_TIME?>" class="form-control timepicker padding_2" onchange="get_hour('SAT')" <?=$disable ?>  >
																<span class="bar"></span> 
															</div>
															<div class="col-2 form-group" >
																<input type="text" id="SAT_HOURS" name="SAT_HOURS" value="<?=$SAT_HOURS?>" class="form-control padding_2" <?=$disable ?> >
																<span class="bar"></span> 
															</div>
															<div class="col-md-2 form-group"  >
																<? $_REQUEST['campus'] 		 = $PK_CAMPUS;
																$_REQUEST['name'] 		 	 = 'SAT_ROOM';
																$_REQUEST['id'] 		 	 = 'SAT_ROOM';
																$_REQUEST['SELECTED_VALUE1'] = $SAT_ROOM;
																$_REQUEST['disable'] 		 = $disable;
																include("ajax_get_campus_room.php"); ?>
															</div>
															
															<? if($ENABLE_ATTENDANCE_ACTIVITY_TYPES == 1){ ?>
															<div class="col-2 form-group" >
																<select id="SAT_PK_ATTENDANCE_ACTIVITY_TYPE" name="SAT_PK_ATTENDANCE_ACTIVITY_TYPE" class="form-control" <?=$disable ?> >
																	<option value="" ></option>
																	<? /* Ticket #1695  */
																	$res_type = $db->Execute("select PK_ATTENDANCE_ACTIVITY_TYPE, ATTENDANCE_ACTIVITY_TYPE, ACTIVE from M_ATTENDANCE_ACTIVITY_TYPE WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' order by ACTIVE DESC, ATTENDANCE_ACTIVITY_TYPE ASC");
																	while (!$res_type->EOF) { 
																		$option_label = $res_type->fields['ATTENDANCE_ACTIVITY_TYPE'];
																		if($res_type->fields['ACTIVE'] == 0)
																			$option_label .= " (Inactive)"; ?>
																		<option value="<?=$res_type->fields['PK_ATTENDANCE_ACTIVITY_TYPE'] ?>" <? if($SAT_PK_ATTENDANCE_ACTIVITY_TYPE == $res_type->fields['PK_ATTENDANCE_ACTIVITY_TYPE']) echo "selected"; ?> <? if($res_type->fields['ACTIVE'] == 0) echo "class='option_red'"; ?> ><?=$option_label ?></option>
																	<?	$res_type->MoveNext();
																	} /* Ticket #1695  */ ?>
																</select>
															</div>
															<? } ?>
														</div>
														
														<div class="row">
															<div class="col-6 form-group">
																<div class="row">
																	<div class="col-12 form-group custom-control custom-checkbox form-group">
																		<input type="checkbox" class="custom-control-input" id="SCHEDULE_ON_HOLIDAY" name="SCHEDULE_ON_HOLIDAY" <? if($SCHEDULE_ON_HOLIDAY == 1) echo "checked"; ?> value="1" >
																		<label class="custom-control-label" for="SCHEDULE_ON_HOLIDAY"><?=SCHEDULE_ON_HOLIDAY?></label>
																	</div>
																</div>
																
																<div class="row">
																	<div class="col-12 form-group custom-control custom-checkbox form-group">
																		<input type="checkbox" class="custom-control-input" id="OVERWRITE_SCHEDULE_DATE" name="OVERWRITE_SCHEDULE_DATE" <? if($OVERWRITE_SCHEDULE_DATE == 1) echo "checked"; ?> value="1" >
																		<label class="custom-control-label" for="OVERWRITE_SCHEDULE_DATE"><?=OVERWRITE_SCHEDULE_DATE?></label>
																	</div>
																</div>
																
															</div>
															<div class="col-6 form-group ">
																<br />
																<button type="button" onclick="build_schedule(1)" class="btn waves-effect waves-light btn-info"><?=BUILD_SCHEDULE?></button>
																
																<button type="button" onclick="import_schedule()" class="btn waves-effect waves-light btn-info"><?=IMPORT_SCHEDULE?></button>
															</div>
														</div>
														
													</div>
													<div class="col-md-7 theme-v-border">
														<div class="row">
															<div class="col-md-2" style="max-width:13.667%" ><b><?=DATE?></b></div>
															<div class="col-md-1" style="max-width:7%;padding-right: 0;" ><b><?=DAY?></b></div>
															<div class="col-md-2" style="max-width:13.667%" ><b><?=START_TIME?></b></div>
															<div class="col-md-2" style="max-width:13.667%" ><b><?=END_TIME?></b></div>
															<div class="col-md-1"><b><?=HOUR?></b></div>
															<div class="col-md-1" ><b><?=ROOM?></b></div>
															<? if($ENABLE_ATTENDANCE_ACTIVITY_TYPES == 1){ ?>
																<div class="col-md-2" ><b><?=ACTIVITY_TYPE?></b></div>
															<? } ?>
															<div class="col-md-1" style="padding:0" ><b>Comp. ?</b></div>
															<div class="col-md-1" style="padding:0;max-width: 9.333%;" >
																<b>
																	<?=OPTIONS?>
																	<a href="javascript:void(0)" title="<?=ADD_SCHEDULE?>" onclick="add_single_schedule()" class="d-none d-lg-block" style="float: right;" ><i class="fa fa-plus-circle"></i></a>
																</b>
															</div>
														</div>
														
														<div id="schedule_div" style="overflow-y: auto;height: 695px;overflow-x: hidden;" >
															<? $count = 0;
															$TOTAL_SCHEDULED_HOURS = 0;
															if($_GET['id'] != ''){ 
																$_REQUEST['PK_COURSE_OFFERING'] = $_GET['id'];
																$_REQUEST['BUILD'] 				= 0;
																$_REQUEST['index'] 				= $count;
																include("ajax_build_course_offering_schedule.php");
																
																$res_type = $db->Execute("select SUM(HOURS) AS TOTAL_SCHEDULED_HOURS from S_COURSE_OFFERING_SCHEDULE_DETAIL WHERE PK_COURSE_OFFERING = '$_GET[id]' AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' ");
																$TOTAL_SCHEDULED_HOURS = $res_type->fields['TOTAL_SCHEDULED_HOURS'];
															} ?>
														</div>
														
														
														<div class="row">
															<input type="hidden" name="COURSE_HOUR" id="COURSE_HOUR" value="<?=$COURSE_HOUR?>" >
															<div class="col-md-4"><b><?=COURSE_HOURS?>: <span id="COURSE_HOUR_DIV"><?=$COURSE_HOUR?></span></b></div>
															<div class="col-md-4" ><b><?=TOTAL_SCHEDULED_HOURS?>: <span id="TOTAL_SCHEDULED_HOURS_SPAN"><?=$TOTAL_SCHEDULED_HOURS?></span></b></div>
														</div>
														<br />
													</div>
												</div>
												
												<div class="row">
													<div class="col-sm-6 form-group">
													</div>
													<div class="col-sm-6 form-group">
														<button type="button" onclick="validate_form(1)" class="btn waves-effect waves-light btn-info"><?=SAVE_CONTINUE?></button>
														
														<button type="button" onclick="validate_form(0)" class="btn waves-effect waves-light btn-info"><?=SAVE_EXIT?></button>
														
														<button type="button" onclick="window.location.href='manage_course_offering'" class="btn waves-effect waves-light btn-dark"><?=CANCEL?></button>
														
														<button type="button" onclick="delete_row('','bulk_schedule')" class="btn waves-effect waves-light btn-dark" id="DELETE_SCHEDULE_BTN" ><?=DELETE_UNCOMP_SCHEDULE?></button>
													</div>
												</div>
											
											</div>
										</div>
									
										<div class="tab-pane <?=$student_tab?>" id="studentTab" role="tabpanel">
											<div class="row">
												<div class="col-md-10 align-self-center">
												</div>  
												<div class="col-md-2 align-self-center text-right">
													<div class="d-flex justify-content-end align-items-center">
														<a href="javascript:void(0)" onclick="add_course_student()" class="btn btn-info d-none d-lg-block m-l-15"><i class="fa fa-plus-circle"></i> <?=ADD_STUDENTS?></a>&nbsp;&nbsp;
													</div>
												</div>
											</div>
											
											<div class="p-20">
												<div class="table-responsive">
													
													<?php //NO_OF_STUDENTS.': '.$res_type->RecordCount() ?>
													<table class="table table-hover">
														<thead>
															<tr>
																<th><?=STUDENT?></th>
																<th><?=STUDENT_ID?></th>
																<th><?=ENROLLMENT?></th>
																<th><?=PROGRAM?></th>
																<th><?=STATUS?></th>
																<th><?=GROUP_CODE?></th>
																<th><?=OPTIONS?></th>
															</tr>
														</thead>
														<tbody id="students_list">
														
													</tbody>
													</table>
												</div>
											</div>
										</div>
										
										<div class="tab-pane <?=$final_grade_tab?>" id="finalGradeTab" role="tabpanel">
											<!-- DIAM-785 -->
											<div class="row">
												<div class="col-md-12 align-self-center">
													<div class="d-flex justify-content-end align-items-center">													
															<?
															$final_grade_res = $db->Execute("SELECT PK_STUDENT_COURSE FROM S_STUDENT_COURSE_HISTROY WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' AND PK_COURSE_OFFERING = '$_GET[id]' ORDER BY PK_STUDENT_COURSE ASC "); //Ticket #1290
															$final_grade_cnt = $final_grade_res->RecordCount();
															if ($final_grade_cnt > 0) {
															?>														
															<a href="javascript:void(0)" onclick="confirm_restore_final_grade()" class="btn waves-effect waves-light btn-info"><?= RESTORE_FINAL_GRADE ?></a>&nbsp;&nbsp;
															<?php } ?>
													</div>
												</div>
											</div>
											<!-- DIAM-785 -->
											<div class="p-20">
												<table data-toggle="table" data-mobile-responsive="true" class="table-striped" id="grade_input_table1" >
													<thead>
														<!-- Ticket # 1963 -->
														<tr>
															<th ><?=STUDENT?></th>
															<th ><?=STUDENT_ID?></th>
															<th ><?=FINAL_GRADE?></th>
															<th ><?=FINAL_NUMERIC_GRADE_1?></th>
															<th ><?=MIDPOINT_GRADE?></th>
															<th ><?=COURSE_OFFERING_STUDENT_STATUS?></th><!-- Ticket #1685 -->
															<th ><?=INACTIVE?></th>
															<th ><?=RETURN_DATE?></th> <!-- Ticket #1156 -->
															<th ><?=ENROLLMENT?></th>
															<th ><?=BEGIN_DATE?></th>
															<th ><?=END_DATE?></th>
														</tr>
														<!-- Ticket # 1963 -->
													</thead>
													<tbody id="finalGradBook">
														<? //$_REQUEST['PK_COURSE_OFFERING'] = $_GET['id']; 
														//include("ajax_build_final_grade_book_input.php"); ?>
													</tbody>
												</table>
											</div>
											
											<div class="row">
												<div class="col-sm-12" style="text-align:center" >
													<button type="button" onclick="validate_form(4)" class="btn waves-effect waves-light btn-info"><?=SAVE_CONTINUE?></button>
													
													<button type="button" onclick="validate_form(5)" class="btn waves-effect waves-light btn-info"><?=SAVE_EXIT?></button>
													
													<button type="button" onclick="window.location.href='manage_course_offering'" class="btn waves-effect waves-light btn-dark"><?=CANCEL?></button>
													
													<br /><br />
												</div>
											</div>
										</div>
										
										<div class="tab-pane <?=$grade_tab?>" id="gradeTab" role="tabpanel">
											<div class="row">
												<div class="col-md-4 align-self-center"><!--27 June-->
												</div>  
												<div class="col-md-8 align-self-center text-right"><!--27 June-->
													<div class="d-flex justify-content-end align-items-center">
														<!--27 June-->
														<?
															$result1 = $db->Execute("SELECT PK_COURSE_OFFERING_GRADE FROM S_COURSE_OFFERING_GRADE_HISTROY WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' AND PK_COURSE_OFFERING = '$_GET[id]' ORDER BY GRADE_ORDER ASC "); //Ticket #1290
															$reccnt = $result1->RecordCount();
															if ($reccnt > 0) {
															?>														
															<a href="javascript:void(0)" onclick="confirm_restore_grade_book_setup()" class="btn waves-effect waves-light btn-info"><?= RESTORE_GRADE_BOOK_SETUP ?></a>&nbsp;&nbsp;
														<?php } ?>
														<!--27 June-->
														<a href="javascript:void(0)" onclick="import_grade()" class="btn btn-info d-none d-lg-block m-l-15"><i class="fa fa-plus-circle"></i> <?=IMPORT_GRADE?></a>&nbsp;&nbsp;
														<a href="javascript:void(0)" onclick="add_grade()" class="btn btn-info d-none d-lg-block m-l-15"><i class="fa fa-plus-circle"></i> <?=ADD?></a>&nbsp;&nbsp;
													</div>
												</div>
											</div>
											
											<div class="p-20">
												<table data-toggle="table" data-mobile-responsive="true" class="table-striped" id="grade_table" >
													<thead>
														<tr>
															<th ><?=COLUMN?></th> <!-- Ticket #1290 -->
															<th ><?=CODE?></th>
															<th ><?=DESCRIPTION?></th>
															<th ><?=TYPE?></th>
															<th ><?=DATE?></th>
															<!--<th ><?=PERIOD?></th>-->
															<th ><?=POINTS?></th>
															<th ><?=WEIGHT?></th>
															<th ><?=WEIGHTED_POINTS?></th>
															<th ><?=DELETE?></th>
														</tr>
													</thead>
													<tbody id="grad_list">
													</tbody>
													<tfoot>
														<!-- Ticket # 1492 -->
														<?php $result1 = $db->Execute("SELECT SUM(POINTS) AS POINTS, SUM(WEIGHT) AS WEIGHT, SUM(WEIGHTED_POINTS) AS WEIGHTED_POINTS FROM S_COURSE_OFFERING_GRADE WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' AND PK_COURSE_OFFERING = '$_GET[id]' "); ?>
														<tr>
															<td></td>
															<td></td>
															<td></td>
															<td></td>
															<td><?=TOTALS?></td>
															<!--<td></td>-->
															<td><div id="POINTS_TOTAL" style="font-weight:bold;" ><?=$result1->fields['POINTS']?></div></td>
															<td><div id="WEIGHTED_TOTAL" style="font-weight:bold;" ><?=$result1->fields['WEIGHT']?></div></td>
															<td><div id="WEIGHTED_POINTS_TOTAL" style="tfont-weight:bold;" ><?=$result1->fields['WEIGHTED_POINTS']?></div></td>
															<td></td>
														</tr>
														<!-- Ticket # 1492 -->
													</tfoot>
												</table>
												
												<br />
												<div class="row">
													<div class="col-md-8">
														<div class="form-group m-b-5"  style="text-align:right" >
															<button type="button" onclick="validate_form(1)" class="btn waves-effect waves-light btn-info"><?=SAVE_CONTINUE?></button>
														
															<button type="button" onclick="validate_form(0)" class="btn waves-effect waves-light btn-info"><?=SAVE_EXIT?></button>
															
															<button type="button" onclick="window.location.href='manage_course_offering'" class="btn waves-effect waves-light btn-dark"><?=CANCEL?></button>
														</div>
													</div>
												</div>
											</div>
										</div>
										
										<div class="tab-pane <?=$grade_input_tab?>" id="gradeInputTab" role="tabpanel">
											<div class="p-20">
												<div class="row">
													<div class="col-md-12">
														<div class="form-group m-b-5"  style="text-align:right" >

															<!--27 June-->
															<?
															$result_SGH = $db->Execute("SELECT PK_STUDENT_GRADE FROM S_STUDENT_GRADE_HISTROY WHERE PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' AND PK_COURSE_OFFERING = '$_GET[id]'"); //Ticket #1290
															$reccnt_SGH = $result_SGH->RecordCount();
															if ($reccnt_SGH > 0) {
															?>		
																<a class="btn waves-effect waves-light btn-info" style="color:#FFFFFF;" href="javascript:void(0)" onclick="confirm_restore_grade_book_entry()"><?= RESTORE_GRADE_BOOK_ENTRY ?></a>

															<?php } ?>
															<!--27 June-->

															<a class="btn waves-effect waves-light btn-info" style="color:#FFFFFF;" target="_blank" href="grade_book_report?co_id=<?=$_GET['id']?>&FORMAT=1" >GRADE BOOK <?=PDF?></a><!--DIAM-1599 -->
															<a class="btn waves-effect waves-light btn-info" style="color:#FFFFFF;" target="_blank" href="course_offering_grade_book_analysis_report?co_id=<?=$_GET['id']?>&format=1" ><?=PDF?></a>
															<a class="btn waves-effect waves-light btn-info" style="color:#FFFFFF;" target="_blank" href="course_offering_grade_book_analysis_report?co_id=<?=$_GET['id']?>&format=2" ><?=EXCEL?></a>
														</div>
													</div>
												</div>
												
												<div id="table-scroll" class="table-scroll">
													<div class="table-wrap" id="gradeBookEntryData"> <!-- //16 may 23 -->
																									
														
														
													 </div>
												</div>
												
												<br />
												<!--Ticket # 1505-->
												<div class="row">
													<div class="col-md-6">
														<div class="form-group m-b-5"  >
															<button type="button" onclick="calc_final_grade(0)" class="btn waves-effect waves-light btn-dark"><?=RECALCULATE?></button>
															<button type="button" onclick="calc_final_grade(1)" class="btn waves-effect waves-light btn-info"><?=POST_FINAL_TOTAL?></button>
															<button type="button" onclick="calc_final_grade(2)" class="btn waves-effect waves-light btn-info"><?=POST_CURRENT_TOTAL?></button>
														</div>
													</div>
													<div class="col-md-6" style="text-align:right" >
														<div class="form-group m-b-5"  >
															<button type="button" onclick="validate_form(2)" class="btn waves-effect waves-light btn-info"><?=SAVE_CONTINUE?></button>
															<button type="button" onclick="validate_form(3)" class="btn waves-effect waves-light btn-info"><?=SAVE_EXIT?></button>
															<button type="button" onclick="window.location.href='manage_course_offering'" class="btn waves-effect waves-light btn-dark"><?=CANCEL?></button>
															<!--<button type="button" onclick="goto_final_grade()" class="btn waves-effect waves-light btn-dark"><?=FINAL_GRADE?></button>-->
														</div>
													</div>
												</div>
												<!--Ticket # 1505-->
											</div>
										</div>
										
										<div class="tab-pane <?=$nonSchedule_tab?>" id="nonScheduleTab" role="tabpanel">
										
											<div class="row">
												<div class="col-md-8 align-self-center">
												</div>  
												<div class="col-md-4 align-self-center text-right">
													<div class="d-flex justify-content-end align-items-center">
														<a href="javascript:void(0)" onclick="add_non_schedule_attendance()" class="btn btn-info d-none d-lg-block m-l-15"><i class="fa fa-plus-circle"></i> <?=ADD?></a>&nbsp;&nbsp;
													</div>
												</div>
											</div>
											<div class="p-20">
												<div class="table-responsive">	
												
												<table class="table table-hover">
														<thead>
														<tr>
															<th><?=STUDENT?></th>
															<th><?=STUDENT_ID?></th><!-- Ticket # 1963 -->
															<th><?=CLASS_DATE?></th>
															<th><?=START_TIME?></th>
															<th><?=END_TIME?></th>
															<th><?=ATTENDED_HOUR?></th>
															<th><?=ATTENDED_CODE?></th>
															<th><?=COMPLETED_1?></th>
															<th><?=OPTION?></th>
														</tr>
													</thead>
													<tbody id="nonScheduleData"> <!-- //16 may 23 -->
											
													</tbody>
													</table>
												</div>			
											</div>
										</div>
										
										<div class="tab-pane <?=$waitingList_tab?>" id="waitingListTab" role="tabpanel">
											<div class="p-20">
												<? /* Ticket # 1963 */
												$result1 = $db->Execute("SELECT PK_COURSE_OFFERING_WAITING_LIST, STATUS_DATE, STUDENT_STATUS, CODE, CONCAT(LAST_NAME,', ',FIRST_NAME) AS NAME, IF(BEGIN_DATE = '0000-00-00','',DATE_FORMAT(BEGIN_DATE, '%m/%d/%Y' )) AS BEGIN_DATE_1, IS_ACTIVE_ENROLLMENT, S_STUDENT_ENROLLMENT.PK_STUDENT_ENROLLMENT, IF(S_COURSE_OFFERING_WAITING_LIST.CREATED_ON = '0000-00-00 00:00:00','',DATE_FORMAT(S_COURSE_OFFERING_WAITING_LIST.CREATED_ON, '%m/%d/%Y %r' )) AS CREATED_ON, STUDENT_ID, CAMPUS_CODE FROM S_COURSE_OFFERING_WAITING_LIST,S_STUDENT_MASTER, S_STUDENT_ACADEMICS, S_STUDENT_ENROLLMENT LEFT JOIN S_STUDENT_CAMPUS ON S_STUDENT_CAMPUS.PK_STUDENT_ENROLLMENT = S_STUDENT_ENROLLMENT.PK_STUDENT_ENROLLMENT LEFT JOIN S_CAMPUS ON S_CAMPUS.PK_CAMPUS = S_STUDENT_CAMPUS.PK_CAMPUS LEFT JOIN M_CAMPUS_PROGRAM ON M_CAMPUS_PROGRAM.PK_CAMPUS_PROGRAM =  S_STUDENT_ENROLLMENT.PK_CAMPUS_PROGRAM LEFT JOIN M_STUDENT_STATUS ON M_STUDENT_STATUS.PK_STUDENT_STATUS = S_STUDENT_ENROLLMENT.PK_STUDENT_STATUS LEFT JOIN S_TERM_MASTER ON S_TERM_MASTER.PK_TERM_MASTER = S_STUDENT_ENROLLMENT.PK_TERM_MASTER WHERE S_COURSE_OFFERING_WAITING_LIST.PK_STUDENT_ENROLLMENT = S_STUDENT_ENROLLMENT.PK_STUDENT_ENROLLMENT AND S_COURSE_OFFERING_WAITING_LIST.PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' AND PK_COURSE_OFFERING = '$_GET[id]' AND S_STUDENT_MASTER.PK_STUDENT_MASTER = S_STUDENT_ACADEMICS.PK_STUDENT_MASTER AND S_STUDENT_MASTER.PK_STUDENT_MASTER = S_STUDENT_ENROLLMENT.PK_STUDENT_MASTER");
												echo NO_STUDENTS_IN_WAITING_LIST.': '.$result1->RecordCount(); ?>
												<table data-toggle="table" data-mobile-responsive="true" class="table-striped" >
													<thead>
														<tr>
															<th ><?=STUDENT?></th>
															<th><?=STUDENT_ID?></th><!-- Ticket # 1963 -->
															<th ><?=ENROLLMENT?></th>
															<th ><?=ADDED_DATE?></th>
															<th ><?=ADD_TO_COURSE?></th>
															<th ><?=DELETE?></th>
														</tr>
													</thead>
													<tbody>
														<? while (!$result1->EOF) {
															$PK_COURSE_OFFERING_WAITING_LIST = $result1->fields['PK_COURSE_OFFERING_WAITING_LIST']; ?>
															<tr id="WAITINGLIST_<?=$PK_COURSE_OFFERING_WAITING_LIST?>" >
																<td ><?=$result1->fields['NAME']?></td>
																<td ><?=$result1->fields['STUDENT_ID']?></td>
																<td ><?=$result1->fields['BEGIN_DATE_1'].' - '.$result1->fields['CODE'].' - '.$result1->fields['STUDENT_STATUS'].' - '.$result1->fields['CAMPUS_CODE'] ?></td>
																<td><?=$result1->fields['CREATED_ON']?></td>
																<td >
																	<a href="javascript:void(0);" onclick="add_student_to_course_offering('<?=$result1->fields['PK_STUDENT_ENROLLMENT']?>','<?=$PK_COURSE_OFFERING_WAITING_LIST?>')" title="<?=ADD_TO_COURSE?>" class="btn delete-color btn-circle"><i class="fa fa-plus"></i> </a>
																</td>
																<td >
																	<a href="javascript:void(0);" onclick="delete_row('<?=$PK_COURSE_OFFERING_WAITING_LIST?>','waitingList')" title="Delete" class="btn delete-color btn-circle"><i class="far fa-trash-alt"></i> </a>
																</td>
															</tr>
														<?	$result1->MoveNext();
														} 
														/* Ticket # 1963 */ ?>
													</tbody>
												</table>
												
												<br />
												<!--<div class="row">
													<div class="col-md-8">
														<div class="form-group m-b-5"  style="text-align:right" >
															<button type="button" onclick="validate_form(1)" class="btn waves-effect waves-light btn-info"><?=SAVE_CONTINUE?></button>
														
															<button type="button" onclick="validate_form(0)" class="btn waves-effect waves-light btn-info"><?=SAVE_EXIT?></button>
															
															<button type="button" onclick="window.location.href='manage_course_offering'" class="btn waves-effect waves-light btn-dark"><?=CANCEL?></button>
														</div>
													</div>
												</div>-->
											</div>
										</div>
									<? } ?>
                                    <input type="hidden" name="SAVE_CONTINUE" id="SAVE_CONTINUE" value="0" />
									<input type="hidden" name="POST_GRADE_TYPE" id="POST_GRADE_TYPE" value="0" />
									<input type="hidden" name="UPDATE_STUD_TERM" id="UPDATE_STUD_TERM" value="0" /> <!-- Ticket # 1438 -->
									
                                    <input type="hidden" id="current_tab" name="current_tab" value="0" >
									<input type="hidden" id="current_tab_form_edited" name="current_tab_form_edited" value="0" >
                                </div>
                            </form>
                        </div>
					</div>
				</div>
				
            </div>
			
			<!-- Ticket # DIAM-741 27 june -->	
			<?php
			 function getUser($userId){
				global $db;
				$res_usr_name = $db->Execute("SELECT FIRST_NAME,LAST_NAME FROM S_EMPLOYEE_MASTER,Z_USER WHERE Z_USER.PK_USER = '$userId' AND Z_USER.ID = S_EMPLOYEE_MASTER.PK_EMPLOYEE_MASTER");
				return " ".$res_usr_name->fields['LAST_NAME'].', '.$res_usr_name->fields['FIRST_NAME'];
			 }
			?>										
			<div class="modal" id="restore_Modal_grade_book_setup" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel1">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h4 class="modal-title" id="exampleModalLabel1"><?= RESTORE_GRADE_BOOK_SETUP_LABEL ?></h4>
							<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						</div>
						<div class="modal-body">
							<!-- <div class="form-group" id="restore_Modal_grade_message"></div> -->
						<div style="" class="col-sm-4">
							<select id="RESTORE_GRADE_BOOK_SETUP" name="RESTORE_GRADE_BOOK_SETUP" class="form-control" style="width:180px">
								<option value="">Select Latest Date</option>
								<?
								$res_cos = $db->Execute("SELECT PK_COURSE_OFFERING_GRADE_HISTROY_ID,CREATED_ON,CREATED_BY,EDITED_BY FROM S_COURSE_OFFERING_GRADE_HISTROY WHERE PK_COURSE_OFFERING = '$_GET[id]' AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]'  GROUP BY CREATED_ON ORDER BY CREATED_ON DESC LIMIT 5");
								while (!$res_cos->EOF) {   
																			
										if($res_cos->fields['CREATED_BY']!=0){		
											$usr =  getUser($res_cos->fields['CREATED_BY']);									
										}else if($res_cos->fields['EDITED_BY']!=0){									
											$usr =  getUser($res_cos->fields['EDITED_BY']);
											
										}else{
											$usr = "No User";
										}
										?>										
									<option value="<?= $res_cos->fields['CREATED_ON'] ?>"><?= $res_cos->fields['CREATED_ON'] ?>  <?=$usr?></option>
								<? $res_cos->MoveNext();
								}  
								?>
							</select>
							<div class="validation-advice" id="RESTORE_GRADE_BOOK_SETUP_ERR" style="display:none;">This is a required field.</div>
						</div>
						</div>
						<div class="modal-footer">
							<button type="button" onclick="RestoreGradeBook(<?= $_GET['id'] ?>,'GB_SETUP')" class="btn waves-effect waves-light btn-info"><?= YES ?></button>
							<button type="button" class="btn waves-effect waves-light btn-dark" onclick="jQuery('#restore_Modal_grade_book_setup').modal('hide');"><?= NO ?></button>
						</div>
					</div>
				</div>
			</div>

			<div class="modal" id="restore_Modal_grade_book_entry" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel1">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h4 class="modal-title" id="exampleModalLabel1"><?= RESTORE_GRADE_BOOK_ENTRY_LABEL ?></h4>
							<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						</div>
						<div class="modal-body">
							<!-- <div class="form-group" id="restore_Modal_grade_message"></div> -->
							<div class="col-sm-4">
								<select id="RESTORE_GRADE_BOOK_ENTRY" name="RESTORE_GRADE_BOOK_ENTRY" class="form-control" style="width:180px">
									<option value="">Select Latest Date</option>
									<?
									$res_cos = $db->Execute("SELECT PK_STUDENT_GRADE_HISTROY_ID,CREATED_ON,CREATED_BY,EDITED_BY FROM S_STUDENT_GRADE_HISTROY WHERE PK_COURSE_OFFERING = '$_GET[id]' AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]'  GROUP BY CREATED_ON ORDER BY CREATED_ON DESC LIMIT 5");
									while (!$res_cos->EOF) { 
										if($res_cos->fields['CREATED_BY']!=0){		
											$usr =  getUser($res_cos->fields['CREATED_BY']);									
										}else if($res_cos->fields['EDITED_BY']!=0){									
											$usr =  getUser($res_cos->fields['EDITED_BY']);
											
										}else{
											$usr = "No User";
										}										
										?>
										<option value="<?= $res_cos->fields['CREATED_ON'] ?>"><?= $res_cos->fields['CREATED_ON'] ?>	 <?=$usr?>					
									</option>
									<? $res_cos->MoveNext();
									}  ?>
								</select>
								<div class="validation-advice" id="RESTORE_GRADE_BOOK_ENTRY_ERR" style="display:none;">This is a required field.</div>
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" onclick="RestoreGradeBook(<?= $_GET['id'] ?>,'GB_ENTRY')" class="btn waves-effect waves-light btn-info"><?= YES ?></button>
							<button type="button" class="btn waves-effect waves-light btn-dark" onclick="jQuery('#restore_Modal_grade_book_entry').modal('hide');"><?= NO ?></button>
						</div>
					</div>
				</div>
			</div>
			<!-- Ticket # DIAM-741 27 june -->
			<!--# DIAM-785 -->
			<div class="modal" id="restore_Modal_final_grade" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel1">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h4 class="modal-title" id="exampleModalLabel1"><?= RESTORE_FINAL_GRADE_LABEL ?></h4>
							<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						</div>
						<div class="modal-body">
						<div style="" class="col-sm-4">
							<select id="RESTORE_FINAL_GRADE" name="RESTORE_FINAL_GRADE" class="form-control" style="width:180px">
								<option value="">Select Latest Date</option>
								<?
								$res_final_grade = $db->Execute("SELECT PK_STUDENT_COURSE_HISTROY_ID,CREATED_ON,CREATED_BY,EDITED_BY FROM S_STUDENT_COURSE_HISTROY WHERE PK_COURSE_OFFERING = '$_GET[id]' AND PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]'  GROUP BY CREATED_ON ORDER BY CREATED_ON DESC LIMIT 5");
								while (!$res_final_grade->EOF) {   
																			
										if($res_final_grade->fields['CREATED_BY']!=0){		
											$usr =  getUser($res_final_grade->fields['CREATED_BY']);									
										}else if($res_final_grade->fields['EDITED_BY']!=0){									
											$usr =  getUser($res_final_grade->fields['EDITED_BY']);
											
										}else{
											$usr = "No User";
										}
										?>										
									<option value="<?= $res_final_grade->fields['CREATED_ON'] ?>"><?= $res_final_grade->fields['CREATED_ON'] ?>  <?=$usr?></option>
								<? $res_final_grade->MoveNext();
								}  
								?>
							</select>
							<div class="validation-advice" id="RESTORE_FINAL_GRADE_ERR" style="display:none;">This is a required field.</div>
						</div>
						</div>
						<div class="modal-footer">
							<button type="button" onclick="RestoreGradeBook(<?= $_GET['id'] ?>,'FG_SETUP')" class="btn waves-effect waves-light btn-info"><?= YES ?></button>
							<button type="button" class="btn waves-effect waves-light btn-dark" onclick="jQuery('#restore_Modal_final_grade').modal('hide');"><?= NO ?></button>
						</div>
					</div>
				</div>
			</div>
			<!--# DIAM-785 -->
			<div class="modal" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel1">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h4 class="modal-title" id="exampleModalLabel1"><?=DELETE_CONFIRMATION?></h4>
							<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						</div>
						<div class="modal-body">
							<div class="form-group" id="delete_message" ></div>
							<input type="hidden" id="DELETE_ID" value="0" />
							<input type="hidden" id="DELETE_TYPE" value="0" />
						</div>
						<div class="modal-footer">
							<button type="button" onclick="conf_delete(1)" class="btn waves-effect waves-light btn-info"><?=YES?></button>
							<button type="button" class="btn waves-effect waves-light btn-dark" onclick="conf_delete(0)" ><?=NO?></button>
						</div>
					</div>
				</div>
			</div>
			<div class="modal" id="deleteModal_grade" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel1">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h4 class="modal-title" id="exampleModalLabel1"><?= DELETE_CONFIRMATION ?></h4>
							<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						</div>
						<div class="modal-body">
							<div class="form-group" id="deleteModal_grade_message"></div> 
						</div>
						<div class="modal-footer">
							<button type="button" onclick="confirm_delete_grade()" class="btn waves-effect waves-light btn-info"><?= YES ?></button>
							<button type="button" class="btn waves-effect waves-light btn-dark" onclick="grade_to_be_deleted = false;jQuery('#deleteModal_grade').modal('hide');"><?= NO ?></button>
						</div>
					</div>
				</div>
			</div>

			<div class="modal" id="deleteModal_grade_after_msg" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel1">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						 
						<div class="modal-body">
							<div class="form-group text-center mt-5 font-weight-bold" id="deleteModal_grade_after_msg_message"  data-backdrop="static" data-keyboard="false" style="color
							: green">
								Grade book setup saved successfully !
							</div> 
						</div>
						<div class="modal-footer"> 
							<button type="button" class="btn waves-effect waves-light btn-info" onclick="jQuery('#deleteModal_grade_after_msg').modal('hide');document.getElementsByClassName('preloader_grid')[0].style.display = 'block';validate_form(1);">Save</button>
						</div>
					</div>
				</div>
			</div>
			
			<div class="modal" id="addStudentModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel1">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h4 class="modal-title" id="exampleModalLabel1"><?=CONFIRMATION?></h4>
							<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						</div>
						<div class="modal-body">
							<div class="form-group" ><?=ADD_STUDENT_TO_COURSE_OFFERING_CONFIRMATION_MSG?></div>
							<input type="hidden" id="ADD_DELETE_ID" value="0" />
							<input type="hidden" id="ADD_DELETE_EID" value="0" />
						</div>
						<div class="modal-footer">
							<button type="button" onclick="confirm_add_student_to_course_offering(1)" class="btn waves-effect waves-light btn-info"><?=YES?></button>
							<button type="button" class="btn waves-effect waves-light btn-dark" onclick="confirm_add_student_to_course_offering(0)" ><?=NO?></button>
						</div>
					</div>
				</div>
			</div>
			
			<div class="modal" id="inActivePopup" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel1">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h4 class="modal-title" id="exampleModalLabel1"><?=CONFIRMATION?></h4>
						</div>
						<div class="modal-body">
							<div class="form-group" ><?=INACTIVE_CONFIRMATION_MSG?></div>
							<input type="hidden" id="inActivePopupID" value="0" />
						</div>
						<div class="modal-footer">
							<button type="button" onclick="confirm_show_inactive_message(1)" class="btn waves-effect waves-light btn-info"><?=YES?></button>
							<button type="button" class="btn waves-effect waves-light btn-dark" onclick="confirm_show_inactive_message(0)" ><?=NO?></button>
						</div>
					</div>
				</div>
			</div>
			
			<!-- Ticket # 1661 -->
			<div class="modal" id="inActiveRemovePopup" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel1">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h4 class="modal-title" id="exampleModalLabel1"><?=CONFIRMATION?></h4>
						</div>
						<div class="modal-body">
							<div class="form-group" id="INACTIVE_REMOVE_CONFIRMATION_MSG_DIV" ></div>
							<input type="hidden" id="inActiveRemovePopupID" value="0" />
						</div>
						<div class="modal-footer">
							<button type="button" onclick="confirm_show_remove_inactive_message_popup(1)" class="btn waves-effect waves-light btn-info"><?=YES?></button>
							<button type="button" class="btn waves-effect waves-light btn-dark" onclick="confirm_show_remove_inactive_message_popup(0)" ><?=NO?></button>
						</div>
					</div>
				</div>
			</div>
			<!-- Ticket # 1661 -->
			
			<div class="modal" id="importScheduleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel1">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h4 class="modal-title" id="exampleModalLabel1"><?=IMPORT_SCHEDULE?></h4>
							<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						</div>
						<div class="modal-body">
							<div class="form-group" >
								<select id="IMPORT_PK_SESSION" name="IMPORT_PK_SESSION" class="form-control required-entry"  >
									<option value="" >Select Session</option>
									<? $res_type = $db->Execute("select M_SESSION.PK_SESSION, M_SESSION.SESSION from M_SESSION, S_COURSE_DEFAULT_SCHEDULE WHERE M_SESSION.ACTIVE = 1 AND M_SESSION.PK_ACCOUNT = '$_SESSION[PK_ACCOUNT]' AND S_COURSE_DEFAULT_SCHEDULE.PK_SESSION =  M_SESSION.PK_SESSION AND PK_COURSE = '$PK_COURSE' order by DISPLAY_ORDER ASC");
									while (!$res_type->EOF) { ?>
										<option value="<?=$res_type->fields['PK_SESSION'] ?>" ><?=$res_type->fields['SESSION']?></option>
									<?	$res_type->MoveNext();
									} ?>
								</select>
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" onclick="conf_import_schedule(1)" class="btn waves-effect waves-light btn-info"><?=IMPORT?></button>
							<button type="button" class="btn waves-effect waves-light btn-dark" onclick="conf_import_schedule(0)" ><?=CANCEL?></button>
						</div>
					</div>
				</div>
			</div>
			
			<div class="modal" id="changeTermPopup" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel1">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h4 class="modal-title" id="exampleModalLabel1"><?=CONFIRMATION?></h4>
							<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						</div>
						<div class="modal-body">
							<div class="form-group" ><?=CHANGE_TERM?></div>
						</div>
						<div class="modal-footer">
							<button type="button" onclick="confirm_change_student(1)" class="btn waves-effect waves-light btn-info"><?=YES?></button>
							<button type="button" class="btn waves-effect waves-light btn-dark" onclick="confirm_change_student(0)" ><?=NO?></button>
						</div>
					</div>
				</div>
			</div>
			
			<!-- Ticket # 1661 -->
			<div class="modal" id="warningPopup" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel1">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h4 class="modal-title" id="exampleModalLabel1"><?=WARNING?></h4>
							<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						</div>
						<div class="modal-body">
							<div class="form-group" id="warning_div" ></div>
						</div>
						<div class="modal-footer">
							<button type="button" onclick="close_popup()" class="btn waves-effect waves-light btn-info"><?=CANCEL?></button>
						</div>
					</div>
				</div>
			</div>
			<!-- Ticket # 1661 -->
			
        </div>
        <? require_once("footer.php"); ?>
		
    </div>
   
	<? require_once("js.php"); ?>
	<script src="../backend_assets/dist/js/jquery.are-you-sure.js"></script>
	
	<script src="../backend_assets/node_modules/bootstrap-datepicker/bootstrap-datepicker.min.js"></script>
	<link href="../backend_assets/node_modules/bootstrap-datepicker/bootstrap-datepicker.min.css" rel="stylesheet" type="text/css" />
	
	<script type="text/javascript">
	<? if($_GET['tab'] != '') { ?>
		var current_tab = '<?=$_GET['tab']?>';
	<? } else { ?>
		var current_tab = 'settingsTab';
	<? } ?>
	jQuery(document).ready(function($) { 
		jQuery('.date').datepicker({
			todayHighlight: true,
			orientation: "bottom auto"
		});
		
		jQuery('.date1').datepicker({
			todayHighlight: true,
			orientation: "bottom auto",
			autoclose: true,
		});
		
		$('.date1').datepicker().on('hide', function(e) {
			if(document.getElementById('START_DATE').value != '') {
				var minDate = $("#START_DATE").val();
				$('#END_DATE').datepicker('setStartDate', minDate);
					
				document.getElementById('END_DATE').focus();
				$("#START_DATE").parent().addClass("focused")
			} else
				$("#START_DATE").parent().removeClass("focused")
		});
		
		jQuery('.date2').datepicker({
			todayHighlight: true,
			orientation: "bottom auto"
		});
		
		<? if($START_DATE != ''){ ?>
			var minDate = $("#START_DATE").val();
			$('#END_DATE').datepicker('setStartDate', minDate);
		<? } ?>
		
		$('.timepicker').inputmask(
			"hh:mm t", {
				placeholder: "HH:MM AM/PM", 
				insertMode: false, 
				showMaskOnHover: false,
				hourFormat: 12
			}
		);
		
		$('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
			current_tab = $(e.target).attr("href") // activated tab
			//alert(current_tab)
		});
		
		$('#form1').areYouSure();
		
		show_title()
		
		$('#grade_input_table1').on('post-body.bs.table', function (e) {
			jQuery('.date').datepicker({
				todayHighlight: true,
				orientation: "bottom auto"
			});
		});

		//DIAM-785/902 

		$('.customtab li a').click(function(event){ //click event
			$('#form1').on('keyup change paste', 'input, select, textarea', function(){
				$('#current_tab_form_edited').val("1");	
			});
			if($("#finalGradeTab").hasClass('active') && $('#current_tab_form_edited').val()==1){						
				if(confirm("Please click on Save button to proceed further or all your progress will be lost.")==true){	
					$('#current_tab_form_edited').val("0");			
					return  true;	
				}else{
					return  false;				
				}
			}
		});		
			
		//DIAM-785
	});

	jQuery(document).ready(function() {
		jQuery(".main-table").clone(true).appendTo('#table-scroll').addClass('clone delete_grade_input_table').prop('id', 'delete_grade_input_table');  
	});
	</script>
	
	<script type="text/javascript" src="https://code.jquery.com/jquery-migrate-1.4.1.min.js"></script>
	<script src="../backend_assets/dist/js/validation_prototype.js"></script>
	<script src="../backend_assets/dist/js/validation.js"></script>
	<script type="text/javascript">
	//27 june	
	function RestoreGradeBook(val, TABVAL) {

	if (TABVAL == 'GB_SETUP') {

		if (document.getElementById("RESTORE_GRADE_BOOK_SETUP").value == '') {
			document.getElementById("RESTORE_GRADE_BOOK_SETUP_ERR").style.display = 'block';
		} else {

			loader('grad_list');
			var last_date = document.getElementById("RESTORE_GRADE_BOOK_SETUP").value;
			jQuery(document).ready(function($) {
				var data = 'id=' + val + '&last_date=' + last_date;
				var value = $.ajax({
					url: "ajax_course_offering_grade_history",
					type: "POST",
					data: data,
					async: false,
					cache: false,
					success: function(data) {
						document.getElementById('grad_list').innerHTML = data;
						calc_wp();
						jQuery('#restore_Modal_grade_book_setup').modal('hide');								
					}
				}).responseText;
			});

		}

	} else if (TABVAL == 'GB_ENTRY') {

		if (document.getElementById("RESTORE_GRADE_BOOK_ENTRY").value == '') {
			document.getElementById("RESTORE_GRADE_BOOK_ENTRY_ERR").style.display = 'block';
		} else {

			loader('gradeBookEntryData');
			var last_date = document.getElementById("RESTORE_GRADE_BOOK_ENTRY").value;
			jQuery(document).ready(function($) {
				var data = 'id=' + val + '&last_date=' + last_date;
				var value = $.ajax({
					url: "ajax_get_grade_book_entry_history",
					type: "POST",
					data: data,
					async: false,
					cache: false,
					success: function(data) {
						document.getElementById('gradeBookEntryData').innerHTML = data;
						get_grad_tab(val);
						jQuery('#restore_Modal_grade_book_entry').modal('hide');								

					}
				}).responseText;
			});
		}
	} else if (TABVAL == 'FG_SETUP') { //DIAM-785

			if (document.getElementById("RESTORE_FINAL_GRADE").value == '') {
				document.getElementById("RESTORE_FINAL_GRADE_ERR").style.display = 'block';
			} else {

				loader('finalGradBook');
				var last_date = document.getElementById("RESTORE_FINAL_GRADE").value;
				jQuery(document).ready(function($) {
					var data = 'id=' + val + '&last_date=' + last_date;
					var value = $.ajax({
						url: "ajax_get_course_offering_final_grade_history",
						type: "POST",
						data: data,
						async: false,
						cache: false,
						success: function(data) {
							document.getElementById('finalGradBook').innerHTML = data;
							get_grad_tab(val);
							jQuery('#restore_Modal_final_grade').modal('hide');								

						}
					}).responseText;
				});
			}
		} //DIAM-785
	}

	//Ticket # DIAM-741
	function confirm_restore_grade_book_setup(){
	jQuery(document).ready(function($) {
		$("#restore_Modal_grade_book_setup").modal();
	});
	}
	function confirm_restore_grade_book_entry(){
	jQuery(document).ready(function($) {
		$("#restore_Modal_grade_book_entry").modal();
	});
	}
	//27 june	
	// DIAM-785
	function confirm_restore_final_grade(){
	jQuery(document).ready(function($) {
		$("#restore_Modal_final_grade").modal();
	});
	}
	// DIAM-785
	var calculate_grade=true;
	Validation.add('validate-session-number', 'Session No Should Be Unique', function (v) {
		if(v == 'duplicate_found'){
			return false;
		}else {
			return true;
		}
	});
	function check_unique_session(){
		jQuery(document).ready(function($) {
			if(document.getElementById('SESSION_NO').value == ''){
				return false;
			}
			else if(document.getElementById('PK_COURSE').value != '' && document.getElementById('PK_TERM_MASTER').value != '' && document.getElementById('PK_CAMPUS').value != '' && document.getElementById('PK_SESSION').value != '') {
				var data = 'PK_COURSE='+document.getElementById('PK_COURSE').value+'&PK_TERM_MASTER='+document.getElementById('PK_TERM_MASTER').value+'&PK_CAMPUS='+document.getElementById('PK_CAMPUS').value+'&PK_SESSION='+document.getElementById('PK_SESSION').value+"&SESSION_NO="+document.getElementById('SESSION_NO').value<?php if($_GET['id'] != ''){ echo "+ '&PK_COURSE_OFFERING=".$_GET['id']."'"; }?>;
				var value = $.ajax({
					url: "ajax_generate_course_offering_session_no_check",	
					type: "POST",
					data: data,		
					async: false,
					cache :false,
					success: function (data) {
						alert(data);
						if(data == 'duplicate_found'){
							document.getElementById('SESSION_NO_DIV').classList.add("focused");
							return false;
						}else{
							return true;
						}
						return false;
						 
						
					}		
				}).responseText;
			}
		});
	}
	function validate_form(val){
		jQuery(document).ready(function($) { 

			/* Ticket # 1900  */
			var grad_validation_css = '';
			if(val == 4 || val == 5)
				grad_validation_css = 'form-control';
			else
				grad_validation_css = 'form-control';
				
			var GRADE_INPUT_GRADE = document.getElementsByName('GRADE_INPUT_GRADE[]')
			for(var i = 0 ; i < GRADE_INPUT_GRADE.length ; i++){
				GRADE_INPUT_GRADE[i].className = grad_validation_css
			}
			/* Ticket # 1900  */

			if(val == 2 || val == 3){
			calculate_grade=false;
			var GRADE_check= document.getElementsByClassName('grade_check');
			for(var i = 0 ; i < GRADE_check.length ; i++){
				console.log(GRADE_check[i].value);
				if(GRADE_check[i].value!=="")
				{
					calculate_grade=false;
					pk_course_id=GRADE_check[i].getAttribute('data-id');
					grand_current_todal_grade=document.getElementById('GRADE_INPUT_FINAL_MAX_TOTAL_'+pk_course_id).value;
					if(grand_current_todal_grade!="0.00"){
						calculate_grade=true;				
					}else{
						calculate_grade=false;
					}
				
				}
			}
		}
			
			document.getElementById('current_tab').value    = current_tab;
			document.getElementById("SAVE_CONTINUE").value  = val;
			
			var valid = new Validation('form1', {onSubmit:false});
			var result = valid.validate();
			if(result == true) {



				if(document.getElementById('SESSION_NO').value == ''){
				return false;
			}
			else if(document.getElementById('PK_COURSE').value != '' && document.getElementById('PK_TERM_MASTER').value != '' && document.getElementById('PK_CAMPUS').value != '' && document.getElementById('PK_SESSION').value != '') {
				var data = 'PK_COURSE='+document.getElementById('PK_COURSE').value+'&PK_TERM_MASTER='+document.getElementById('PK_TERM_MASTER').value+'&PK_CAMPUS='+document.getElementById('PK_CAMPUS').value+'&PK_SESSION='+document.getElementById('PK_SESSION').value+"&SESSION_NO="+document.getElementById('SESSION_NO').value<?php if($_GET['id'] != ''){ echo "+ '&PK_COURSE_OFFERING=".$_GET['id']."'"; }?>;
				var value = $.ajax({
					url: "ajax_generate_course_offering_session_no_check",	
					type: "POST",
					data: data,		
					async: false,
					cache :false,
					success: function (data) {
						if(data == 'duplicate_found'){
							document.getElementById('SESSION_NO_DIV').classList.add("focused");
							toggleSessionNoValidationAdvice(true);
							alert("Please Check All Tabs For Error");
							return false;
						}else{
							
							$( "#delete_grade_input_table" ).remove();
							$("#form1").removeClass('dirty');
							if(val!='2' && val!='3'){
								document.form1.submit();
							}
							if(calculate_grade==true){
								console.log("submit called");
								document.form1.submit();
							}else{
								setTimeout(() => {
									document.form1.submit();
								}, 300);					
							}
							return true;
						}
						// toggleSessionNoValidationAdvice(true);
						alert("Please Check All Tabs For Error");
						return false;
						
					}		
				}).responseText;
			}
			} else {
				alert("Please Check All Tabs For Error");
			}
		});
	}
	function toggleSessionNoValidationAdvice(manualToggle) {
    var sessionId = 'SESSION_NO';
    var adviceId = 'advice-validate-session-number-' + sessionId;

    // Check if the advice div already exists
    var adviceDiv = document.getElementById(adviceId);
    var sessionInput = document.getElementById(sessionId);

    if (manualToggle === true) {
        // Add the advice div if it doesn't exist
        if (!adviceDiv) {
            var div = document.createElement('div');
            div.id = adviceId;
            div.className = 'validation-advice';
            div.textContent = 'Session No Should Be Unique';
            div.style.cssText = ''; // Add your styles here if needed

            // Insert the advice div after the SESSION_NO input
            sessionInput.parentNode.insertBefore(div, sessionInput.nextSibling);
        }
    } else if (manualToggle === false) {
        // Remove the advice div if it exists
        if (adviceDiv) {
            adviceDiv.parentNode.removeChild(adviceDiv);
        }
    } else {
        // Toggle behavior: Remove if exists, add if doesn't exist
        if (adviceDiv) {
            adviceDiv.parentNode.removeChild(adviceDiv);
        } else {
            var div = document.createElement('div');
            div.id = adviceId;
            div.className = 'validation-advice';
            div.textContent = 'Session No Should Be Unique';
            div.style.cssText = ''; // Add your styles here if needed

            // Insert the advice div after the SESSION_NO input
            sessionInput.parentNode.insertBefore(div, sessionInput.nextSibling);
        }
    }
}
	function get_teacher(val,id){
		jQuery(document).ready(function($) { 
			var data  = 'campus='+val+'&id='+id;
			var value = $.ajax({
				url: "ajax_get_teacher_from_campus",	
				type: "POST",		 
				data: data,		
				async: false,
				cache: false,
				success: function (data) {	
					//alert(data)
					document.getElementById(id+'_DIV').innerHTML = data;
					document.getElementById(id+'_DIV_1').classList.add("focused");
					
					if(id == "ASSISTANT") {
						$('#ASSISTANT').multiselect({
							includeSelectAllOption: true,
							allSelectedText: 'All <?=ASSISTANT?>',
							nonSelectedText: '<?=ASSISTANT?>',
							numberDisplayed: 2,
							nSelectedText: '<?=ASSISTANT?> selected'
						});
					}
				}		
			}).responseText;
		});
	}
	function set_assistance(){
		jQuery(document).ready(function($) { 
			var id 	  = 'ASSISTANT'
			var data  = 'campus='+document.getElementById('PK_CAMPUS').value+'&id='+id+'&DONT_INCLUDE='+document.getElementById('INSTRUCTOR').value;
			var value = $.ajax({
				url: "ajax_get_teacher_from_campus",	
				type: "POST",		 
				data: data,		
				async: false,
				cache: false,
				success: function (data) {	
					//alert(data)
					document.getElementById(id+'_DIV').innerHTML = data;
					document.getElementById(id+'_DIV_1').classList.add("focused");
					
					$('#ASSISTANT').multiselect({
						includeSelectAllOption: true,
						allSelectedText: 'All <?=ASSISTANT?>',
						nonSelectedText: '<?=ASSISTANT?>',
						numberDisplayed: 2,
						nSelectedText: '<?=ASSISTANT?> selected'
					});
				}		
			}).responseText;
		});
	}
	
	function get_room(val){
		jQuery(document).ready(function($) { 
			var data  = 'campus='+val+'&onchange=1';
			var value = $.ajax({
				url: "ajax_get_campus_room",	
				type: "POST",		 
				data: data,		
				async: false,
				cache: false,
				success: function (data) {	
					//alert(data)
					document.getElementById('PK_ROOM_DIV').innerHTML = data;
					document.getElementById('PK_ROOM_DIV_1').classList.add("focused");
				}		
			}).responseText;
		});
	}
	
	/* Ticket # 1325 */
	function get_room_max_size(val){
		jQuery(document).ready(function($) { 
			var data  = 'room='+val;
			var value = $.ajax({
				url: "ajax_get_room_size",	
				type: "POST",		 
				data: data,		
				async: false,
				cache: false,
				success: function (data) {	
					//alert(data)
					document.getElementById('ROOM_SIZE').value = data;
					
					$('.floating-labels .form-control').on('focus blur', function (e) {
						$(this).parents('.form-group').toggleClass('focused', (e.type === 'focus' || this.value.length > 0));
					}).trigger('blur');
				}		
			}).responseText;
		});
	}
	/* Ticket # 1325 */
	
	function get_course_hour(val){
		jQuery(document).ready(function($) { 
			var data  = 'id='+val;
			var value = $.ajax({
				url: "ajax_get_course_hour",	
				type: "POST",		 
				data: data,		
				async: false,
				cache: false,
				success: function (data) {	
					//alert(data)
					data = data.split('|||');
					document.getElementById('PK_ATTENDANCE_CODE').value	 = data[1];
					document.getElementById('PK_ATTENDANCE_CODE_DIV').classList.add("focused");
					
					document.getElementById('PK_ATTENDANCE_TYPE').value	 = data[2];
					document.getElementById('PK_ATTENDANCE_TYPE_DIV').classList.add("focused");
					
					document.getElementById('CLASS_SIZE').value	 = data[3];
					document.getElementById('CLASS_SIZE_DIV').classList.add("focused");
			
					if(document.getElementById('COURSE_HOUR')) //Ticket # 1372
						document.getElementById('COURSE_HOUR').value = data[0];
						
					if(document.getElementById('COURSE_HOUR_DIV')) //Ticket # 1372
						document.getElementById('COURSE_HOUR_DIV').innerHTML = data[0];
					
					/* Ticket # 1372 */
					if(document.getElementById('LMS_COURSE_TEMPLATE_ID')) {
						document.getElementById('LMS_COURSE_TEMPLATE_ID').value = data[4];
						$('.floating-labels .form-control').on('focus blur', function (e) {
							$(this).parents('.form-group').toggleClass('focused', (e.type === 'focus' || this.value.length > 0));
						}).trigger('blur');
					}
					/* Ticket # 1372 */
				}		
			}).responseText;
		});
	}
	
	function delete_row(id,type){
		jQuery(document).ready(function($) {
			if(type == 'schedule')
				document.getElementById('delete_message').innerHTML = '<?=DELETE_MESSAGE.SCHEDULE?>?';
			else if(type == 'schedule_det')
				document.getElementById('delete_message').innerHTML = '<?=DELETE_MESSAGE.SCHEDULED_CLASS_DATE?>?';
			else if(type == 'student') //Ticket # 1556
				document.getElementById('delete_message').innerHTML = '<?=DELETE_MESSAGE_STUDENT?>';
			else if(type == 'grade')
				document.getElementById('delete_message').innerHTML = '<?=DELETE_MESSAGE.TAB_GRADE?>?';
			else if(type == 'bulk_schedule') {
				document.getElementById('delete_message').innerHTML = '<?=DELETE_MESSAGE.SCHEDULE?>?';	
				
				/*id = '';
				var MUL_SEL = document.getElementsByName('MUL_SEL[]')
				for(var i = 0 ; i < MUL_SEL.length ; i++){
					if(MUL_SEL[i].checked == true) {
						if(id != '')
							id += ',';
							
						id += MUL_SEL[i].value
					}
				}*/
				//alert(id)
			} else if(type == 'waitingList') {
				document.getElementById('delete_message').innerHTML = '<?=DELETE_STUDENT_FROM_WAITING_LIST?>?';	
			} else if(type == 'non_schedule') {
				document.getElementById('delete_message').innerHTML = '<?=DELETE_MESSAGE.TAB_NON_SCHEDULED_ATTENDANCE ?>?';
			}
			
			$("#deleteModal").modal()
			$("#DELETE_ID").val(id)
			$("#DELETE_TYPE").val(type)
		});
	}
	var grade_to_be_deleted = false;

		function ajax_del_grade_modal(id) {
			jQuery(document).ready(function($) {
				grade_to_be_deleted = id; 
				document.getElementById('deleteModal_grade_message').innerHTML = '<?= DELETE_MESSAGE . TAB_GRADE ?>? <br> <span style="color : red"> <?= DELETE_MESSAGE_GRADE ?> </span>';
				$("#deleteModal_grade").modal() 

			})
		}

		function confirm_delete_grade() {
			jQuery(document).ready(function($) { 
				var data = 'PK_COURSE_OFFERING_GRADE=' + grade_to_be_deleted;
				var value = $.ajax({
					url: "course_offering_del",
					type: "POST",
					data: data,
					async: false,
					cache: false,
					success: function(data) {
						console.log('data from grade delete func', data);
						jQuery('#deleteModal_grade').modal('hide'); 
						jQuery('#deleteModal_grade_after_msg').modal({
    backdrop: 'static',
    keyboard: false
}); 
						jQuery('input[value="'+grade_to_be_deleted+'"][name="PK_COURSE_OFFERING_GRADE[]"]').parent().parent().remove();
						calc_wp()
						
					}
				}).responseText;
			})
		}
	function conf_delete(val,id){
		jQuery(document).ready(function($) {
			if(val == 1) {
				if($("#DELETE_TYPE").val() == 'schedule')
					window.location.href = 'course_offering?act=del_sch&id=<?=$_GET['id']?>&iid='+$("#DELETE_ID").val();
				else if($("#DELETE_TYPE").val() == 'schedule_det') {
					var id = $("#DELETE_ID").val()
					$("#SCHEDULE_DIV_"+id).remove()
					calc_total_scheduled_hours(0)
				} else if($("#DELETE_TYPE").val() == 'student') {
					window.location.href = 'course_offering?act=del_stu&id=<?=$_GET['id']?>&iid='+$("#DELETE_ID").val();
				} else if($("#DELETE_TYPE").val() == 'grade') {
					var id = $("#DELETE_ID").val()
					$("#grade_table_"+id).remove()
					calc_wp()
				} else if($("#DELETE_TYPE").val() == 'bulk_schedule') {
					/*var id = $("#DELETE_ID").val()
					var id1 = id.split(',');
					for(var i = 0 ; i < id1.length ; i++){
						$("#SCHEDULE_DIV_"+id1[i]).remove()
					}*/
					
					var id1 = '';
					var SCHEDULE_HID = document.getElementsByName('SCHEDULE_HID[]')
					for(var i = 0 ; i < SCHEDULE_HID.length ; i++){
						var hid = SCHEDULE_HID[i].value
						if(document.getElementById('COMPLETED_'+hid).checked == false) {
							if(id1 != '')
								id1 += ',';
								
							id1 += hid
						}
					}
					
					var id2 = id1.split(',');
					for(var i = 0 ; i < id2.length ; i++){
						$("#SCHEDULE_DIV_"+id2[i]).remove()
					}
					
					calc_total_scheduled_hours(0)
				} else if($("#DELETE_TYPE").val() == 'waitingList') {
					jQuery(document).ready(function($) { 
						var id = $("#DELETE_ID").val()
						var data  = 'PK_COURSE_OFFERING_WAITING_LIST='+id;
						var value = $.ajax({
							url: "ajax_delete_student_course_offering_waiting_list",	
							type: "POST",		 
							data: data,		
							async: false,
							cache: false,
							success: function (data) {	
								//alert(data)
								$("#WAITINGLIST_"+id).remove()
							}		
						}).responseText;
					});
				} else if($("#DELETE_TYPE").val() == 'non_schedule') {
					var data  = 'id='+$("#DELETE_ID").val();
					var value = $.ajax({
						url: "ajax_delete_non_schedule_attendance",	
						type: "POST",		 
						data: data,		
						async: false,
						cache: false,
						success: function (data) {	
							$("#non_schedule_"+$("#DELETE_ID").val()).remove()
						}		
					}).responseText;
				}
				
			}
			$("#deleteModal").modal("hide");
		});
	}
	
	function apply_default(){
		var DEF_START_TIME = document.getElementById('DEF_START_TIME').value
		var DEF_END_TIME   = document.getElementById('DEF_END_TIME').value
		var DEF_HOURS      = document.getElementById('DEF_HOURS').value
		var PK_CAMPUS_ROOM = document.getElementById('PK_CAMPUS_ROOM').value
		
		var PK_ATTENDANCE_ACTIVITY_TYPE = ''
		if(document.getElementById('PK_ATTENDANCE_ACTIVITY_TYPE'))
			PK_ATTENDANCE_ACTIVITY_TYPE = document.getElementById('PK_ATTENDANCE_ACTIVITY_TYPE').value
			
		var all = 0;
		
		if(document.getElementById('SUN').checked == false && document.getElementById('MON').checked == false && document.getElementById('TUE').checked == false && document.getElementById('WED').checked == false && document.getElementById('THU').checked == false && document.getElementById('FRI').checked == false && document.getElementById('SAT').checked == false )
			all = 1

		if((DEF_START_TIME != '' || DEF_END_TIME != '') && all == 1){
			document.getElementById('SUN').checked 	= true;
			document.getElementById('MON').checked 	= true;
			document.getElementById('TUE').checked 	= true;
			document.getElementById('WED').checked 	= true;
			document.getElementById('THU').checked 	= true;
			document.getElementById('FRI').checked 	= true;
			document.getElementById('SAT').checked 	= true;
			
			document.getElementById('SUN_ROOM').disabled = false;
			document.getElementById('MON_ROOM').disabled = false;
			document.getElementById('TUE_ROOM').disabled = false;
			document.getElementById('WED_ROOM').disabled = false;
			document.getElementById('THU_ROOM').disabled = false;
			document.getElementById('FRI_ROOM').disabled = false;
			document.getElementById('SAT_ROOM').disabled = false;
			
			if(document.getElementById('PK_ATTENDANCE_ACTIVITY_TYPE')) {
				document.getElementById('SUN_PK_ATTENDANCE_ACTIVITY_TYPE').disabled = false;
				document.getElementById('MON_PK_ATTENDANCE_ACTIVITY_TYPE').disabled = false;
				document.getElementById('TUE_PK_ATTENDANCE_ACTIVITY_TYPE').disabled = false;
				document.getElementById('WED_PK_ATTENDANCE_ACTIVITY_TYPE').disabled = false;
				document.getElementById('THU_PK_ATTENDANCE_ACTIVITY_TYPE').disabled = false;
				document.getElementById('FRI_PK_ATTENDANCE_ACTIVITY_TYPE').disabled = false;
				document.getElementById('SAT_PK_ATTENDANCE_ACTIVITY_TYPE').disabled = false;
			}
		}
		
		if(document.getElementById('SUN').checked == true) {
			document.getElementById('SUN_ROOM').value = PK_CAMPUS_ROOM
			
			if(document.getElementById('SUN_PK_ATTENDANCE_ACTIVITY_TYPE'))
				document.getElementById('SUN_PK_ATTENDANCE_ACTIVITY_TYPE').value = PK_ATTENDANCE_ACTIVITY_TYPE
		}
		
		if(document.getElementById('MON').checked == true) {
			document.getElementById('MON_ROOM').value = PK_CAMPUS_ROOM
			
			if(document.getElementById('MON_PK_ATTENDANCE_ACTIVITY_TYPE'))
				document.getElementById('MON_PK_ATTENDANCE_ACTIVITY_TYPE').value = PK_ATTENDANCE_ACTIVITY_TYPE
		}
		
		if(document.getElementById('TUE').checked == true) {
			document.getElementById('TUE_ROOM').value = PK_CAMPUS_ROOM
			
			if(document.getElementById('TUE_PK_ATTENDANCE_ACTIVITY_TYPE'))
				document.getElementById('TUE_PK_ATTENDANCE_ACTIVITY_TYPE').value = PK_ATTENDANCE_ACTIVITY_TYPE
		}
		
		if(document.getElementById('WED').checked == true) {
			document.getElementById('WED_ROOM').value = PK_CAMPUS_ROOM
			
			if(document.getElementById('WED_PK_ATTENDANCE_ACTIVITY_TYPE'))
				document.getElementById('WED_PK_ATTENDANCE_ACTIVITY_TYPE').value = PK_ATTENDANCE_ACTIVITY_TYPE
		}
		
		if(document.getElementById('THU').checked == true) {
			document.getElementById('THU_ROOM').value = PK_CAMPUS_ROOM
			
			if(document.getElementById('THU_PK_ATTENDANCE_ACTIVITY_TYPE'))
				document.getElementById('THU_PK_ATTENDANCE_ACTIVITY_TYPE').value = PK_ATTENDANCE_ACTIVITY_TYPE
		}
		
		if(document.getElementById('FRI').checked == true) {
			document.getElementById('FRI_ROOM').value = PK_CAMPUS_ROOM
			
			if(document.getElementById('FRI_PK_ATTENDANCE_ACTIVITY_TYPE'))
				document.getElementById('FRI_PK_ATTENDANCE_ACTIVITY_TYPE').value = PK_ATTENDANCE_ACTIVITY_TYPE
		}
		
		if(document.getElementById('SAT').checked == true) {
			document.getElementById('SAT_ROOM').value = PK_CAMPUS_ROOM
			
			if(document.getElementById('SAT_PK_ATTENDANCE_ACTIVITY_TYPE'))
				document.getElementById('SAT_PK_ATTENDANCE_ACTIVITY_TYPE').value = PK_ATTENDANCE_ACTIVITY_TYPE
		}
		
		if(DEF_START_TIME != ''){
			if(all == 1) {
				document.getElementById('SUN_START_TIME').disabled = false;
				document.getElementById('MON_START_TIME').disabled = false;
				document.getElementById('TUE_START_TIME').disabled = false;
				document.getElementById('WED_START_TIME').disabled = false;
				document.getElementById('THU_START_TIME').disabled = false;
				document.getElementById('FRI_START_TIME').disabled = false;
				document.getElementById('SAT_START_TIME').disabled = false;
			}
		
			if(document.getElementById('SUN_START_TIME').disabled == false)
				document.getElementById('SUN_START_TIME').value = DEF_START_TIME;
			
			if(document.getElementById('MON_START_TIME').disabled == false)
				document.getElementById('MON_START_TIME').value = DEF_START_TIME;
			
			if(document.getElementById('TUE_START_TIME').disabled == false)
				document.getElementById('TUE_START_TIME').value = DEF_START_TIME;
				
			if(document.getElementById('WED_START_TIME').disabled == false)
				document.getElementById('WED_START_TIME').value = DEF_START_TIME;
			
			if(document.getElementById('THU_START_TIME').disabled == false)
				document.getElementById('THU_START_TIME').value = DEF_START_TIME;
			
			if(document.getElementById('FRI_START_TIME').disabled == false)
				document.getElementById('FRI_START_TIME').value = DEF_START_TIME;
			
			if(document.getElementById('SAT_START_TIME').disabled == false)
				document.getElementById('SAT_START_TIME').value = DEF_START_TIME;
		}
		
		if(DEF_END_TIME != ''){
			if(all == 1) {
				document.getElementById('SUN_END_TIME').disabled = false;
				document.getElementById('MON_END_TIME').disabled = false;
				document.getElementById('TUE_END_TIME').disabled = false;
				document.getElementById('WED_END_TIME').disabled = false;
				document.getElementById('THU_END_TIME').disabled = false;
				document.getElementById('FRI_END_TIME').disabled = false;
				document.getElementById('SAT_END_TIME').disabled = false;
			}
			
			if(document.getElementById('SUN_END_TIME').disabled == false)
				document.getElementById('SUN_END_TIME').value = DEF_END_TIME;
				
			if(document.getElementById('MON_END_TIME').disabled == false)
				document.getElementById('MON_END_TIME').value = DEF_END_TIME;
			
			if(document.getElementById('TUE_END_TIME').disabled == false)
				document.getElementById('TUE_END_TIME').value = DEF_END_TIME;
				
			if(document.getElementById('WED_END_TIME').disabled == false)
				document.getElementById('WED_END_TIME').value = DEF_END_TIME;
				
			if(document.getElementById('THU_END_TIME').disabled == false)
				document.getElementById('THU_END_TIME').value = DEF_END_TIME;
					
			if(document.getElementById('FRI_END_TIME').disabled == false)
				document.getElementById('FRI_END_TIME').value = DEF_END_TIME;
				
			if(document.getElementById('SAT_END_TIME').disabled == false)
				document.getElementById('SAT_END_TIME').value = DEF_END_TIME;
		}
		
		if(DEF_HOURS != ''){
			if(all == 1) {
				document.getElementById('SUN_HOURS').disabled = false;
				document.getElementById('MON_HOURS').disabled = false;
				document.getElementById('TUE_HOURS').disabled = false;
				document.getElementById('WED_HOURS').disabled = false;
				document.getElementById('THU_HOURS').disabled = false;
				document.getElementById('FRI_HOURS').disabled = false;
				document.getElementById('SAT_HOURS').disabled = false;
			}
			
			if(document.getElementById('SUN_HOURS').disabled == false)
				document.getElementById('SUN_HOURS').value = DEF_HOURS;
				
			if(document.getElementById('MON_HOURS').disabled == false)
				document.getElementById('MON_HOURS').value = DEF_HOURS;
				
			if(document.getElementById('TUE_HOURS').disabled == false)
				document.getElementById('TUE_HOURS').value = DEF_HOURS;
				
			if(document.getElementById('WED_HOURS').disabled == false)
				document.getElementById('WED_HOURS').value = DEF_HOURS;
				
			if(document.getElementById('THU_HOURS').disabled == false)
				document.getElementById('THU_HOURS').value = DEF_HOURS;
				
			if(document.getElementById('FRI_HOURS').disabled == false)
				document.getElementById('FRI_HOURS').value = DEF_HOURS;
				
			if(document.getElementById('SAT_HOURS').disabled == false)
				document.getElementById('SAT_HOURS').value = DEF_HOURS;
			
		}
	}
	
	function reset_blank(){
		document.getElementById('SUN_START_TIME').value = '';
		document.getElementById('MON_START_TIME').value = '';
		document.getElementById('TUE_START_TIME').value = '';
		document.getElementById('WED_START_TIME').value = '';
		document.getElementById('THU_START_TIME').value = '';
		document.getElementById('FRI_START_TIME').value = '';
		document.getElementById('SAT_START_TIME').value = '';
		
		document.getElementById('SUN_END_TIME').value = '';
		document.getElementById('MON_END_TIME').value = '';
		document.getElementById('TUE_END_TIME').value = '';
		document.getElementById('WED_END_TIME').value = '';
		document.getElementById('THU_END_TIME').value = '';
		document.getElementById('FRI_END_TIME').value = '';
		document.getElementById('SAT_END_TIME').value = '';
		
		document.getElementById('SUN_HOURS').value = '';
		document.getElementById('MON_HOURS').value = '';
		document.getElementById('TUE_HOURS').value = '';
		document.getElementById('WED_HOURS').value = '';
		document.getElementById('THU_HOURS').value = '';
		document.getElementById('FRI_HOURS').value = '';
		document.getElementById('SAT_HOURS').value = '';
		
		document.getElementById('SUN_ROOM').value = '';
		document.getElementById('MON_ROOM').value = '';
		document.getElementById('TUE_ROOM').value = '';
		document.getElementById('WED_ROOM').value = '';
		document.getElementById('THU_ROOM').value = '';
		document.getElementById('FRI_ROOM').value = '';
		document.getElementById('SAT_ROOM').value = '';
		
		if(document.getElementById('PK_ATTENDANCE_ACTIVITY_TYPE')) {
			document.getElementById('SUN_PK_ATTENDANCE_ACTIVITY_TYPE').value = '';
			document.getElementById('MON_PK_ATTENDANCE_ACTIVITY_TYPE').value = '';
			document.getElementById('TUE_PK_ATTENDANCE_ACTIVITY_TYPE').value = '';
			document.getElementById('WED_PK_ATTENDANCE_ACTIVITY_TYPE').value = '';
			document.getElementById('THU_PK_ATTENDANCE_ACTIVITY_TYPE').value = '';
			document.getElementById('FRI_PK_ATTENDANCE_ACTIVITY_TYPE').value = '';
			document.getElementById('SAT_PK_ATTENDANCE_ACTIVITY_TYPE').value = '';
		}
	}
	function get_hour(id){
		var START_TIME = document.getElementById(id+'_START_TIME').value
		var END_TIME   = document.getElementById(id+'_END_TIME').value
		var HOURS	   = '';
		if(START_TIME != '' && END_TIME != ''){
			jQuery(document).ready(function($) { 
				var data  = 'START_TIME='+START_TIME+'&END_TIME='+END_TIME;
				var value = $.ajax({
					url: "ajax_get_hour_from_time",	
					type: "POST",		 
					data: data,		
					async: false,
					cache: false,
					success: function (data) {	
						//alert(data)
						document.getElementById(id+'_HOURS').value = data;
						$("#"+id+"_HOURS").parent().addClass("focused");
						
						calc_total_scheduled_hours(1)
					}		
				}).responseText;
			});
		} else {
		}
		document.getElementById(id+'_HOURS').value = HOURS;
	}
	
	function enable_time(id){
		if(document.getElementById(id).checked == true){
			document.getElementById(id+'_START_TIME').disabled 	= false;
			document.getElementById(id+'_END_TIME').disabled 	= false
			
			document.getElementById(id+'_HOURS').disabled = false;
			document.getElementById(id+'_ROOM').disabled = false;
			
			if(document.getElementById('PK_ATTENDANCE_ACTIVITY_TYPE')) {
				document.getElementById(id+'_PK_ATTENDANCE_ACTIVITY_TYPE').disabled = false;
				document.getElementById(id+'_PK_ATTENDANCE_ACTIVITY_TYPE').value = document.getElementById('PK_ATTENDANCE_ACTIVITY_TYPE').value
			}
		} else {
			document.getElementById(id+'_START_TIME').disabled 	= true;
			document.getElementById(id+'_END_TIME').disabled 	= true
			document.getElementById(id+'_HOURS').value 			= '';
			document.getElementById(id+'_ROOM').value 			= '';
			
			document.getElementById(id+'_START_TIME').value = '';
			document.getElementById(id+'_END_TIME').value 	= '';
			
			document.getElementById(id+'_HOURS').disabled = true;
			document.getElementById(id+'_ROOM').disabled  = true;
			
			if(document.getElementById('PK_ATTENDANCE_ACTIVITY_TYPE')) {
				document.getElementById(id+'_PK_ATTENDANCE_ACTIVITY_TYPE').disabled = true;
				document.getElementById(id+'_PK_ATTENDANCE_ACTIVITY_TYPE').value 	= '';
			}
		}
	}
	
	function build_schedule(val){
		jQuery(document).ready(function($) { 
			var sun = 0;
			var mon = 0;
			var tue = 0;
			var wed = 0;
			var thu = 0;
			var fri = 0;
			var sat = 0;
			
			var sun_st = '';
			var sun_et = '';
			var sun_hr = '';
			var sun_r  = '';
			
			var mon_st = '';
			var mon_et = '';
			var mon_hr = '';
			var mon_r  = '';
			
			var tue_st = '';
			var tue_et = '';
			var tue_hr = '';
			var tue_r  = '';
			
			var wed_st = '';
			var wed_et = '';
			var wed_hr = '';
			var wed_r  = '';
			
			var thu_st = '';
			var thu_et = '';
			var thu_hr = '';
			var thu_r  = '';
			
			var fri_st = '';
			var fri_et = '';
			var fri_hr = '';
			var fri_r  = '';
			
			var sat_st = '';
			var sat_et = '';
			var sat_hr = '';
			var sat_r  = '';
			
			var sun_at  = '';
			var mon_at  = '';
			var tue_at  = '';
			var wed_at  = '';
			var thu_at  = '';
			var fri_at  = '';
			var sat_at  = '';
			
			if(document.getElementById('SUN').checked == true) {
				sun = 1;
				sun_st = $('#SUN_START_TIME').val();
				sun_et = $('#SUN_END_TIME').val();
				sun_hr = $('#SUN_HOURS').val();
				sun_r  = $('#SUN_ROOM').val();
				sun_at = $('#SUN_PK_ATTENDANCE_ACTIVITY_TYPE').val();
			}
			
			if(document.getElementById('MON').checked == true) {
				mon = 1;
				mon_st = $('#MON_START_TIME').val();
				mon_et = $('#MON_END_TIME').val();
				mon_hr = $('#MON_HOURS').val();
				mon_r  = $('#MON_ROOM').val();
				mon_at = $('#MON_PK_ATTENDANCE_ACTIVITY_TYPE').val();
			}
			
			if(document.getElementById('TUE').checked == true) {
				tue = 1;
				tue_st = $('#TUE_START_TIME').val();
				tue_et = $('#TUE_END_TIME').val();
				tue_hr = $('#TUE_HOURS').val();
				tue_r  = $('#TUE_ROOM').val();
				tue_at = $('#TUE_PK_ATTENDANCE_ACTIVITY_TYPE').val();
			}
			
			if(document.getElementById('WED').checked == true) {
				wed = 1;
				wed_st = $('#WED_START_TIME').val();
				wed_et = $('#WED_END_TIME').val();
				wed_hr = $('#WED_HOURS').val();
				wed_r  = $('#WED_ROOM').val();
				wed_at = $('#WED_PK_ATTENDANCE_ACTIVITY_TYPE').val();
			}
			
			if(document.getElementById('THU').checked == true) {
				thu = 1;
				thu_st = $('#THU_START_TIME').val();
				thu_et = $('#THU_END_TIME').val();
				thu_hr = $('#THU_HOURS').val();
				thu_r  = $('#THU_ROOM').val();
				thu_at = $('#THU_PK_ATTENDANCE_ACTIVITY_TYPE').val();
			}
			
			if(document.getElementById('FRI').checked == true) {
				fri = 1;
				fri_st = $('#FRI_START_TIME').val();
				fri_et = $('#FRI_END_TIME').val();
				fri_hr = $('#FRI_HOURS').val();
				fri_r  = $('#FRI_ROOM').val();
				fri_at = $('#FRI_PK_ATTENDANCE_ACTIVITY_TYPE').val();
			}
			
			if(document.getElementById('SAT').checked == true) {
				sat = 1;
				sat_st = $('#SAT_START_TIME').val();
				sat_et = $('#SAT_END_TIME').val();
				sat_hr = $('#SAT_HOURS').val();
				sat_r  = $('#SAT_ROOM').val();
				sat_at = $('#SAT_PK_ATTENDANCE_ACTIVITY_TYPE').val();
			}

			var PK_CAMPUS_ROOM  	= document.getElementById('PK_CAMPUS_ROOM').value
			var PK_CAMPUS			= document.getElementById('PK_CAMPUS').value
			var PK_COURSE			= document.getElementById('PK_COURSE').value
			var PK_SESSION			= document.getElementById('PK_SESSION').value
			
			var SCHEDULE_ON_HOLIDAY	= 0
			if(document.getElementById('SCHEDULE_ON_HOLIDAY').checked == true)
				SCHEDULE_ON_HOLIDAY	= 1;
				
			var index			= 0;
			var SCHEDULE_HID 	= document.getElementsByName('SCHEDULE_HID[]')
			for(var i = 0 ; i < SCHEDULE_HID.length ; i++){
				if(parseFloat(SCHEDULE_HID[i].value) > parseFloat(index))
					index = SCHEDULE_HID[i].value
			}
			index++;
			
			var data  = 'sd='+$('#START_DATE').val()+'&ed='+$('#END_DATE').val()+'&sun='+sun+'&sun_st='+sun_st+'&sun_et='+sun_et+'&sun_hr='+sun_hr+'&mon='+mon+'&mon_st='+mon_st+'&mon_et='+mon_et+'&mon_hr='+mon_hr+'&tue='+tue+'&tue_st='+tue_st+'&tue_et='+tue_et+'&tue_hr='+tue_hr+'&wed='+wed+'&wed_st='+wed_st+'&wed_et='+wed_et+'&wed_hr='+wed_hr+'&thu='+thu+'&thu_st='+thu_st+'&thu_et='+thu_et+'&thu_hr='+thu_hr+'&fri='+fri+'&fri_st='+fri_st+'&fri_et='+fri_et+'&fri_hr='+fri_hr+'&sat='+sat+'&sat_st='+sat_st+'&sat_et='+sat_et+'&sat_hr='+sat_hr+'&PK_CAMPUS='+PK_CAMPUS+'&PK_CAMPUS_ROOM='+PK_CAMPUS_ROOM+'&BUILD='+val+'&PK_COURSE='+PK_COURSE+'&SCHEDULE_ON_HOLIDAY='+SCHEDULE_ON_HOLIDAY+'&PK_SESSION='+PK_SESSION+'&sun_r='+sun_r+'&mon_r='+mon_r+'&tue_r='+tue_r+'&wed_r='+wed_r+'&thu_r='+thu_r+'&fri_r='+fri_r+'&sat_r='+sat_r+'&index='+index+'&sun_at='+sun_at+'&mon_at='+mon_at+'&tue_at='+tue_at+'&wed_at='+wed_at+'&thu_at='+thu_at+'&fri_at='+fri_at+'&sat_at='+sat_at
			var value = $.ajax({
				url: "ajax_build_course_offering_schedule",	
				type: "POST",		 
				data: data,		
				async: false,
				cache: false,
				success: function (data) {	
					//alert(data)
					if(document.getElementById('OVERWRITE_SCHEDULE_DATE').checked == true)
						document.getElementById('schedule_div').innerHTML = data;
					else
						$('#schedule_div').append(data)
						
					$('.timepicker').inputmask(
						"hh:mm t", {
							placeholder: "HH:MM AM/PM", 
							insertMode: false, 
							showMaskOnHover: false,
							hourFormat: 12
						}
					);
					
					check_time_clash()
					//calc_total_scheduled_hours(1)
				}		
			}).responseText;
		});
	}
	function add_single_schedule(){
		jQuery(document).ready(function($) { 
			var index			= 0;
			var SCHEDULE_HID 	= document.getElementsByName('SCHEDULE_HID[]')
			for(var i = 0 ; i < SCHEDULE_HID.length ; i++){
				if(parseFloat(SCHEDULE_HID[i].value) > parseFloat(index))
					index = SCHEDULE_HID[i].value
			}
			index++;
			
			var PK_CAMPUS_ROOM  	= document.getElementById('PK_CAMPUS_ROOM').value
			var PK_CAMPUS			= document.getElementById('PK_CAMPUS').value
			var PK_COURSE			= document.getElementById('PK_COURSE').value
			var PK_SESSION			= document.getElementById('PK_SESSION').value
			
			var data  = 'PK_CAMPUS='+PK_CAMPUS+'&PK_CAMPUS_ROOM='+PK_CAMPUS_ROOM+'&BUILD=2'+'&PK_COURSE='+PK_COURSE+'&SCHEDULE_ON_HOLIDAY='+'&PK_SESSION='+PK_SESSION+'&index='+index
			var value = $.ajax({
				url: "ajax_build_course_offering_schedule",	
				type: "POST",		 
				data: data,		
				async: false,
				cache: false,
				success: function (data) {	
					//alert(data)
					$('#schedule_div').append(data)
					
					jQuery('.date').datepicker({
						todayHighlight: true,
						orientation: "bottom auto"
					});
						
					$('.timepicker').inputmask(
						"hh:mm t", {
							placeholder: "HH:MM AM/PM", 
							insertMode: false, 
							showMaskOnHover: false,
							hourFormat: 12
						}
					);
				}		
			}).responseText;			
		});
	}
	
	function check_time_clash(){
		jQuery(document).ready(function($) { 
			var SCHEDULE_HID_ARR 		= []
			var SCHEDULE_DATE_ARR 		= []
			var SCHEDULE_START_TIME_ARR = []
			var SCHEDULE_END_TIME_ARR 	= []
			
			var SCHEDULE_HID 		= document.getElementsByName('SCHEDULE_HID[]')
			var SCHEDULE_DATE 		= document.getElementsByName('SCHEDULE_DATE[]')
			var SCHEDULE_START_TIME = document.getElementsByName('SCHEDULE_START_TIME[]')
			var SCHEDULE_END_TIME 	= document.getElementsByName('SCHEDULE_END_TIME[]')
		
			for(var i = 0 ; i < SCHEDULE_DATE.length ; i++){
				SCHEDULE_HID_ARR[i] 		= SCHEDULE_HID[i].value
				SCHEDULE_DATE_ARR[i] 		= SCHEDULE_DATE[i].value
				SCHEDULE_START_TIME_ARR[i] 	= SCHEDULE_START_TIME[i].value
				SCHEDULE_END_TIME_ARR[i] 	= SCHEDULE_END_TIME[i].value
			}
			
			for(var i = 0 ; i < SCHEDULE_DATE_ARR.length ; i++){
				var SCHEDULE_HID_1 			= SCHEDULE_HID_ARR[i];
				var SCHEDULE_DATE_1 		= SCHEDULE_DATE_ARR[i];
				var SCHEDULE_START_TIME_1 	= SCHEDULE_START_TIME_ARR[i];
				var SCHEDULE_END_TIME_1 	= SCHEDULE_END_TIME_ARR[i];

				for(var j = i ; j < SCHEDULE_DATE_ARR.length ; j++){
					if(SCHEDULE_HID_1 != SCHEDULE_HID_ARR[j]){
						if(SCHEDULE_DATE_1 == SCHEDULE_DATE_ARR[j]) {
							
							//////////////////////
							var dt = new Date();//current Date that gives us current Time also
							var startTime 	= am_pm_to_24(SCHEDULE_START_TIME_1);
							var endTime 	= am_pm_to_24(SCHEDULE_END_TIME_1);
							
							var startTime1 	= am_pm_to_24(SCHEDULE_START_TIME_ARR[j]);
							var endTime1 	= am_pm_to_24(SCHEDULE_END_TIME_ARR[j]);

							var s =  startTime.split(':');
							var dt1 = new Date(dt.getFullYear(), dt.getMonth(), dt.getDate(), parseInt(s[0]), parseInt(s[1]), parseInt(s[2]));

							var e =  endTime.split(':');
							var dt2 = new Date(dt.getFullYear(), dt.getMonth(), dt.getDate(), parseInt(e[0]), parseInt(e[1]), parseInt(e[2]));
							
							var s1 =  startTime1.split(':');
							var dt3 = new Date(dt.getFullYear(), dt.getMonth(), dt.getDate(), parseInt(s1[0]), parseInt(s1[1]), parseInt(s1[2]));

							var e1 =  endTime1.split(':');
							var dt4 = new Date(dt.getFullYear(), dt.getMonth(), dt.getDate(), parseInt(e1[0]), parseInt(e1[1]), parseInt(e1[2]));

							if((dt3 >= dt1 && dt3 <= dt2) || (dt4 >= dt1 && dt4 <= dt2)) {
							
								//////////////////////
								//alert(SCHEDULE_DATE_1+'\n'+SCHEDULE_DATE_ARR[j])
								$("#SCHEDULE_DIV_"+SCHEDULE_HID_ARR[j]).remove()
								
								delete SCHEDULE_HID_ARR[j];
								delete SCHEDULE_DATE_ARR[j];
								delete SCHEDULE_START_TIME_ARR[j];
								delete SCHEDULE_END_TIME_ARR[j];
							}
						}
					}
				}
			}
			sort_schedule()
			calc_total_scheduled_hours(1)
		});
	}
	
	function sort_schedule(){
		jQuery(document).ready(function($) { 
			var SCHEDULE_HID 		= document.getElementsByName('SCHEDULE_HID[]')
			var SCHEDULE_DATE 		= document.getElementsByName('SCHEDULE_DATE[]')
			var SCHEDULE_START_TIME = document.getElementsByName('SCHEDULE_START_TIME[]')
	
			var SCHEDULE_HID_ARR 		= []
			var SCHEDULE_DATE_ARR 		= []
			for(var i = 0 ; i < SCHEDULE_DATE.length ; i++){
				SCHEDULE_HID_ARR[i] 		= SCHEDULE_HID[i].value
				SCHEDULE_DATE_ARR[i] 		= SCHEDULE_DATE[i].value+' '+am_pm_to_24(SCHEDULE_START_TIME[i].value)
			}
			
			var HID  = SCHEDULE_HID_ARR.join();
			var DATE = SCHEDULE_DATE_ARR.join();
			var data  = 'HID='+HID+'&DATE='+DATE;
			var value = $.ajax({
				url: "ajax_sort_schedule",	
				type: "POST",		 
				data: data,		
				async: false,
				cache: false,
				success: function (data) {	
					var data1 = data.split(',');
					for(var i = 0 ; i < data1.length ; i++){
						$('#schedule_div').append($('#SCHEDULE_DIV_'+data1[i]))
					}
					
				}		
			}).responseText;
			
		});
	}
	
	function am_pm_to_24(time){
		var hours 	= Number(time.match(/^(\d+)/)[1]);
		var minutes = Number(time.match(/:(\d+)/)[1]);
		var AMPM = time.match(/\s(.*)$/)[1];
		AMPM = AMPM.toUpperCase()
		if(AMPM == "PM" && hours<12) hours = hours+12;
		if(AMPM == "AM" && hours==12) hours = hours-12;
		var sHours = hours.toString();
		var sMinutes = minutes.toString();
		if(hours<10) sHours = "0" + sHours;
		if(minutes<10) sMinutes = "0" + sMinutes;
		var str  = sHours + ":" + sMinutes + ":00";
		return str;
	}
	
	function calc_total_scheduled_hours(show_warning){
		var TOT_SCHEDULE_HOURS 	= 0;
		var SCHEDULE_HOURS 		= document.getElementsByName('SCHEDULE_HOURS[]')
		
		for(var i = 0 ; i < SCHEDULE_HOURS.length ; i++){
			var SCHEDULE_HOURS_1 = SCHEDULE_HOURS[i].value
			if(SCHEDULE_HOURS_1 != '')
				TOT_SCHEDULE_HOURS = parseFloat(TOT_SCHEDULE_HOURS) + parseFloat(SCHEDULE_HOURS_1)
		}
		TOT_SCHEDULE_HOURS = TOT_SCHEDULE_HOURS.toFixed(2)
		document.getElementById('TOTAL_SCHEDULED_HOURS_SPAN').innerHTML = TOT_SCHEDULE_HOURS
		
		var COURSE_HOUR = document.getElementById('COURSE_HOUR').value
		if(COURSE_HOUR != '' && TOT_SCHEDULE_HOURS != ''){
			if(parseFloat(TOT_SCHEDULE_HOURS) > parseFloat(COURSE_HOUR) && show_warning == 1)
				alert('<?=TOTAL_SCHEDULED_HOURS_EXCEEDS_ERROR?>')
		}
	}
	
	function add_course_student(){
		var w = Math.round((screen.width * 0.95)); //Ticket # 1827
   		var h = Math.round((screen.width * 0.90)); //Ticket # 1827
   		// var id = common_id;
		var left = (screen.width/2)-(w/2);
		var top = (screen.height/2)-(h/2);
   		var parameter = 'toolbar=0,menubar=0,location=0,status=1,scrollbars=1,resizable=1,width='+w+', height='+h+', top='+top+', left='+left;
   		window.open('add_course_students?id=<?=$_GET['id']?>','',parameter);
   		return false;
	}
	function refresh_win(win){
		win.close();
		window.location.href = 'course_offering?id=<?=$_GET[id]?>&tab=studentTab';
	}
	
	/* Ticket # 1325 */
	function refresh_win_wait_list(win){
		win.close();
		window.location.href = 'course_offering?id=<?=$_GET[id]?>&tab=waitingListTab';
	}
	/* Ticket # 1325 */
	
	function show_title(){
		jQuery(document).ready(function($) { 
			/* Ticket # 1458 */
			var str 	= '';
			<? if($_GET['id'] == ''){ ?>
				var course 	= $("#PK_COURSE option:selected").text();
				course 		= course.split(' - ')
				
				str = course[0]
			<? } else { ?>
				str = '<?=$EDIT_COURSE_CODE?>';
			<? } ?>
			/* Ticket # 1458 */
			
			if(str != '' && $("#PK_TERM_MASTER option:selected").text() != '')
				str += ' - ';
			str += $("#PK_TERM_MASTER option:selected").text();
			
			if(str != '' && $("#PK_SESSION option:selected").text() != '' )
				str += ' (';
			try {
				str += $("#PK_SESSION option:selected").text().split(" - ").slice(0, -1).join(" - ");;
			} catch (error) {
				//string could be empty
			}
			
			
			if(str != '' && $("#SESSION_NO").val() != '' )
				str += ' - ';
			str += $("#SESSION_NO").val();
			
			if(str != '' && $("#SESSION_NO").val() != '')
				str += ')';
				
			if(str != '')
				str = ' - '+str

			document.getElementById('heading_span').innerHTML = str;
			
		});
	}
	function hide_delete(id){
		if(document.getElementById('COMPLETED_'+id).checked == true) {
			document.getElementById('del_link_'+id).style.display 	 = 'none';
			document.getElementById('MUL_SEL_DIV_'+id).style.display = 'none';
			document.getElementById('MUL_SEL_'+id).checked 			 = false;
		} else {
			document.getElementById('del_link_'+id).style.display 	 = 'block';
			document.getElementById('MUL_SEL_DIV_'+id).style.display = 'block';
		}
	}
	
	var grade_cunt = '<?=$grade_cunt?>';
	function add_grade(){
		jQuery(document).ready(function($) {
			var data = 'grade_cunt='+grade_cunt+'&ACTION=<?=$_GET['act']?>';
			var value = $.ajax({
				url: "ajax_course_offering_grade",	
				type: "POST",
				data: data,		
				async: false,
				cache :false,
				success: function (data) {
					$('#grade_table tbody').append(data);
					grade_cunt++;
					
					jQuery('.date').datepicker({
						todayHighlight: true,
						orientation: "bottom auto"
					});
				}		
			}).responseText;
		});
	}
	//diam
	var import_disable=false;
		function import_grade() {
			if(import_disable==false){
				jQuery(document).ready(function($) {
					var data = 'grade_cunt=' + grade_cunt + '&PK_COURSE=' + document.getElementById('PK_COURSE').value+'&id=<?= $_GET['id'] ?>';
					var value = $.ajax({
						url: "ajax_import_course_grade",
						type: "POST",
						data: data,
						async: false,
						cache: false,
						success: function(data) {
							$('#grade_table tbody').append(data);
							import_disable=true;	
							var big = 0;
							var GRADE_CUNT = document.getElementsByName('GRADE_CUNT[]')
							for (var i = 0; i < GRADE_CUNT.length; i++){
								if (parseFloat(GRADE_CUNT[i].value) > parseFloat(big))
									big = GRADE_CUNT[i].value
							}
							grade_cunt = big
							grade_cunt++;
							calc_wp()
							//alert(grade_cunt)
							jQuery('.date').datepicker({ //DIAM-785
								todayHighlight: true,
								orientation: "bottom auto"
							});
						}
					}).responseText;
				})
		  }
		}
	
	/* Ticket # 1492 */
	function calc_wp(){
		var POINTS 				= document.getElementsByName('POINTS[]')
		var WEIGHT 				= document.getElementsByName('WEIGHT[]')
		var WEIGHTED_POINTS 	= document.getElementsByName('WEIGHTED_POINTS[]')
		var tot_p  = 0;
		var tot_w  = 0;
		var tot_wp = 0;
		for(var i = 0 ; i < POINTS.length ; i++){
			var wp = '';
			
			if(POINTS[i].value != '') {
				POINTS[i].value = parseFloat(POINTS[i].value).toFixed(4);
				tot_p = parseFloat(tot_p) + parseFloat(POINTS[i].value)
			}
			
			if(WEIGHT[i].value != '') {
				WEIGHT[i].value = parseFloat(WEIGHT[i].value).toFixed(4);
				tot_w = parseFloat(tot_w) + parseFloat(WEIGHT[i].value)
			}
			
			if(POINTS[i].value != '' && WEIGHT[i].value != '') {
				wp = parseFloat(POINTS[i].value) * parseFloat(WEIGHT[i].value)
				
				tot_wp = parseFloat(tot_wp) + parseFloat(wp)
				wp.toFixed(4);
			}
				
			WEIGHTED_POINTS[i].value = wp;
		}
		document.getElementById('POINTS_TOTAL').innerHTML 			= tot_p.toFixed(4);
		document.getElementById('WEIGHTED_TOTAL').innerHTML 		= tot_w.toFixed(4);
		document.getElementById('WEIGHTED_POINTS_TOTAL').innerHTML 	= tot_wp.toFixed(4);
	}
	/* Ticket # 1492 */
	
	function show_bulk_del(){
		var MUL_SEL = document.getElementsByName('MUL_SEL[]')
		var flag = 0;
		for(var i = 0 ; i < MUL_SEL.length ; i++){
			if(MUL_SEL[i].checked == true) {
				flag = 1;
				break;
			}
		}
		
		if(flag == 1)
			document.getElementById('DELETE_SCHEDULE_BTN').style.display = 'inline';
		else
			document.getElementById('DELETE_SCHEDULE_BTN').style.display = 'none';
	}
	
	function add_non_schedule_attendance(){
		var w = 1500;
   		var h = 700;
   		// var id = common_id;
		var left = (screen.width/2)-(w/2);
		var top = (screen.height/2)-(h/2);
   		var parameter = 'toolbar=0,menubar=0,location=0,status=1,scrollbars=1,resizable=1,width='+w+', height='+h+', top='+top+', left='+left;
   		window.open('non_scheduled_attendance?id=<?=$_GET['id']?>&tid=<?=$PK_TERM_MASTER?>&no_menu=1&campus=<?=$PK_CAMPUS?>','',parameter); //DIAM-1422
   		return false;
	}
	
	function refresh_win_1(win){
		win.close()
		window.location.href = 'course_offering?id=<?=$_GET['id']?>&tab=nonScheduleTab';
	}
	
	function calc_grade(sg,sc,sm,post_grade){
		jQuery(document).ready(function($) {
			$( "#delete_grade_input_table" ).remove();
			
			var stu_points 	= document.getElementsByClassName('stu_points_'+sm);
			var stu_grade 	= document.getElementsByClassName('stu_grade_'+sm);
			
			var points 	 = '';
			var pk_grade = '';
			for(var i = 0 ; i < stu_points.length ; i++){
				if(stu_points[i].value != '') {
					if(points != '') {
						points 	 += ',';
						pk_grade += ',';
					}	
					
					points 	 += stu_points[i].value;
					pk_grade += stu_grade[i].value;
						
				}
			}
		
			var data = 'points='+points+'&pk_grade='+pk_grade+'&sc='+sc+'&sm='+sm;
			var value = $.ajax({
				url: "ajax_calc_student_grade",	
				type: "POST",
				data: data,		
				async: false,
				cache :false,
				success: function (data) {
					//alert(data)
					data = data.split('|||');
					document.getElementById('CURRENT_TOTAL_'+sc).innerHTML 					= data[0];
					document.getElementById('GRADE_INPUT_CURRENT_TOTAL_OBTAINED_'+sc).value = data[1];
					document.getElementById('GRADE_INPUT_CURRENT_MAX_TOTAL_'+sc).value 		= data[2];
					document.getElementById('CURRENT_TOTAL_GRADE_'+sc).innerHTML 			= data[3];
					document.getElementById('GRADE_INPUT_CURRENT_TOTAL_GRADE_'+sc).value	= data[4];
					document.getElementById('GRADE_INPUT_CURRENT_TOTAL_PK_GRADE_SCALE_DETAIL_'+sc).value = data[9];
					
					document.getElementById('FINAL_TOTAL_'+sc).innerHTML 					= data[5];
					document.getElementById('GRADE_INPUT_FINAL_TOTAL_OBTAINED_'+sc).value 	= data[1];
					document.getElementById('GRADE_INPUT_FINAL_MAX_TOTAL_'+sc).value 		= data[6];
					document.getElementById('FINAL_TOTAL_GRADE_'+sc).innerHTML 				= data[7];
					document.getElementById('GRADE_INPUT_FINAL_TOTAL_GRADE_'+sc).value		= data[8];
					document.getElementById('GRADE_INPUT_FINAL_TOTAL_PK_GRADE_SCALE_DETAIL_'+sc).value = data[10];
					document.getElementById('POST_GRADE_TYPE').value 						= post_grade
					
					if(post_grade == 1) {
						document.getElementById('FINAL_GRADE_'+sc).innerHTML 	= data[7];
						document.getElementById('GRADE_FINAL_GRADE_'+sc).value	= data[8];
					} else if(post_grade == 2) {
						document.getElementById('FINAL_GRADE_'+sc).innerHTML 	= data[3];
						document.getElementById('GRADE_FINAL_GRADE_'+sc).value	= data[4];
					}
				}		
			}).responseText;
		});
	}
	// function calc_final_grade(type){
	// 	<? $i = 0;
	// 	if(!empty($GI_PK_STUDENT_GRADE)){
	// 		foreach($GI_PK_STUDENT_GRADE as $PK_STUDENT_GRADE){ ?>
	// 			calc_grade('<?=$PK_STUDENT_GRADE?>','<?=$GI_PK_STUDENT_COURSE[$i]?>','<?=$GI_PK_STUDENT_MASTER[$i]?>',type)
	// 		<? 	$i++;
	// 		} 
	// 	} ?>
	// }

		//calculate grade //16 may 23
	function calc_final_grade(type){
		
		var pk_student_grade = jQuery("#GI_PK_STUDENT_GRADE").val();
		var pk_student_course = jQuery("#GI_PK_STUDENT_COURSE").val();
		var pk_student_master = jQuery("#GI_PK_STUDENT_MASTER").val();
		
		if(pk_student_grade!==""){
			var pk_student_grade_arr = pk_student_grade.split(",");
		}else{
			var pk_student_grade_arr = [2,3,4,5,6,7];
		}

		if(pk_student_course!==""){
			var pk_student_course_arr = pk_student_course.split(",");
		}

		if(pk_student_master!==""){
			var pk_student_master_arr = pk_student_master.split(",");
		}
		if(pk_student_grade!==""){			
		var arrayLength = pk_student_grade_arr.length;
		if(arrayLength>0){
		for (let i = 0; i < arrayLength; i++) {	
			//alert(i);		
			//console.log(pk_student_grade_arr[i]+','+pk_student_course_arr[i]+','+pk_student_master_arr[i]+','+type);
			calc_grade(pk_student_grade_arr[i],pk_student_course_arr[i],pk_student_master_arr[i],type);
		
			}
		}
	}

		<? //$i = 0;
			// if(!empty($GI_PK_STUDENT_GRADE)){
			// foreach($GI_PK_STUDENT_GRADE as $PK_STUDENT_GRADE){ ?>
				//calc_grade('<? //=$PK_STUDENT_GRADE?>','<? //=$GI_PK_STUDENT_COURSE[$i]?>','<? //=$GI_PK_STUDENT_MASTER[$i]?>',type)
			<? 	//$i++;
			//} 
		//} ?>
	}

	//DIAM - 685,601
	function check_number_validation(e)
	{
		const regex  = /[^\d.]|\.(?=.*\.)/g;
		const subst  = '';
		const str    = e.value;
		const result = str.replace(regex, subst);
		e.value      = result;
	}
	// End DIAM - 685,601

	function get_session(){
		<? if($_GET['id'] == ''){ ?>
		jQuery(document).ready(function($) {
			if(document.getElementById('PK_COURSE').value != '' && document.getElementById('PK_TERM_MASTER').value != '' && document.getElementById('PK_CAMPUS').value != '' && document.getElementById('PK_SESSION').value != '') {
				var data = 'PK_COURSE='+document.getElementById('PK_COURSE').value+'&PK_TERM_MASTER='+document.getElementById('PK_TERM_MASTER').value+'&PK_CAMPUS='+document.getElementById('PK_CAMPUS').value+'&PK_SESSION='+document.getElementById('PK_SESSION').value;
				var value = $.ajax({
					url: "ajax_generate_course_offering_session_no",	
					type: "POST",
					data: data,		
					async: false,
					cache :false,
					success: function (data) {
						document.getElementById('SESSION_NO').value = data
						document.getElementById('SESSION_NO_DIV').classList.add("focused");
						show_title(); 
					}		
				}).responseText;
			}
		});
		<? } ?>
	}

	
	
	function goto_final_grade(){
		window.location.href = 'final_grade_input?c=<?=$PK_COURSE?>&t=<?=$PK_TERM_MASTER?>&co=<?=$_GET['id']?>';
	}
	
	function add_student_to_course_offering(eid, id){
		jQuery(document).ready(function($) {
			$("#addStudentModal").modal()
			$("#ADD_DELETE_EID").val(eid)
			$("#ADD_DELETE_ID").val(id)
		});
		
	}
	function confirm_add_student_to_course_offering(val){
		jQuery(document).ready(function($) {
			if(val == 1) {
				var eid = $("#ADD_DELETE_EID").val()
				var id  = $("#ADD_DELETE_ID").val()
				
				var data = 'cid=<?=$_GET['id']?>&id='+id+'&eid='+eid;
				var value = $.ajax({
					url: "ajax_add_student_to_course_offering",	
					type: "POST",
					data: data,		
					async: false,
					cache :false,
					success: function (data) {
						$("#WAITINGLIST_"+id).remove()
					}		
				}).responseText;
			}
			$("#addStudentModal").modal("hide");
		});
	}
	
	function import_schedule(eid, id){
		jQuery(document).ready(function($) {
			$("#importScheduleModal").modal()
		});
		
	}
	function conf_import_schedule(val){
		jQuery(document).ready(function($) {
			if(val == 1) {
				var sid = $("#IMPORT_PK_SESSION").val()
				if(sid == '') {
					alert("Please Select Session");
				} else {
					var data = 'coid=<?=$_GET['id'] ?>&cid=<?=$PK_COURSE ?>&sid='+sid;
					var value = $.ajax({
						url: "ajax_get_default_course_schedule",	
						type: "POST",
						data: data,		
						async: false,
						cache :false,
						success: function (data) {
							alert(data)
							$("#form1").removeClass('dirty');
							window.location.href = "course_offering?tab=scheduleTab&id=<?=$_GET['id']?>";
						}		
					}).responseText;
				}
			} else
				$("#importScheduleModal").modal("hide");
		});
	}
	
	function get_course(){
		jQuery(document).ready(function($) {
			var PK_CAMPUS = $("#PK_CAMPUS").val()
			
			var data = 'PK_CAMPUS='+PK_CAMPUS+'&c=';
			var value = $.ajax({
				url: "ajax_get_course_from_campus",	
				type: "POST",
				data: data,		
				async: false,
				cache :false,
				success: function (data) {
					document.getElementById('PK_COURSE_DIV').innerHTML = data
					document.getElementById('PK_COURSE_DIV_1').classList.add("focused");
				}		
			}).responseText;
		});
	}
	
	function get_course_offering(){
		var PK_COURSE = document.getElementById('PK_COURSE').value
		get_course_hour(PK_COURSE); 
		show_title(); 
		get_session();
	}
	function edit_ns(id){
		var w = 600;
		var h = 550;
		// var id = common_id;
		var left = (screen.width/2)-(w/2);
		var top = (screen.height/2)-(h/2);
		var parameter = 'toolbar=0,menubar=0,location=0,status=1,scrollbars=1,resizable=1,width='+w+', height='+h+', top='+top+', left='+left;
		window.open('edit_non_sc?id='+id,'',parameter);
		return false;
	}
	function go_to_ns(win){
		win.close();
		window.location.href = 'course_offering?id=<?=$_GET['id']?>&tab=nonScheduleTab';
	}
	function show_inactive_message(id){
		jQuery(document).ready(function($) {
			var INACTIVE = $("#GRADE_INPUT_INACTIVE_"+id).val()
			/* Ticket # 1661 */
			if(INACTIVE != ''){
				show_inactive_message_popup(id)
			} else {
				show_remove_inactive_message_popup(id)
			}
			/* Ticket # 1661 */
		});
	}
	function show_inactive_message_popup(id){
		jQuery(document).ready(function($) {
			/* Ticket # 1661 */
			$("#inActivePopup").modal({
				backdrop: 'static',
				keyboard: false
			})
			/* Ticket # 1661 */
			$("#inActivePopupID").val(id)
		});
	}
	function confirm_show_inactive_message(val){
		jQuery(document).ready(function($) {
			if(val == 1) {
				
			} else {
				var id = $("#inActivePopupID").val()
				$("#GRADE_INPUT_INACTIVE_"+id).val('');
			}
			$("#inActivePopup").modal("hide");
		});
	}
	
	/* Ticket # 1661 */
	function show_remove_inactive_message_popup(id){
		jQuery(document).ready(function($) {
			$("#inActiveRemovePopup").modal({
				backdrop: 'static',
				keyboard: false
			})
			var def_code = $("#PK_ATTENDANCE_CODE option:selected").text();
			var text 	 = "<?=INACTIVE_REMOVE_CONFIRMATION_MSG ?>";
			var text 	 = text.replace("{Default_Code} ", "'"+def_code+"' " );
			document.getElementById('INACTIVE_REMOVE_CONFIRMATION_MSG_DIV').innerHTML = text
			
			$("#inActiveRemovePopupID").val(id)
		});
	}
	function confirm_show_remove_inactive_message_popup(val){
		jQuery(document).ready(function($) {
			var id = $("#inActiveRemovePopupID").val()
			if(val == 1) {
				$("#GRADE_INPUT_INACTIVE_RESET_ATTENDANCE_CODE_"+id).val('1');
			} else {
				$("#GRADE_INPUT_INACTIVE_RESET_ATTENDANCE_CODE_"+id).val('2');
			}
			$("#inActiveRemovePopup").modal("hide");
		});
	}
	/* Ticket # 1661 */
	
	/****Ticket # 820***/
	function troubleshoot(){
		var str = "";
		str += "CourseOfferingID: <?=$_GET['id']?>\n";
		str += "TermID: <?=$PK_TERM_MASTER?>\n";
		str += "CourseNo: <?=$PK_COURSE?>\n";
		alert(str)
	}
	
	/* Ticket # 1438 */
	function check_student_assigned(pk_term){
		jQuery(document).ready(function($) {
			var data = 'co=<?=$_GET['id']?>';
			var value = $.ajax({
				url: "ajax_check_student_assigned_to_co",	
				type: "POST",
				data: data,		
				async: false,
				cache :false,
				success: function (data) {
					if(data == "a") {
						$("#changeTermPopup").modal()
					}
				}		
			}).responseText;
		});
	}
	
	function confirm_change_student(val){
		jQuery(document).ready(function($) {
			if(val == 1) {
				document.getElementById('UPDATE_STUD_TERM').value 	= 1
			} else {
				document.getElementById('PK_TERM_MASTER').value 	= '<?=$CUR_PK_TERM_MASTER?>';
				document.getElementById('UPDATE_STUD_TERM').value 	= 0
			}
			$("#changeTermPopup").modal("hide");
		});
	}
	/* Ticket # 1438 */
	
	/* Ticket #1149 - term */
	function check_campus(){
		if(document.getElementById('PK_CAMPUS').value == '') {
			alert('Please Select Campus')
			document.getElementById('PK_TERM_MASTER').value = '';
		}
	}
	
	function get_tem_from_campus(val){
		jQuery(document).ready(function($) { 
			var data  = 'pk_campus_id='+val+'&obj_id=PK_TERM_MASTER&obj_name=PK_TERM_MASTER&onclick_fun=1&required=1&onchange=<?=$fun_onchange?>';
			var value = $.ajax({
				url: "ajax_get_term_master_from_campus",
				type: "POST",		 
				data: data,		
				async: false,
				cache: false,
				success: function (data) {
					document.getElementById('EN_1_PK_TERM_MASTER_DIV').innerHTML = data
				}		
			}).responseText;
		});
	}
	/* Ticket # 1438 */
	
	/* Ticket # 1661 */
	function validate_return_date(id){
		jQuery(document).ready(function($) { 
			if(document.getElementById('GRADE_INPUT_INACTIVE_'+id).value == ''){
				document.getElementById('warning_div').innerHTML = 'Missing Inactive Date'
				$("#warningPopup").modal()
			} else {
				var today = new Date();
				var dd = String(today.getDate()).padStart(2, '0');
				var mm = String(today.getMonth() + 1).padStart(2, '0');
				var yyyy = today.getFullYear();

				today = mm + '/' + dd + '/' + yyyy;

				var data  = 'inactive_dt='+document.getElementById('GRADE_INPUT_INACTIVE_'+id).value+'&return_dt='+document.getElementById('GRADE_INPUT_RETURN_DATE_'+id).value+'&today='+today;
				var value = $.ajax({
					url: "ajax_validate_return_date",
					type: "POST",
					data: data,		
					async: false,
					cache: false,
					success: function (data) {
						if(data == "a") {
							document.getElementById('warning_div').innerHTML = 'Date Occurs in the Future'
							document.getElementById('GRADE_INPUT_RETURN_DATE_'+id).value = '';
							$("#warningPopup").modal()
						} else if(data == "b") {
							document.getElementById('warning_div').innerHTML = 'Date Occurs Before the Inactive Date'
							document.getElementById('GRADE_INPUT_RETURN_DATE_'+id).value = '';
							$("#warningPopup").modal()
						} else {
							document.getElementById('warning_div').innerHTML = ''
							$("#warningPopup").modal("hide");
						}
					}		
				}).responseText;
			}
		});
	}
	function close_popup(){
		jQuery(document).ready(function($) { 
			$("#warningPopup").modal("hide");
		});
	}
	/* Ticket # 1661 */
	  // Begin DIAM-589
	  function loader(id)
	{
			document.getElementById(id).innerHTML='<tr><td><div style="position: inherit;margin-top: 0;height: 46px;"><div class="datagrid-mask" style="display:block;top:64%;"></div><div class="datagrid-mask-msg" style="display:block;left:50%;top:84%"> Please wait...</div></div></td></tr>';

	}
	//16 may 23	
	function get_non_sheduled_attendance(val)
	{	loader('nonScheduleData');
		jQuery(document).ready(function($) { 
			var data  = 'id='+val;
			var value = $.ajax({
				url: "ajax_get_course_offering_non-scheduled_attendance",	
				type: "POST",		 
				data: data,		
				async: false,
				cache: false,
				success: function (data) {	
					//alert(data)
					document.getElementById('nonScheduleData').innerHTML = data;
					
				}		
			}).responseText;
		});
	}

	function get_grade_book_entry(val){
		loader('gradeBookEntryData');
		jQuery(document).ready(function($) { 
			var data  = 'id='+val;
			var value = $.ajax({
				url: "ajax_get_grade_book_entry",	
				type: "POST",		 
				data: data,		
				async: false,
				cache: false,
				success: function (data) {	
					//alert(data)
					document.getElementById('gradeBookEntryData').innerHTML = data;
					clickflag =false;
					get_grad_tab(val);
				}		
			}).responseText;
		});		
		
	}


	function get_student_tab(val)
	{
				loader('students_list');
				let temp = document.getElementById('students_list');
				console.log(temp.childElementCount);
				jQuery(document).ready(function($) { 
				var data  = 'id='+val;
				var value = $.ajax({
					url: "ajax_get_course_offering_student_tab",	
					type: "POST",		 
					data: data,		
					async: false,
					cache: false,
					success: function (data) {	
						document.getElementById('students_list').innerHTML = data;
						clickflag =false;
					}		
				}).responseText;
			});		

	}

	function get_final_grad_tab(val)
	{
				loader('finalGradBook');
				jQuery(document).ready(function($) { 
				var data  = 'id='+val;
				var value = $.ajax({
					url: "ajax_get_course_offering_final_grad_tab",	
					type: "POST",		 
					data: data,		
					async: false,
					cache: false,
					success: function (data) {	
						document.getElementById('finalGradBook').innerHTML = data;
						clickflag =false;
						jQuery('.date').datepicker({
						todayHighlight: true,
						orientation: "bottom auto"
					});
					}		
				}).responseText;
			});		

	}

	function get_grad_tab(val){
		loader('grad_list');
				jQuery(document).ready(function($) { 
				var data  = 'id='+val;
				var value = $.ajax({
					url: "ajax_get_course_offering_grad_tab",	
					type: "POST",		 
					data: data,		
					async: false,
					cache: false,
					success: function (data) {	
						document.getElementById('grad_list').innerHTML = data;
						clickflag =false;
						calc_wp(); //DIAM-785
						jQuery('.date').datepicker({
						todayHighlight: true,
						orientation: "bottom auto"
					});

					}		
				}).responseText;
			});		
	}
	//End DIAM-589
	
	</script>
		<?php
	//DIAM-589
	if($_GET['tab'] == 'gradeInputTab'){ ?>
		<script>get_grade_book_entry(<?=$_GET['id']?>);</script>
		<script>get_grad_tab(<?=$_GET['id']?>);</script>
	<? }else if($_GET['tab'] == 'nonScheduleTab'){ ?>
		<script>get_non_sheduled_attendance(<?=$_GET['id']?>);</script>
	<? }else if($_GET['tab'] == 'finalGradeTab'){ //16 may 23?>
		<script>get_final_grad_tab(<?=$_GET['id']?>);</script>
	<? }else if($_GET['tab'] == 'gradeTab'){ //16 may 23?>
		<script>get_grad_tab(<?=$_GET['id']?>);</script>
	<? }else if($_GET['tab'] == 'studentTab'){ //16 may 23?>
		<script>get_student_tab(<?=$_GET['id']?>);</script>
	<? }?>
	
	<link href="../backend_assets/node_modules/bootstrap-table/dist/bootstrap-table.min.css" rel="stylesheet" type="text/css" />
	<script src="../backend_assets/node_modules/bootstrap-table/dist/bootstrap-table.min.js"></script>
	
	<script type="text/javascript" src="../backend_assets/dist/js/bootstrap-multiselect.js"></script>
	<link rel="stylesheet" href="../backend_assets/dist/css/bootstrap-multiselect.css" type="text/css"/>
	<script type="text/javascript">
	jQuery(document).ready(function($) {
		$('#ASSISTANT').multiselect({
			includeSelectAllOption: true,
			allSelectedText: 'All <?=ASSISTANT?>',
			nonSelectedText: '<?=ASSISTANT?>',
			numberDisplayed: 2,
			nSelectedText: '<?=ASSISTANT?> selected'
		});
	});
	</script>
</body>

</html>
